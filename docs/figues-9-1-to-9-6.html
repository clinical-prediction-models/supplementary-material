<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Figues 9.1 to 9.6 | Clinical prediction models</title>
  <meta name="description" content="10 Figues 9.1 to 9.6 | Clinical prediction models" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Figues 9.1 to 9.6 | Clinical prediction models" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="clinical-prediction-models/supplementary-material" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Figues 9.1 to 9.6 | Clinical prediction models" />
  
  
  

<meta name="author" content="Ewout Steyerberg" />


<meta name="date" content="2020-08-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ch-coding.html"/>
<link rel="next" href="ch-restrictions.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Clinical Prediction Models</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="ch-introduction.html"><a href="ch-introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="part"><span><b>I Part I: Prediction models in medicine</b></span></li>
<li class="chapter" data-level="2" data-path="ch-applications.html"><a href="ch-applications.html"><i class="fa fa-check"></i><b>2</b> Applications of Prediction Models</a></li>
<li class="chapter" data-level="3" data-path="ch-design.html"><a href="ch-design.html"><i class="fa fa-check"></i><b>3</b> Study Design for Prediction Modeling</a></li>
<li class="chapter" data-level="4" data-path="ch-statmods.html"><a href="ch-statmods.html"><i class="fa fa-check"></i><b>4</b> Statistical Models for Prediction</a></li>
<li class="chapter" data-level="5" data-path="ch-overfitting.html"><a href="ch-overfitting.html"><i class="fa fa-check"></i><b>5</b> Overfitting and Optimism in Prediction Models</a><ul>
<li class="chapter" data-level="5.1" data-path="ch-overfitting.html"><a href="ch-overfitting.html#figures-5.2-to-5.5"><i class="fa fa-check"></i><b>5.1</b> Figures 5.2 to 5.5</a><ul>
<li class="chapter" data-level="5.1.1" data-path="ch-overfitting.html"><a href="ch-overfitting.html#fig-5.2-noise-in-estimating-10-mortality-per-center"><i class="fa fa-check"></i><b>5.1.1</b> Fig 5.2: Noise in estimating 10% mortality per center</a></li>
<li class="chapter" data-level="5.1.2" data-path="ch-overfitting.html"><a href="ch-overfitting.html#figs-5.3-and-5.4"><i class="fa fa-check"></i><b>5.1.2</b> Figs 5.3 and 5.4</a></li>
<li class="chapter" data-level="5.1.3" data-path="ch-overfitting.html"><a href="ch-overfitting.html#n20"><i class="fa fa-check"></i><b>5.1.3</b> n=20</a></li>
<li class="chapter" data-level="5.1.4" data-path="ch-overfitting.html"><a href="ch-overfitting.html#n200"><i class="fa fa-check"></i><b>5.1.4</b> n=200</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ch-altmods.html"><a href="ch-altmods.html"><i class="fa fa-check"></i><b>6</b> Choosing Between Alternative Models</a><ul>
<li class="chapter" data-level="6.1" data-path="ch-altmods.html"><a href="ch-altmods.html#non-linearity-illustrations"><i class="fa fa-check"></i><b>6.1</b> Non-linearity illustrations</a><ul>
<li class="chapter" data-level="6.1.1" data-path="ch-altmods.html"><a href="ch-altmods.html#prepare-gusto-data"><i class="fa fa-check"></i><b>6.1.1</b> Prepare GUSTO data</a></li>
<li class="chapter" data-level="6.1.2" data-path="ch-altmods.html"><a href="ch-altmods.html#anova-results-for-the-different-fits"><i class="fa fa-check"></i><b>6.1.2</b> anova results for the different fits</a></li>
<li class="chapter" data-level="6.1.3" data-path="ch-altmods.html"><a href="ch-altmods.html#plotting-of-age-effects"><i class="fa fa-check"></i><b>6.1.3</b> Plotting of age effects</a></li>
<li class="chapter" data-level="6.1.4" data-path="ch-altmods.html"><a href="ch-altmods.html#start-surgical-mortality-by-age-in-medicare"><i class="fa fa-check"></i><b>6.1.4</b> Start surgical mortality by age in Medicare</a></li>
<li class="chapter" data-level="6.1.5" data-path="ch-altmods.html"><a href="ch-altmods.html#anova-results-for-the-fit-of-age-with-interaction-by-type-of-surgery"><i class="fa fa-check"></i><b>6.1.5</b> anova results for the fit of age, with interaction by type of surgery</a></li>
<li class="chapter" data-level="6.1.6" data-path="ch-altmods.html"><a href="ch-altmods.html#plotting-of-predicted-age-effects-with-interaction-by-type-of-surgery-add-95-ci"><i class="fa fa-check"></i><b>6.1.6</b> Plotting of predicted age effects, with interaction by type of surgery; add 95% CI</a></li>
<li class="chapter" data-level="6.1.7" data-path="ch-altmods.html"><a href="ch-altmods.html#plotting-of-age-effects-with-original-data-points"><i class="fa fa-check"></i><b>6.1.7</b> Plotting of age effects with original data points</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Part II: Developing Valid Prediction Models</b></span></li>
<li class="chapter" data-level="7" data-path="ch-missing.html"><a href="ch-missing.html"><i class="fa fa-check"></i><b>7</b> Missing values</a></li>
<li class="chapter" data-level="8" data-path="ch-missing-case.html"><a href="ch-missing-case.html"><i class="fa fa-check"></i><b>8</b> Case Study on Dealing with Missing Values</a></li>
<li class="chapter" data-level="9" data-path="ch-coding.html"><a href="ch-coding.html"><i class="fa fa-check"></i><b>9</b> Coding of Categorical and Continuous Predictors</a></li>
<li class="chapter" data-level="10" data-path="figues-9-1-to-9-6.html"><a href="figues-9-1-to-9-6.html"><i class="fa fa-check"></i><b>10</b> Figues 9.1 to 9.6</a><ul>
<li class="chapter" data-level="10.0.1" data-path="figues-9-1-to-9-6.html"><a href="figues-9-1-to-9-6.html#fig-9.1-age-linear-add-square-rcs-in-gusto-i"><i class="fa fa-check"></i><b>10.0.1</b> Fig 9.1: Age linear; add square; rcs in GUSTO-I</a></li>
<li class="chapter" data-level="10.0.2" data-path="figues-9-1-to-9-6.html"><a href="figues-9-1-to-9-6.html#fig-9.2-impact-of-number-of-st-elevations-ste"><i class="fa fa-check"></i><b>10.0.2</b> Fig 9.2: Impact of number of ST elevations (STE)</a></li>
<li class="chapter" data-level="10.0.3" data-path="figues-9-1-to-9-6.html"><a href="figues-9-1-to-9-6.html#fig-9.3-non-linearities-in-small-sample-n751-and-full-gusto-i-n40830"><i class="fa fa-check"></i><b>10.0.3</b> Fig 9.3: Non-linearities in small sample (n=751); and full GUSTO-I (n=40,830)</a></li>
<li class="chapter" data-level="10.0.4" data-path="figues-9-1-to-9-6.html"><a href="figues-9-1-to-9-6.html#fig-9.4-glucose-and-hb-in-tbi"><i class="fa fa-check"></i><b>10.0.4</b> Fig 9.4: Glucose and hb in TBI</a></li>
<li class="chapter" data-level="10.0.5" data-path="figues-9-1-to-9-6.html"><a href="figues-9-1-to-9-6.html#fig-9.5-non-linear-association-of-glucose"><i class="fa fa-check"></i><b>10.0.5</b> Fig 9.5: Non-linear association of glucose</a></li>
<li class="chapter" data-level="10.0.6" data-path="figues-9-1-to-9-6.html"><a href="figues-9-1-to-9-6.html#fig-9.6-systolic-blood-pressure-in-tbi"><i class="fa fa-check"></i><b>10.0.6</b> Fig 9.6: Systolic blood pressure in TBI</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="ch-restrictions.html"><a href="ch-restrictions.html"><i class="fa fa-check"></i><b>11</b> Restrictions on Candidate Predictors</a></li>
<li class="chapter" data-level="12" data-path="ch-selection.html"><a href="ch-selection.html"><i class="fa fa-check"></i><b>12</b> Selection of Main Effects</a></li>
<li class="chapter" data-level="13" data-path="ch-assumptions.html"><a href="ch-assumptions.html"><i class="fa fa-check"></i><b>13</b> Assumptions in Regression Models: Additivity and Linearity</a></li>
<li class="chapter" data-level="14" data-path="ch-estimation.html"><a href="ch-estimation.html"><i class="fa fa-check"></i><b>14</b> Modern Estimation Methods</a></li>
<li class="chapter" data-level="15" data-path="ch-estimation-external.html"><a href="ch-estimation-external.html"><i class="fa fa-check"></i><b>15</b> Estimation with External Information</a></li>
<li class="chapter" data-level="16" data-path="ch-evaluation.html"><a href="ch-evaluation.html"><i class="fa fa-check"></i><b>16</b> Evaluation of Performance</a></li>
<li class="chapter" data-level="17" data-path="ch-usefulness.html"><a href="ch-usefulness.html"><i class="fa fa-check"></i><b>17</b> Evaluation of Clinical Usefulness</a></li>
<li class="chapter" data-level="18" data-path="ch-validation.html"><a href="ch-validation.html"><i class="fa fa-check"></i><b>18</b> Validation of Prediction Models</a></li>
<li class="chapter" data-level="19" data-path="ch-presentation.html"><a href="ch-presentation.html"><i class="fa fa-check"></i><b>19</b> Presentation Formats</a></li>
<li class="part"><span><b>III Part III: Generalizability of Prediction Models</b></span></li>
<li class="chapter" data-level="20" data-path="ch-external-validity.html"><a href="ch-external-validity.html"><i class="fa fa-check"></i><b>20</b> Patterns of External Validity</a></li>
<li class="chapter" data-level="21" data-path="ch-updating.html"><a href="ch-updating.html"><i class="fa fa-check"></i><b>21</b> Updating for a New Setting</a></li>
<li class="chapter" data-level="22" data-path="ch-updating-multiple.html"><a href="ch-updating-multiple.html"><i class="fa fa-check"></i><b>22</b> Updating for Multiple Settings</a></li>
<li class="part"><span><b>IV Part IIII: Applications</b></span></li>
<li class="chapter" data-level="23" data-path="ch-case-study-gusto.html"><a href="ch-case-study-gusto.html"><i class="fa fa-check"></i><b>23</b> Case Study on a Prediction of 30-Day Mortality</a></li>
<li class="chapter" data-level="24" data-path="ch-case-study-cardiovascular.html"><a href="ch-case-study-cardiovascular.html"><i class="fa fa-check"></i><b>24</b> Case Study on Survival Analysis: Prediction of Cardiovascular Event</a></li>
<li class="chapter" data-level="25" data-path="ch-lessons-datasets.html"><a href="ch-lessons-datasets.html"><i class="fa fa-check"></i><b>25</b> Overall Lessons and Data Sets</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Clinical prediction models</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="figues-9.1-to-9.6" class="section level1">
<h1><span class="header-section-number">10</span> Figues 9.1 to 9.6</h1>
<p>GUSTO-I is a data set with patients suffering from an acute myocardial infarction, where we want to predict 30-day mortality.
TBI is a data set with patients suffering from a moderate or severe traumatic brain injury.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="figues-9-1-to-9-6.html#cb22-1"></a><span class="co"># Import gusto</span></span>
<span id="cb22-2"><a href="figues-9-1-to-9-6.html#cb22-2"></a>gusto &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/gusto_age_STE.csv&#39;</span>)[,<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb22-3"><a href="figues-9-1-to-9-6.html#cb22-3"></a></span>
<span id="cb22-4"><a href="figues-9-1-to-9-6.html#cb22-4"></a><span class="co"># Import sample4; n=785</span></span>
<span id="cb22-5"><a href="figues-9-1-to-9-6.html#cb22-5"></a>gustos &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/Gustos4Age.csv&quot;</span>)</span>
<span id="cb22-6"><a href="figues-9-1-to-9-6.html#cb22-6"></a></span>
<span id="cb22-7"><a href="figues-9-1-to-9-6.html#cb22-7"></a><span class="co"># Import TBI data; n=2159</span></span>
<span id="cb22-8"><a href="figues-9-1-to-9-6.html#cb22-8"></a>TBI &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/TBI2vars.csv&quot;</span>)</span></code></pre></div>
<div id="fig-9.1-age-linear-add-square-rcs-in-gusto-i" class="section level3">
<h3><span class="header-section-number">10.0.1</span> Fig 9.1: Age linear; add square; rcs in GUSTO-I</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="figues-9-1-to-9-6.html#cb23-1"></a>agegusto.linear &lt;-<span class="st"> </span><span class="kw">lrm</span>(DAY30<span class="op">~</span>AGE,   <span class="dt">data=</span>gusto, <span class="dt">x=</span>T,<span class="dt">y=</span>T)</span>
<span id="cb23-2"><a href="figues-9-1-to-9-6.html#cb23-2"></a>agegusto.square &lt;-<span class="st"> </span><span class="kw">lrm</span>(DAY30<span class="op">~</span><span class="kw">pol</span>(AGE,<span class="dv">2</span>),    <span class="dt">data=</span>gusto, <span class="dt">x=</span>T,<span class="dt">y=</span>T)</span>
<span id="cb23-3"><a href="figues-9-1-to-9-6.html#cb23-3"></a>agegusto.rcs    &lt;-<span class="st"> </span><span class="kw">lrm</span>(DAY30<span class="op">~</span><span class="kw">rcs</span>(AGE,<span class="dv">5</span>),    <span class="dt">data=</span>gusto, <span class="dt">x=</span>T,<span class="dt">y=</span>T)</span>
<span id="cb23-4"><a href="figues-9-1-to-9-6.html#cb23-4"></a><span class="co">## dichotomize</span></span>
<span id="cb23-5"><a href="figues-9-1-to-9-6.html#cb23-5"></a>agegusto.cat65    &lt;-<span class="st"> </span><span class="kw">lrm</span>(DAY30<span class="op">~</span><span class="kw">ifelse</span>(AGE<span class="op">&lt;</span><span class="dv">65</span>,<span class="dv">0</span>,<span class="dv">1</span>),  <span class="dt">data=</span>gusto, <span class="dt">x=</span>T,<span class="dt">y=</span>T)</span>
<span id="cb23-6"><a href="figues-9-1-to-9-6.html#cb23-6"></a><span class="co">## 3 categories</span></span>
<span id="cb23-7"><a href="figues-9-1-to-9-6.html#cb23-7"></a>agegusto<span class="fl">.3</span>cat    &lt;-<span class="st"> </span><span class="kw">lrm</span>(DAY30<span class="op">~</span><span class="kw">ifelse</span>(AGE<span class="op">&lt;</span><span class="dv">60</span>,<span class="dv">0</span>,<span class="kw">ifelse</span>(AGE<span class="op">&lt;</span><span class="dv">70</span>, <span class="dv">1</span>,<span class="dv">2</span>)), <span class="dt">data=</span>gusto, <span class="dt">x=</span>T,<span class="dt">y=</span>T)</span>
<span id="cb23-8"><a href="figues-9-1-to-9-6.html#cb23-8"></a></span>
<span id="cb23-9"><a href="figues-9-1-to-9-6.html#cb23-9"></a><span class="co"># Predict for age 20:95</span></span>
<span id="cb23-10"><a href="figues-9-1-to-9-6.html#cb23-10"></a>newdata.age =<span class="kw">data.frame</span>(<span class="st">&quot;AGE&quot;</span>=<span class="kw">seq</span>(<span class="dv">20</span>,<span class="dv">95</span>, <span class="dt">by=</span><span class="fl">0.1</span>))</span>
<span id="cb23-11"><a href="figues-9-1-to-9-6.html#cb23-11"></a>pred.agegusto.linear  &lt;-<span class="st"> </span><span class="kw">predict</span>(agegusto.linear, newdata.age)</span>
<span id="cb23-12"><a href="figues-9-1-to-9-6.html#cb23-12"></a>pred.agegusto.square  &lt;-<span class="st"> </span><span class="kw">predict</span>(agegusto.square,newdata.age)</span>
<span id="cb23-13"><a href="figues-9-1-to-9-6.html#cb23-13"></a>pred.agegusto.rcs     &lt;-<span class="st"> </span><span class="kw">predict</span>(agegusto.rcs,newdata.age)</span>
<span id="cb23-14"><a href="figues-9-1-to-9-6.html#cb23-14"></a>pred.agegusto.cat65   &lt;-<span class="st"> </span><span class="kw">predict</span>(agegusto.cat65,newdata.age)</span>
<span id="cb23-15"><a href="figues-9-1-to-9-6.html#cb23-15"></a>pred.agegusto<span class="fl">.3</span>cat   &lt;-<span class="st"> </span><span class="kw">predict</span>(agegusto<span class="fl">.3</span>cat,newdata.age)</span>
<span id="cb23-16"><a href="figues-9-1-to-9-6.html#cb23-16"></a></span>
<span id="cb23-17"><a href="figues-9-1-to-9-6.html#cb23-17"></a><span class="co"># Make plot</span></span>
<span id="cb23-18"><a href="figues-9-1-to-9-6.html#cb23-18"></a>dd &lt;-<span class="st"> </span><span class="kw">datadist</span>(gusto)</span>
<span id="cb23-19"><a href="figues-9-1-to-9-6.html#cb23-19"></a><span class="kw">options</span>(<span class="dt">datadist=</span><span class="st">&quot;dd&quot;</span>) <span class="co"># for rms</span></span>
<span id="cb23-20"><a href="figues-9-1-to-9-6.html#cb23-20"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb23-21"><a href="figues-9-1-to-9-6.html#cb23-21"></a><span class="kw">plot</span>(<span class="dt">x=</span>newdata.age[,<span class="dv">1</span>], <span class="dt">y=</span>pred.agegusto.linear, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">20</span>,<span class="dv">92</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">7</span>,<span class="dv">0</span>), <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb23-22"><a href="figues-9-1-to-9-6.html#cb23-22"></a>     <span class="dt">xlab=</span><span class="st">&#39;Age in years&#39;</span>, <span class="dt">ylab=</span><span class="st">&#39;logit of 30-day mortality&#39;</span>, <span class="dt">cex.lab=</span><span class="fl">1.2</span>, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span>mycolors[<span class="dv">2</span>])</span>
<span id="cb23-23"><a href="figues-9-1-to-9-6.html#cb23-23"></a><span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span><span class="kw">c</span>(<span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>,<span class="dv">65</span>,<span class="dv">70</span>, <span class="dv">80</span>,<span class="dv">90</span>))</span>
<span id="cb23-24"><a href="figues-9-1-to-9-6.html#cb23-24"></a><span class="kw">lines</span>(<span class="dt">x=</span>newdata.age[,<span class="dv">1</span>], <span class="dt">y=</span>pred.agegusto.cat65, <span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span>mycolors[<span class="dv">3</span>])</span>
<span id="cb23-25"><a href="figues-9-1-to-9-6.html#cb23-25"></a><span class="kw">lines</span>(<span class="dt">x=</span>newdata.age[,<span class="dv">1</span>], <span class="dt">y=</span>pred.agegusto<span class="fl">.3</span>cat, <span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span>mycolors[<span class="dv">4</span>])</span>
<span id="cb23-26"><a href="figues-9-1-to-9-6.html#cb23-26"></a><span class="kw">scat1d</span>(<span class="dt">x=</span>gusto<span class="op">$</span>AGE, <span class="dt">side=</span><span class="dv">1</span>, <span class="dt">frac=</span>.<span class="dv">05</span>, <span class="dt">col=</span><span class="st">&quot;darkblue&quot;</span>)</span>
<span id="cb23-27"><a href="figues-9-1-to-9-6.html#cb23-27"></a><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;linear&quot;</span>,<span class="st">&quot;&lt;65 vs &gt;=65&quot;</span>, <span class="st">&quot;&lt;60, 60-69, 70+&quot;</span>),</span>
<span id="cb23-28"><a href="figues-9-1-to-9-6.html#cb23-28"></a>       <span class="dt">lty=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">cex=</span><span class="dv">1</span>, <span class="dt">bty=</span><span class="st">&#39;n&#39;</span>,<span class="dt">col=</span>mycolors[<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>])</span></code></pre></div>
<p><img src="fig/Fig9.1-1.png" width="672" /></p>
</div>
<div id="fig-9.2-impact-of-number-of-st-elevations-ste" class="section level3">
<h3><span class="header-section-number">10.0.2</span> Fig 9.2: Impact of number of ST elevations (STE)</h3>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="figues-9-1-to-9-6.html#cb24-1"></a><span class="co"># winsorize at STE 10</span></span>
<span id="cb24-2"><a href="figues-9-1-to-9-6.html#cb24-2"></a>gusto<span class="op">$</span>STE &lt;-<span class="st"> </span><span class="kw">ifelse</span>(gusto<span class="op">$</span>STE<span class="op">&gt;</span><span class="dv">10</span>, <span class="dv">10</span>, gusto<span class="op">$</span>STE)</span>
<span id="cb24-3"><a href="figues-9-1-to-9-6.html#cb24-3"></a>gusto<span class="op">$</span>STE.f &lt;-<span class="st"> </span><span class="kw">as.factor</span>(gusto<span class="op">$</span>STE)</span>
<span id="cb24-4"><a href="figues-9-1-to-9-6.html#cb24-4"></a>STE.linear &lt;-<span class="st"> </span><span class="kw">lrm</span>(DAY30<span class="op">~</span>STE,    <span class="dt">data=</span>gusto, <span class="dt">x=</span>T,<span class="dt">y=</span>T)</span>
<span id="cb24-5"><a href="figues-9-1-to-9-6.html#cb24-5"></a>STE.square &lt;-<span class="st"> </span><span class="kw">lrm</span>(DAY30<span class="op">~</span><span class="kw">pol</span>(STE,<span class="dv">2</span>), <span class="dt">data=</span>gusto, <span class="dt">x=</span>T,<span class="dt">y=</span>T)</span>
<span id="cb24-6"><a href="figues-9-1-to-9-6.html#cb24-6"></a>STE.rcs    &lt;-<span class="st"> </span><span class="kw">lrm</span>(DAY30<span class="op">~</span><span class="kw">rcs</span>(STE,<span class="dv">5</span>), <span class="dt">data=</span>gusto, <span class="dt">x=</span>T,<span class="dt">y=</span>T)</span>
<span id="cb24-7"><a href="figues-9-1-to-9-6.html#cb24-7"></a>STE.factor    &lt;-<span class="st"> </span><span class="kw">lrm</span>(DAY30<span class="op">~</span>STE.f,   <span class="dt">data=</span>gusto, <span class="dt">x=</span>T,<span class="dt">y=</span>T)</span>
<span id="cb24-8"><a href="figues-9-1-to-9-6.html#cb24-8"></a></span>
<span id="cb24-9"><a href="figues-9-1-to-9-6.html#cb24-9"></a><span class="co"># dichotomize</span></span>
<span id="cb24-10"><a href="figues-9-1-to-9-6.html#cb24-10"></a>STE.cat4    &lt;-<span class="st"> </span><span class="kw">lrm</span>(DAY30<span class="op">~</span><span class="kw">ifelse</span>(STE<span class="op">&lt;</span><span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">data=</span>gusto, <span class="dt">x=</span>T,<span class="dt">y=</span>T)</span>
<span id="cb24-11"><a href="figues-9-1-to-9-6.html#cb24-11"></a></span>
<span id="cb24-12"><a href="figues-9-1-to-9-6.html#cb24-12"></a><span class="co"># predict for STE 0:10</span></span>
<span id="cb24-13"><a href="figues-9-1-to-9-6.html#cb24-13"></a>newdata.STE =<span class="kw">data.frame</span>(<span class="st">&quot;STE&quot;</span>=<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">10</span>, <span class="dt">by=</span><span class="dv">1</span>))</span>
<span id="cb24-14"><a href="figues-9-1-to-9-6.html#cb24-14"></a>pred.STE.linear  &lt;-<span class="st"> </span><span class="kw">predict</span>(STE.linear, newdata.STE)</span>
<span id="cb24-15"><a href="figues-9-1-to-9-6.html#cb24-15"></a>pred.STE.square  &lt;-<span class="st"> </span><span class="kw">predict</span>(STE.square,newdata.STE)</span>
<span id="cb24-16"><a href="figues-9-1-to-9-6.html#cb24-16"></a>pred.STE.rcs     &lt;-<span class="st"> </span><span class="kw">predict</span>(STE.rcs,newdata.STE)</span>
<span id="cb24-17"><a href="figues-9-1-to-9-6.html#cb24-17"></a>pred.STE.cat4   &lt;-<span class="st"> </span><span class="kw">predict</span>(STE.cat4,newdata.STE)</span>
<span id="cb24-18"><a href="figues-9-1-to-9-6.html#cb24-18"></a></span>
<span id="cb24-19"><a href="figues-9-1-to-9-6.html#cb24-19"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb24-20"><a href="figues-9-1-to-9-6.html#cb24-20"></a><span class="kw">plot</span>(<span class="dt">x=</span>newdata.STE[,<span class="dv">1</span>], <span class="dt">y=</span>pred.STE.linear, <span class="dt">las=</span><span class="dv">1</span>,</span>
<span id="cb24-21"><a href="figues-9-1-to-9-6.html#cb24-21"></a>     <span class="dt">xlab=</span><span class="st">&#39;Number of leads with ST elevation&#39;</span>, <span class="dt">ylab=</span><span class="st">&#39;logit of 30-day mortality&#39;</span>, <span class="dt">cex.lab=</span><span class="fl">1.2</span>, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span>mycolors[<span class="dv">2</span>])</span>
<span id="cb24-22"><a href="figues-9-1-to-9-6.html#cb24-22"></a><span class="kw">lines</span>(<span class="dt">x=</span>newdata.STE[,<span class="dv">1</span>], <span class="dt">y=</span>pred.STE.square, <span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span>mycolors[<span class="dv">3</span>])</span>
<span id="cb24-23"><a href="figues-9-1-to-9-6.html#cb24-23"></a><span class="kw">lines</span>(<span class="dt">x=</span>newdata.STE[,<span class="dv">1</span>], <span class="dt">y=</span>pred.STE.rcs, <span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">lwd=</span><span class="dv">3</span>, <span class="dt">col=</span>mycolors[<span class="dv">4</span>])</span>
<span id="cb24-24"><a href="figues-9-1-to-9-6.html#cb24-24"></a><span class="kw">lines</span>(<span class="dt">x=</span>newdata.STE[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">1</span>], <span class="dt">y=</span>pred.STE.cat4[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>], <span class="dt">lty=</span><span class="dv">4</span>,<span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span>mycolors[<span class="dv">5</span>])</span>
<span id="cb24-25"><a href="figues-9-1-to-9-6.html#cb24-25"></a><span class="kw">lines</span>(<span class="dt">x=</span>newdata.STE[<span class="dv">6</span><span class="op">:</span><span class="dv">11</span>,<span class="dv">1</span>], <span class="dt">y=</span>pred.STE.cat4[<span class="dv">6</span><span class="op">:</span><span class="dv">11</span>], <span class="dt">lty=</span><span class="dv">4</span>,<span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span>mycolors[<span class="dv">5</span>])</span>
<span id="cb24-26"><a href="figues-9-1-to-9-6.html#cb24-26"></a></span>
<span id="cb24-27"><a href="figues-9-1-to-9-6.html#cb24-27"></a><span class="co"># Original data points, with size proportional to sqrt(events)</span></span>
<span id="cb24-28"><a href="figues-9-1-to-9-6.html#cb24-28"></a>STEmort &lt;-<span class="st">  </span><span class="kw">log</span>(<span class="kw">by</span>(gusto<span class="op">$</span>DAY,gusto<span class="op">$</span>STE, mean) <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span><span class="kw">by</span>(gusto<span class="op">$</span>DAY,gusto<span class="op">$</span>STE, mean)))[<span class="dv">1</span><span class="op">:</span><span class="dv">11</span>]</span>
<span id="cb24-29"><a href="figues-9-1-to-9-6.html#cb24-29"></a>STEw    &lt;-<span class="st">  </span><span class="kw">sqrt</span>(<span class="kw">by</span>(gusto<span class="op">$</span>DAY,gusto<span class="op">$</span>STE, sum)[<span class="dv">1</span><span class="op">:</span><span class="dv">11</span>])<span class="op">/</span><span class="dv">10</span></span>
<span id="cb24-30"><a href="figues-9-1-to-9-6.html#cb24-30"></a><span class="kw">points</span>(<span class="dt">x=</span>newdata.STE[,<span class="dv">1</span>], <span class="dt">y=</span>STEmort, <span class="dt">pch=</span><span class="dv">1</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">cex=</span>STEw, <span class="dt">col=</span><span class="st">&quot;black&quot;</span>)</span>
<span id="cb24-31"><a href="figues-9-1-to-9-6.html#cb24-31"></a><span class="kw">scat1d</span>(<span class="dt">x=</span>gusto<span class="op">$</span>STE, <span class="dt">side=</span><span class="dv">1</span>, <span class="dt">frac=</span>.<span class="dv">05</span>, <span class="dt">col=</span><span class="st">&quot;darkblue&quot;</span>)</span>
<span id="cb24-32"><a href="figues-9-1-to-9-6.html#cb24-32"></a><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;data&quot;</span>,  <span class="st">&quot;linear&quot;</span>,<span class="st">&quot;.. +square&quot;</span>, <span class="st">&quot;rcs&quot;</span>, <span class="st">&quot;&lt;=4, vs &gt;4&quot;</span>),</span>
<span id="cb24-33"><a href="figues-9-1-to-9-6.html#cb24-33"></a>       <span class="dt">lty=</span><span class="kw">c</span>(<span class="ot">NA</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>), <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">cex=</span><span class="dv">1</span>, <span class="dt">bty=</span><span class="st">&#39;n&#39;</span>, <span class="dt">col=</span>mycolors[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>])</span></code></pre></div>
<p><img src="fig/Fig9.2-1.png" width="672" /></p>
</div>
<div id="fig-9.3-non-linearities-in-small-sample-n751-and-full-gusto-i-n40830" class="section level3">
<h3><span class="header-section-number">10.0.3</span> Fig 9.3: Non-linearities in small sample (n=751); and full GUSTO-I (n=40,830)</h3>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="figues-9-1-to-9-6.html#cb25-1"></a><span class="co"># Examine non-linearities in gustos sample</span></span>
<span id="cb25-2"><a href="figues-9-1-to-9-6.html#cb25-2"></a><span class="co"># Age</span></span>
<span id="cb25-3"><a href="figues-9-1-to-9-6.html#cb25-3"></a>age.linear  &lt;-<span class="st"> </span><span class="kw">lrm</span>(DAY30<span class="op">~</span>AGE,<span class="dt">data=</span>gustos,<span class="dt">x=</span>T,<span class="dt">y=</span>T,<span class="dt">linear.predictors=</span>F)</span>
<span id="cb25-4"><a href="figues-9-1-to-9-6.html#cb25-4"></a>age.rcs1    &lt;-<span class="st"> </span><span class="kw">lrm</span>(DAY30<span class="op">~</span><span class="kw">rcs</span>(AGE,<span class="dv">5</span>),<span class="dt">data=</span>gustos,<span class="dt">x=</span>T,<span class="dt">y=</span>T,<span class="dt">linear.predictors=</span>F)</span>
<span id="cb25-5"><a href="figues-9-1-to-9-6.html#cb25-5"></a>age.fp1     &lt;-<span class="st"> </span><span class="kw">mfp</span>(DAY30<span class="op">~</span><span class="kw">fp</span>(AGE,<span class="dt">df=</span><span class="dv">4</span>), <span class="dt">alpha=</span><span class="dv">1</span>,<span class="dt">data=</span>gustos,<span class="dt">family=</span>binomial) <span class="co"># selected: -2 and 3</span></span>
<span id="cb25-6"><a href="figues-9-1-to-9-6.html#cb25-6"></a>age.gam1    &lt;-<span class="st"> </span><span class="kw">gam</span>(DAY30<span class="op">~</span><span class="kw">s</span>(AGE),<span class="dt">data=</span>gustos, <span class="dt">family=</span>binomial)</span>
<span id="cb25-7"><a href="figues-9-1-to-9-6.html#cb25-7"></a></span>
<span id="cb25-8"><a href="figues-9-1-to-9-6.html#cb25-8"></a><span class="co"># examine predictions for age 20:95</span></span>
<span id="cb25-9"><a href="figues-9-1-to-9-6.html#cb25-9"></a>age.mat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">nrow=</span><span class="dv">751</span>,<span class="dt">ncol=</span><span class="dv">5</span>)</span>
<span id="cb25-10"><a href="figues-9-1-to-9-6.html#cb25-10"></a><span class="kw">names</span>(age.mat) &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>, <span class="kw">Cs</span>(AGE, linear, fp, rcs, gam))</span>
<span id="cb25-11"><a href="figues-9-1-to-9-6.html#cb25-11"></a>AGE &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">20</span>,<span class="dv">95</span>, <span class="dt">by=</span><span class="fl">0.1</span>)</span>
<span id="cb25-12"><a href="figues-9-1-to-9-6.html#cb25-12"></a>age.mat[,<span class="dv">1</span>] &lt;-<span class="st"> </span>AGE</span>
<span id="cb25-13"><a href="figues-9-1-to-9-6.html#cb25-13"></a>age.mat[,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">predict</span>(age.linear, <span class="dt">newdata=</span><span class="kw">as.data.frame</span>(<span class="dt">x=</span>AGE), <span class="dt">type=</span><span class="st">&quot;lp&quot;</span>)</span>
<span id="cb25-14"><a href="figues-9-1-to-9-6.html#cb25-14"></a>age.mat[,<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">predict</span>(age.fp1, <span class="dt">newdata=</span><span class="kw">as.data.frame</span>(<span class="dt">x=</span>AGE))</span>
<span id="cb25-15"><a href="figues-9-1-to-9-6.html#cb25-15"></a>age.mat[,<span class="dv">4</span>] &lt;-<span class="st"> </span><span class="kw">predict</span>(age.rcs1, <span class="dt">newdata=</span><span class="kw">as.data.frame</span>(<span class="dt">x=</span>AGE), <span class="dt">type=</span><span class="st">&quot;lp&quot;</span>)</span>
<span id="cb25-16"><a href="figues-9-1-to-9-6.html#cb25-16"></a>age.mat[,<span class="dv">5</span>] &lt;-<span class="st"> </span><span class="kw">predict</span>(age.gam1, <span class="dt">newdata=</span><span class="kw">as.data.frame</span>(<span class="dt">x=</span>AGE))</span>
<span id="cb25-17"><a href="figues-9-1-to-9-6.html#cb25-17"></a></span>
<span id="cb25-18"><a href="figues-9-1-to-9-6.html#cb25-18"></a><span class="co"># Plot for n=785, Fig 9.3, part A #</span></span>
<span id="cb25-19"><a href="figues-9-1-to-9-6.html#cb25-19"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb25-20"><a href="figues-9-1-to-9-6.html#cb25-20"></a><span class="kw">plot</span>(<span class="dt">x=</span>age.mat[,<span class="dv">1</span>], <span class="dt">y=</span>age.mat[,<span class="dv">2</span>], <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">20</span>,<span class="dv">92</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">8</span>,<span class="fl">0.2</span>), <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb25-21"><a href="figues-9-1-to-9-6.html#cb25-21"></a>     <span class="dt">xlab=</span><span class="st">&#39;Age in years&#39;</span>, <span class="dt">ylab=</span><span class="st">&#39;logit of 30-day mortality&#39;</span>, <span class="dt">cex.lab=</span><span class="fl">1.2</span>, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span>mycolors[<span class="dv">2</span>])</span>
<span id="cb25-22"><a href="figues-9-1-to-9-6.html#cb25-22"></a><span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span><span class="kw">c</span>(<span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span> ,<span class="dv">70</span>, <span class="dv">80</span>,<span class="dv">90</span>))</span>
<span id="cb25-23"><a href="figues-9-1-to-9-6.html#cb25-23"></a><span class="kw">lines</span>(<span class="dt">x=</span>age.mat[,<span class="dv">1</span>], <span class="dt">y=</span>age.mat[,<span class="dv">3</span>], <span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span>mycolors[<span class="dv">3</span>])</span>
<span id="cb25-24"><a href="figues-9-1-to-9-6.html#cb25-24"></a><span class="kw">lines</span>(<span class="dt">x=</span>age.mat[,<span class="dv">1</span>], <span class="dt">y=</span>age.mat[,<span class="dv">4</span>], <span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">lwd=</span><span class="dv">3</span>, <span class="dt">col=</span>mycolors[<span class="dv">4</span>])</span>
<span id="cb25-25"><a href="figues-9-1-to-9-6.html#cb25-25"></a><span class="kw">lines</span>(<span class="dt">x=</span>age.mat[,<span class="dv">1</span>], <span class="dt">y=</span>age.mat[,<span class="dv">5</span>], <span class="dt">lty=</span><span class="dv">4</span>,<span class="dt">lwd=</span><span class="dv">3</span>, <span class="dt">col=</span>mycolors[<span class="dv">5</span>])</span>
<span id="cb25-26"><a href="figues-9-1-to-9-6.html#cb25-26"></a><span class="kw">histSpike</span>(<span class="dt">x=</span>gustos<span class="op">$</span>AGE, <span class="dt">side=</span><span class="dv">1</span>, <span class="dt">frac=</span>.<span class="dv">1</span>, <span class="dt">col=</span><span class="st">&quot;darkblue&quot;</span>, <span class="dt">add=</span>T)</span>
<span id="cb25-27"><a href="figues-9-1-to-9-6.html#cb25-27"></a><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;linear&quot;</span>,<span class="st">&quot;fp&quot;</span>, <span class="st">&quot;rcs&quot;</span>, <span class="st">&quot;gam&quot;</span>),</span>
<span id="cb25-28"><a href="figues-9-1-to-9-6.html#cb25-28"></a>       <span class="dt">lty=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">cex=</span><span class="fl">1.2</span>, <span class="dt">bty=</span><span class="st">&#39;n&#39;</span>,<span class="dt">col=</span>mycolors[<span class="dv">2</span><span class="op">:</span><span class="dv">5</span>])</span>
<span id="cb25-29"><a href="figues-9-1-to-9-6.html#cb25-29"></a><span class="kw">title</span>(<span class="st">&#39;GUSTO-I, n=785&#39;</span>)</span>
<span id="cb25-30"><a href="figues-9-1-to-9-6.html#cb25-30"></a><span class="co"># End plot n=785</span></span>
<span id="cb25-31"><a href="figues-9-1-to-9-6.html#cb25-31"></a></span>
<span id="cb25-32"><a href="figues-9-1-to-9-6.html#cb25-32"></a><span class="co">####################</span></span>
<span id="cb25-33"><a href="figues-9-1-to-9-6.html#cb25-33"></a><span class="co">## Now: N=40,830 ##</span></span>
<span id="cb25-34"><a href="figues-9-1-to-9-6.html#cb25-34"></a>age.linear<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">lrm</span>(DAY30<span class="op">~</span>AGE,<span class="dt">data=</span>gusto,<span class="dt">x=</span>T,<span class="dt">y=</span>T,<span class="dt">linear.predictors=</span>F)</span>
<span id="cb25-35"><a href="figues-9-1-to-9-6.html#cb25-35"></a>age.rcs1<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">lrm</span>(DAY30<span class="op">~</span><span class="kw">rcs</span>(AGE,<span class="dv">5</span>),<span class="dt">data=</span>gusto,<span class="dt">x=</span>T,<span class="dt">y=</span>T,<span class="dt">linear.predictors=</span>F)</span>
<span id="cb25-36"><a href="figues-9-1-to-9-6.html#cb25-36"></a>age.fp1<span class="fl">.2</span>  &lt;-<span class="st"> </span><span class="kw">mfp</span>(DAY30<span class="op">~</span><span class="kw">fp</span>(AGE,<span class="dt">df=</span><span class="dv">4</span>), <span class="dt">alpha=</span><span class="dv">1</span>,<span class="dt">data=</span>gusto,<span class="dt">family=</span>binomial) <span class="co"># selected: -2 and 3</span></span>
<span id="cb25-37"><a href="figues-9-1-to-9-6.html#cb25-37"></a>age.gam1<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">gam</span>(DAY30<span class="op">~</span><span class="kw">s</span>(AGE),<span class="dt">data=</span>gusto, <span class="dt">family=</span>binomial)</span>
<span id="cb25-38"><a href="figues-9-1-to-9-6.html#cb25-38"></a></span>
<span id="cb25-39"><a href="figues-9-1-to-9-6.html#cb25-39"></a><span class="co"># examine predictions for age 20:95</span></span>
<span id="cb25-40"><a href="figues-9-1-to-9-6.html#cb25-40"></a>age.mat<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">nrow=</span><span class="dv">751</span>,<span class="dt">ncol=</span><span class="dv">5</span>)</span>
<span id="cb25-41"><a href="figues-9-1-to-9-6.html#cb25-41"></a><span class="kw">names</span>(age.mat<span class="fl">.2</span>) &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>, <span class="kw">Cs</span>(AGE, linear, fp, rcs, gam))</span>
<span id="cb25-42"><a href="figues-9-1-to-9-6.html#cb25-42"></a>age.mat<span class="fl">.2</span>[,<span class="dv">1</span>] &lt;-<span class="st"> </span>AGE</span>
<span id="cb25-43"><a href="figues-9-1-to-9-6.html#cb25-43"></a>age.mat<span class="fl">.2</span>[,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">predict</span>(age.linear<span class="fl">.2</span>, <span class="dt">newdata=</span><span class="kw">as.data.frame</span>(<span class="dt">x=</span>AGE), <span class="dt">type=</span><span class="st">&quot;lp&quot;</span>)</span>
<span id="cb25-44"><a href="figues-9-1-to-9-6.html#cb25-44"></a>age.mat<span class="fl">.2</span>[,<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">predict</span>(age.fp1<span class="fl">.2</span>, <span class="dt">newdata=</span><span class="kw">as.data.frame</span>(<span class="dt">x=</span>AGE))</span>
<span id="cb25-45"><a href="figues-9-1-to-9-6.html#cb25-45"></a>age.mat<span class="fl">.2</span>[,<span class="dv">4</span>] &lt;-<span class="st"> </span><span class="kw">predict</span>(age.rcs1<span class="fl">.2</span>, <span class="dt">newdata=</span><span class="kw">as.data.frame</span>(<span class="dt">x=</span>AGE), <span class="dt">type=</span><span class="st">&quot;lp&quot;</span>)</span>
<span id="cb25-46"><a href="figues-9-1-to-9-6.html#cb25-46"></a>age.mat<span class="fl">.2</span>[,<span class="dv">5</span>] &lt;-<span class="st"> </span><span class="kw">predict</span>(age.gam1<span class="fl">.2</span>, <span class="dt">newdata=</span><span class="kw">as.data.frame</span>(<span class="dt">x=</span>AGE))</span>
<span id="cb25-47"><a href="figues-9-1-to-9-6.html#cb25-47"></a></span>
<span id="cb25-48"><a href="figues-9-1-to-9-6.html#cb25-48"></a><span class="co"># Plot for n=40830</span></span>
<span id="cb25-49"><a href="figues-9-1-to-9-6.html#cb25-49"></a><span class="kw">plot</span>(<span class="dt">x=</span>age.mat<span class="fl">.2</span>[,<span class="dv">1</span>], <span class="dt">y=</span>age.mat<span class="fl">.2</span>[,<span class="dv">2</span>], <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">20</span>,<span class="dv">92</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">8</span>,<span class="fl">0.2</span>), <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb25-50"><a href="figues-9-1-to-9-6.html#cb25-50"></a>     <span class="dt">xlab=</span><span class="st">&#39;Age in years&#39;</span>, <span class="dt">ylab=</span><span class="st">&#39;&#39;</span>, <span class="dt">cex.lab=</span><span class="fl">1.2</span>, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span>mycolors[<span class="dv">2</span>])</span>
<span id="cb25-51"><a href="figues-9-1-to-9-6.html#cb25-51"></a><span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span><span class="kw">c</span>(<span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span> ,<span class="dv">70</span>, <span class="dv">80</span>,<span class="dv">90</span>))</span>
<span id="cb25-52"><a href="figues-9-1-to-9-6.html#cb25-52"></a><span class="kw">lines</span>(<span class="dt">x=</span>age.mat<span class="fl">.2</span>[,<span class="dv">1</span>], <span class="dt">y=</span>age.mat<span class="fl">.2</span>[,<span class="dv">3</span>], <span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span>mycolors[<span class="dv">3</span>])</span>
<span id="cb25-53"><a href="figues-9-1-to-9-6.html#cb25-53"></a><span class="kw">lines</span>(<span class="dt">x=</span>age.mat<span class="fl">.2</span>[,<span class="dv">1</span>], <span class="dt">y=</span>age.mat<span class="fl">.2</span>[,<span class="dv">4</span>], <span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">lwd=</span><span class="dv">3</span>, <span class="dt">col=</span>mycolors[<span class="dv">4</span>])</span>
<span id="cb25-54"><a href="figues-9-1-to-9-6.html#cb25-54"></a><span class="kw">lines</span>(<span class="dt">x=</span>age.mat<span class="fl">.2</span>[,<span class="dv">1</span>], <span class="dt">y=</span>age.mat<span class="fl">.2</span>[,<span class="dv">5</span>], <span class="dt">lty=</span><span class="dv">4</span>,<span class="dt">lwd=</span><span class="dv">3</span>, <span class="dt">col=</span>mycolors[<span class="dv">5</span>])</span>
<span id="cb25-55"><a href="figues-9-1-to-9-6.html#cb25-55"></a><span class="kw">histSpike</span>(<span class="dt">x=</span>gusto<span class="op">$</span>AGE, <span class="dt">side=</span><span class="dv">1</span>, <span class="dt">frac=</span>.<span class="dv">2</span>, <span class="dt">col=</span><span class="st">&quot;darkblue&quot;</span>, <span class="dt">add=</span>T)</span>
<span id="cb25-56"><a href="figues-9-1-to-9-6.html#cb25-56"></a><span class="kw">title</span>(<span class="st">&#39;GUSTO-I, n=40,830&#39;</span>)</span></code></pre></div>
<p><img src="fig/Fig9.3-1.png" width="672" /></p>
</div>
<div id="fig-9.4-glucose-and-hb-in-tbi" class="section level3">
<h3><span class="header-section-number">10.0.4</span> Fig 9.4: Glucose and hb in TBI</h3>
<p>We evaluate the predictors ‘glucose’ and ‘hemoglobin’ in TBI. Both are first truncated, after inspecting boxplots (Fig 9.4), and then analyzed for their prognostic value, with plots for illustration of the estimated relations (Fig 9.5).</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="figues-9-1-to-9-6.html#cb26-1"></a><span class="co"># glucose</span></span>
<span id="cb26-2"><a href="figues-9-1-to-9-6.html#cb26-2"></a><span class="kw">quantile</span>(TBI<span class="op">$</span>glucose, <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">005</span>, <span class="fl">.01</span>, <span class="fl">.02</span>, <span class="fl">.98</span>, <span class="fl">.99</span>, <span class="fl">.995</span>), <span class="dt">na.rm =</span> T)</span></code></pre></div>
<pre><code>##  0.5%    1%    2%   98%   99% 99.5% 
##  1.57  2.26  4.28 18.34 20.92 23.39</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="figues-9-1-to-9-6.html#cb28-1"></a><span class="co">#  0.5%    1%    2%   98%   99% 99.5% </span></span>
<span id="cb28-2"><a href="figues-9-1-to-9-6.html#cb28-2"></a><span class="co">#  1.57  2.26  4.28 18.34 20.92 23.39 </span></span>
<span id="cb28-3"><a href="figues-9-1-to-9-6.html#cb28-3"></a><span class="co"># So, winsorize / truncate at 3 and 20</span></span>
<span id="cb28-4"><a href="figues-9-1-to-9-6.html#cb28-4"></a><span class="co"># use simple function to do the winsorizing:</span></span>
<span id="cb28-5"><a href="figues-9-1-to-9-6.html#cb28-5"></a><span class="co"># {ifelse(x&lt;lower,upper,  ifelse(x&gt;upper,upper, x))}</span></span>
<span id="cb28-6"><a href="figues-9-1-to-9-6.html#cb28-6"></a>winsorize &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">lower=</span><span class="kw">quantile</span>(x, <span class="dt">probs =</span> <span class="fl">0.01</span>), <span class="dt">upper=</span><span class="kw">quantile</span>(x, <span class="dt">probs =</span> <span class="fl">0.99</span>)) {</span>
<span id="cb28-7"><a href="figues-9-1-to-9-6.html#cb28-7"></a>        <span class="kw">ifelse</span>(x<span class="op">&lt;</span>lower,lower,</span>
<span id="cb28-8"><a href="figues-9-1-to-9-6.html#cb28-8"></a>               <span class="kw">ifelse</span>(x<span class="op">&gt;</span>upper,upper, x))}</span>
<span id="cb28-9"><a href="figues-9-1-to-9-6.html#cb28-9"></a>TBI<span class="op">$</span>glucoset &lt;-<span class="st"> </span><span class="kw">winsorize</span>(TBI<span class="op">$</span>glucose,<span class="dv">3</span>,<span class="dv">20</span>)</span>
<span id="cb28-10"><a href="figues-9-1-to-9-6.html#cb28-10"></a></span>
<span id="cb28-11"><a href="figues-9-1-to-9-6.html#cb28-11"></a><span class="co"># systolic bp</span></span>
<span id="cb28-12"><a href="figues-9-1-to-9-6.html#cb28-12"></a><span class="kw">quantile</span>(TBI<span class="op">$</span>hb, <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">005</span>, <span class="fl">.01</span>, <span class="fl">.02</span>, <span class="fl">.98</span>, <span class="fl">.99</span>, <span class="fl">.995</span>), <span class="dt">na.rm =</span> T)</span></code></pre></div>
<pre><code>##  0.5%    1%    2%   98%   99% 99.5% 
##  4.87  5.40  6.30 16.50 16.80 17.00</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="figues-9-1-to-9-6.html#cb30-1"></a><span class="co">#  0.5%    1%    2%   98%   99% 99.5% </span></span>
<span id="cb30-2"><a href="figues-9-1-to-9-6.html#cb30-2"></a><span class="co">#  4.87  5.40  6.30 16.50 16.80 17.00 </span></span>
<span id="cb30-3"><a href="figues-9-1-to-9-6.html#cb30-3"></a><span class="co"># So, winsorize / truncate at 6 and 17</span></span>
<span id="cb30-4"><a href="figues-9-1-to-9-6.html#cb30-4"></a>TBI<span class="op">$</span>hbt &lt;-<span class="st"> </span><span class="kw">winsorize</span>(TBI<span class="op">$</span>hb,<span class="dv">6</span>,<span class="dv">17</span>)</span>
<span id="cb30-5"><a href="figues-9-1-to-9-6.html#cb30-5"></a></span>
<span id="cb30-6"><a href="figues-9-1-to-9-6.html#cb30-6"></a><span class="co"># boxplots for illustration</span></span>
<span id="cb30-7"><a href="figues-9-1-to-9-6.html#cb30-7"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb30-8"><a href="figues-9-1-to-9-6.html#cb30-8"></a><span class="kw">boxplot</span>(<span class="dt">x=</span><span class="kw">cbind</span>(TBI<span class="op">$</span>glucose, TBI<span class="op">$</span>glucoset), <span class="dt">outcol=</span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, mycolors[<span class="dv">4</span>]), <span class="dt">border=</span>mycolors[<span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">4</span>)], <span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;glucose (mmol/L)&quot;</span>)</span>
<span id="cb30-9"><a href="figues-9-1-to-9-6.html#cb30-9"></a><span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;before &quot;</span>, <span class="st">&quot;after winsorizing&quot;</span>))</span>
<span id="cb30-10"><a href="figues-9-1-to-9-6.html#cb30-10"></a><span class="kw">title</span>(<span class="st">&quot;Glucose&quot;</span>)</span>
<span id="cb30-11"><a href="figues-9-1-to-9-6.html#cb30-11"></a><span class="kw">boxplot</span>(<span class="dt">x=</span><span class="kw">cbind</span>(TBI<span class="op">$</span>hb, TBI<span class="op">$</span>hbt), <span class="dt">outcol=</span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, mycolors[<span class="dv">4</span>]), <span class="dt">border=</span>mycolors[<span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">4</span>)], <span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;hb (mmol/L)&quot;</span>)</span>
<span id="cb30-12"><a href="figues-9-1-to-9-6.html#cb30-12"></a><span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;before &quot;</span>, <span class="st">&quot;after winsorizing&quot;</span>))</span>
<span id="cb30-13"><a href="figues-9-1-to-9-6.html#cb30-13"></a><span class="kw">title</span>(<span class="st">&quot;Hemoglobin&quot;</span>)</span></code></pre></div>
<p><img src="fig/Fig9.4-1.png" width="672" /></p>
</div>
<div id="fig-9.5-non-linear-association-of-glucose" class="section level3">
<h3><span class="header-section-number">10.0.5</span> Fig 9.5: Non-linear association of glucose</h3>
<p><img src="fig/Fig9.5-1.png" width="672" /></p>
</div>
<div id="fig-9.6-systolic-blood-pressure-in-tbi" class="section level3">
<h3><span class="header-section-number">10.0.6</span> Fig 9.6: Systolic blood pressure in TBI</h3>
<p>We now examine the prognostic value of systolic blood pressure (BP) in TBI patients.
We expect low BP (hypotension) to be especially risky.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="figues-9-1-to-9-6.html#cb31-1"></a><span class="kw">quantile</span>(TBI<span class="op">$</span>d.sysbpt, <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">01</span>, <span class="fl">.25</span>, <span class="fl">.75</span>, <span class="fl">.99</span>), <span class="dt">na.rm =</span> T)</span></code></pre></div>
<pre><code>##    1%   25%   75%   99% 
##  92.9 121.1 142.1 171.8</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="figues-9-1-to-9-6.html#cb33-1"></a>TBIs &lt;-<span class="st"> </span>TBI[<span class="op">!</span><span class="kw">is.na</span>(TBI<span class="op">$</span>d.sysbpt), ]</span>
<span id="cb33-2"><a href="figues-9-1-to-9-6.html#cb33-2"></a><span class="co">#   1%   25%   75%   99% </span></span>
<span id="cb33-3"><a href="figues-9-1-to-9-6.html#cb33-3"></a><span class="co"># 92.9 121.1 142.1 171.8 </span></span>
<span id="cb33-4"><a href="figues-9-1-to-9-6.html#cb33-4"></a></span>
<span id="cb33-5"><a href="figues-9-1-to-9-6.html#cb33-5"></a>g1 &lt;-<span class="st"> </span><span class="kw">lrm</span>(d.gos<span class="op">&lt;</span><span class="dv">2</span><span class="op">~</span><span class="kw">rcs</span>(d.sysbpt,<span class="dv">3</span>), <span class="dt">data=</span>TBIs)</span>
<span id="cb33-6"><a href="figues-9-1-to-9-6.html#cb33-6"></a>g2 &lt;-<span class="st"> </span><span class="kw">lrm</span>(d.gos<span class="op">&lt;</span><span class="dv">3</span><span class="op">~</span><span class="kw">rcs</span>(d.sysbpt,<span class="dv">3</span>), <span class="dt">data=</span>TBIs)</span>
<span id="cb33-7"><a href="figues-9-1-to-9-6.html#cb33-7"></a>g3 &lt;-<span class="st"> </span><span class="kw">lrm</span>(d.gos<span class="op">&lt;</span><span class="dv">4</span><span class="op">~</span><span class="kw">rcs</span>(d.sysbpt,<span class="dv">3</span>), <span class="dt">data=</span>TBIs)</span>
<span id="cb33-8"><a href="figues-9-1-to-9-6.html#cb33-8"></a>g4 &lt;-<span class="st"> </span><span class="kw">lrm</span>(d.gos<span class="op">&lt;</span><span class="dv">5</span><span class="op">~</span><span class="kw">rcs</span>(d.sysbpt,<span class="dv">3</span>), <span class="dt">data=</span>TBIs)</span>
<span id="cb33-9"><a href="figues-9-1-to-9-6.html#cb33-9"></a></span>
<span id="cb33-10"><a href="figues-9-1-to-9-6.html#cb33-10"></a><span class="co"># Define categorical variants of systolic BP</span></span>
<span id="cb33-11"><a href="figues-9-1-to-9-6.html#cb33-11"></a>TBIs<span class="op">$</span>d.sysbpt.c &lt;-<span class="st"> </span><span class="kw">as.factor</span>(<span class="kw">ifelse</span>(TBIs<span class="op">$</span>d.sysbpt<span class="op">&lt;</span><span class="dv">120</span>,<span class="dv">1</span>, <span class="kw">ifelse</span>(TBIs<span class="op">$</span>d.sysbpt<span class="op">&gt;</span><span class="dv">150</span>,<span class="dv">2</span>,<span class="dv">0</span>)))</span>
<span id="cb33-12"><a href="figues-9-1-to-9-6.html#cb33-12"></a></span>
<span id="cb33-13"><a href="figues-9-1-to-9-6.html#cb33-13"></a>g1t &lt;-<span class="st"> </span><span class="kw">lrm</span>(d.gos<span class="op">&lt;</span><span class="dv">2</span><span class="op">~</span>d.sysbpt.c, <span class="dt">data=</span>TBIs)</span>
<span id="cb33-14"><a href="figues-9-1-to-9-6.html#cb33-14"></a>g2t &lt;-<span class="st"> </span><span class="kw">lrm</span>(d.gos<span class="op">&lt;</span><span class="dv">3</span><span class="op">~</span>d.sysbpt.c, <span class="dt">data=</span>TBIs)</span>
<span id="cb33-15"><a href="figues-9-1-to-9-6.html#cb33-15"></a>g3t &lt;-<span class="st"> </span><span class="kw">lrm</span>(d.gos<span class="op">&lt;</span><span class="dv">4</span><span class="op">~</span>d.sysbpt.c, <span class="dt">data=</span>TBIs)</span>
<span id="cb33-16"><a href="figues-9-1-to-9-6.html#cb33-16"></a>g4t &lt;-<span class="st"> </span><span class="kw">lrm</span>(d.gos<span class="op">&lt;</span><span class="dv">5</span><span class="op">~</span>d.sysbpt.c, <span class="dt">data=</span>TBIs)</span>
<span id="cb33-17"><a href="figues-9-1-to-9-6.html#cb33-17"></a></span>
<span id="cb33-18"><a href="figues-9-1-to-9-6.html#cb33-18"></a>dd &lt;-<span class="st"> </span><span class="kw">datadist</span>(TBIs)</span>
<span id="cb33-19"><a href="figues-9-1-to-9-6.html#cb33-19"></a><span class="kw">options</span>(<span class="dt">datadist=</span><span class="st">&quot;dd&quot;</span>)</span>
<span id="cb33-20"><a href="figues-9-1-to-9-6.html#cb33-20"></a><span class="co"># Odds ratios</span></span>
<span id="cb33-21"><a href="figues-9-1-to-9-6.html#cb33-21"></a><span class="kw">exp</span>(<span class="kw">coef</span>(g1t)) <span class="co"># OR 2.78 for low BP and 1.25 for high BP</span></span></code></pre></div>
<pre><code>##    Intercept d.sysbpt.c=1 d.sysbpt.c=2 
##        0.226        2.777        1.245</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="figues-9-1-to-9-6.html#cb35-1"></a><span class="kw">describe</span>(TBI<span class="op">$</span>d.sysbpt)</span></code></pre></div>
<pre><code>## TBI$d.sysbpt 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25      .50      .75 
##     2159        0     1566        1    131.4    17.61    107.0    112.2    121.1    131.3    142.1 
##      .90      .95 
##    151.1    156.2 
## 
## lowest :  60.0  64.2  65.6  71.3  73.7, highest: 182.9 184.2 184.7 188.3 207.4</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="figues-9-1-to-9-6.html#cb37-1"></a><span class="kw">describe</span>(TBIs<span class="op">$</span>d.sysbpt.c)</span></code></pre></div>
<pre><code>## TBIs$d.sysbpt.c 
##        n  missing distinct 
##     2159        0        3 
##                             
## Value          0     1     2
## Frequency   1435   474   250
## Proportion 0.665 0.220 0.116</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="figues-9-1-to-9-6.html#cb39-1"></a><span class="co"># data in matrix for plot</span></span>
<span id="cb39-2"><a href="figues-9-1-to-9-6.html#cb39-2"></a>d.sysbpt &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">60</span>, <span class="dv">210</span>, <span class="dt">by=</span><span class="dv">1</span>) <span class="co"># 151 elements</span></span>
<span id="cb39-3"><a href="figues-9-1-to-9-6.html#cb39-3"></a>g.mat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">nrow=</span><span class="dv">151</span>,<span class="dt">ncol=</span><span class="dv">5</span>)</span>
<span id="cb39-4"><a href="figues-9-1-to-9-6.html#cb39-4"></a><span class="kw">names</span>(g.mat) &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>, <span class="kw">Cs</span>(d.sysbpt, g1, g2, g3, g4))</span>
<span id="cb39-5"><a href="figues-9-1-to-9-6.html#cb39-5"></a>g.mat[,<span class="dv">1</span>] &lt;-<span class="st"> </span>d.sysbpt</span>
<span id="cb39-6"><a href="figues-9-1-to-9-6.html#cb39-6"></a>g.mat[,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">predict</span>(g1, <span class="dt">newdata=</span><span class="kw">as.data.frame</span>(<span class="dt">x=</span>d.sysbpt))</span>
<span id="cb39-7"><a href="figues-9-1-to-9-6.html#cb39-7"></a>g.mat[,<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">predict</span>(g2, <span class="dt">newdata=</span><span class="kw">as.data.frame</span>(<span class="dt">x=</span>d.sysbpt))</span>
<span id="cb39-8"><a href="figues-9-1-to-9-6.html#cb39-8"></a>g.mat[,<span class="dv">4</span>] &lt;-<span class="st"> </span><span class="kw">predict</span>(g3, <span class="dt">newdata=</span><span class="kw">as.data.frame</span>(<span class="dt">x=</span>d.sysbpt))</span>
<span id="cb39-9"><a href="figues-9-1-to-9-6.html#cb39-9"></a>g.mat[,<span class="dv">5</span>] &lt;-<span class="st"> </span><span class="kw">predict</span>(g4, <span class="dt">newdata=</span><span class="kw">as.data.frame</span>(<span class="dt">x=</span>d.sysbpt))</span>
<span id="cb39-10"><a href="figues-9-1-to-9-6.html#cb39-10"></a></span>
<span id="cb39-11"><a href="figues-9-1-to-9-6.html#cb39-11"></a><span class="co"># Plot: Fig 9.6, part I</span></span>
<span id="cb39-12"><a href="figues-9-1-to-9-6.html#cb39-12"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb39-13"><a href="figues-9-1-to-9-6.html#cb39-13"></a><span class="kw">plot</span>(<span class="dt">x=</span>g.mat[,<span class="dv">1</span>], <span class="dt">y=</span>g.mat[,<span class="dv">2</span>], <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">50</span>,<span class="dv">210</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">2.7</span>,<span class="fl">2.7</span>), <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb39-14"><a href="figues-9-1-to-9-6.html#cb39-14"></a>     <span class="dt">xlab=</span><span class="st">&#39;Systolic blood pressure (mmHg)&#39;</span>, <span class="dt">ylab=</span><span class="st">&#39;logit GOS at 6 months&#39;</span>, <span class="dt">cex.lab=</span><span class="fl">1.2</span>, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span>mycolors[<span class="dv">1</span>])</span>
<span id="cb39-15"><a href="figues-9-1-to-9-6.html#cb39-15"></a><span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span><span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>))</span>
<span id="cb39-16"><a href="figues-9-1-to-9-6.html#cb39-16"></a><span class="kw">lines</span>(<span class="dt">x=</span>g.mat[,<span class="dv">1</span>], <span class="dt">y=</span>g.mat[,<span class="dv">3</span>], <span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span>mycolors[<span class="dv">2</span>])</span>
<span id="cb39-17"><a href="figues-9-1-to-9-6.html#cb39-17"></a><span class="kw">lines</span>(<span class="dt">x=</span>g.mat[,<span class="dv">1</span>], <span class="dt">y=</span>g.mat[,<span class="dv">4</span>], <span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">lwd=</span><span class="dv">3</span>, <span class="dt">col=</span>mycolors[<span class="dv">3</span>])</span>
<span id="cb39-18"><a href="figues-9-1-to-9-6.html#cb39-18"></a><span class="kw">lines</span>(<span class="dt">x=</span>g.mat[,<span class="dv">1</span>], <span class="dt">y=</span>g.mat[,<span class="dv">5</span>], <span class="dt">lty=</span><span class="dv">4</span>,<span class="dt">lwd=</span><span class="dv">3</span>, <span class="dt">col=</span>mycolors[<span class="dv">4</span>])</span>
<span id="cb39-19"><a href="figues-9-1-to-9-6.html#cb39-19"></a><span class="kw">histSpike</span>(<span class="dt">x=</span>TBI<span class="op">$</span>d.sysbpt, <span class="dt">side=</span><span class="dv">3</span>, <span class="dt">frac=</span>.<span class="dv">2</span>, <span class="dt">col=</span><span class="st">&quot;darkblue&quot;</span>, <span class="dt">add=</span>T)</span>
<span id="cb39-20"><a href="figues-9-1-to-9-6.html#cb39-20"></a><span class="kw">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;&lt;good recovery&quot;</span>, <span class="st">&quot;unfavorable&quot;</span>, <span class="st">&quot;mort+veg&quot;</span>, <span class="st">&quot;mortality&quot;</span>), <span class="dt">lty=</span><span class="dv">4</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">cex=</span><span class="fl">0.8</span>, <span class="dt">bty=</span><span class="st">&#39;n&#39;</span>,<span class="dt">col=</span>mycolors[<span class="dv">4</span><span class="op">:</span><span class="dv">1</span>])</span>
<span id="cb39-21"><a href="figues-9-1-to-9-6.html#cb39-21"></a><span class="kw">title</span>(<span class="st">&quot;continuous, rcs 3 knots&quot;</span>)</span>
<span id="cb39-22"><a href="figues-9-1-to-9-6.html#cb39-22"></a></span>
<span id="cb39-23"><a href="figues-9-1-to-9-6.html#cb39-23"></a><span class="co">## Plot 9.6, part II</span></span>
<span id="cb39-24"><a href="figues-9-1-to-9-6.html#cb39-24"></a>d.sysbpt.c &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb39-25"><a href="figues-9-1-to-9-6.html#cb39-25"></a>d.sysbpt &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">60</span>, <span class="dv">210</span>, <span class="dt">by=</span>.<span class="dv">1</span>) <span class="co"># 1501 elements</span></span>
<span id="cb39-26"><a href="figues-9-1-to-9-6.html#cb39-26"></a>g.mat2 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">nrow=</span><span class="dv">1501</span>,<span class="dt">ncol=</span><span class="dv">5</span>)</span>
<span id="cb39-27"><a href="figues-9-1-to-9-6.html#cb39-27"></a>g1t.c &lt;-<span class="st"> </span><span class="kw">predict</span>(g1t, <span class="dt">newdata=</span><span class="kw">as.data.frame</span>(<span class="dt">x=</span>d.sysbpt.c))</span>
<span id="cb39-28"><a href="figues-9-1-to-9-6.html#cb39-28"></a>g2t.c &lt;-<span class="st"> </span><span class="kw">predict</span>(g2t, <span class="dt">newdata=</span><span class="kw">as.data.frame</span>(<span class="dt">x=</span>d.sysbpt.c))</span>
<span id="cb39-29"><a href="figues-9-1-to-9-6.html#cb39-29"></a>g3t.c &lt;-<span class="st"> </span><span class="kw">predict</span>(g3t, <span class="dt">newdata=</span><span class="kw">as.data.frame</span>(<span class="dt">x=</span>d.sysbpt.c))</span>
<span id="cb39-30"><a href="figues-9-1-to-9-6.html#cb39-30"></a>g4t.c &lt;-<span class="st"> </span><span class="kw">predict</span>(g4t, <span class="dt">newdata=</span><span class="kw">as.data.frame</span>(<span class="dt">x=</span>d.sysbpt.c))</span>
<span id="cb39-31"><a href="figues-9-1-to-9-6.html#cb39-31"></a></span>
<span id="cb39-32"><a href="figues-9-1-to-9-6.html#cb39-32"></a><span class="kw">names</span>(g.mat2) &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>, <span class="kw">Cs</span>(d.sysbpt, g1, g2, g3, g4))</span>
<span id="cb39-33"><a href="figues-9-1-to-9-6.html#cb39-33"></a>g.mat2[,<span class="dv">1</span>] &lt;-<span class="st"> </span>d.sysbpt</span>
<span id="cb39-34"><a href="figues-9-1-to-9-6.html#cb39-34"></a>g.mat2[,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(d.sysbpt<span class="op">&lt;</span><span class="dv">120</span>, g1t.c[<span class="dv">2</span>], <span class="kw">ifelse</span>(d.sysbpt<span class="op">&gt;</span><span class="dv">150</span>, g1t.c[<span class="dv">3</span>], g1t.c[<span class="dv">1</span>]))</span>
<span id="cb39-35"><a href="figues-9-1-to-9-6.html#cb39-35"></a>g.mat2[,<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(d.sysbpt<span class="op">&lt;</span><span class="dv">120</span>, g2t.c[<span class="dv">2</span>], <span class="kw">ifelse</span>(d.sysbpt<span class="op">&gt;</span><span class="dv">150</span>, g2t.c[<span class="dv">3</span>], g2t.c[<span class="dv">1</span>]))</span>
<span id="cb39-36"><a href="figues-9-1-to-9-6.html#cb39-36"></a>g.mat2[,<span class="dv">4</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(d.sysbpt<span class="op">&lt;</span><span class="dv">120</span>, g3t.c[<span class="dv">2</span>], <span class="kw">ifelse</span>(d.sysbpt<span class="op">&gt;</span><span class="dv">150</span>, g3t.c[<span class="dv">3</span>], g3t.c[<span class="dv">1</span>]))</span>
<span id="cb39-37"><a href="figues-9-1-to-9-6.html#cb39-37"></a>g.mat2[,<span class="dv">5</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(d.sysbpt<span class="op">&lt;</span><span class="dv">120</span>, g4t.c[<span class="dv">2</span>], <span class="kw">ifelse</span>(d.sysbpt<span class="op">&gt;</span><span class="dv">150</span>, g4t.c[<span class="dv">3</span>], g4t.c[<span class="dv">1</span>]))</span>
<span id="cb39-38"><a href="figues-9-1-to-9-6.html#cb39-38"></a></span>
<span id="cb39-39"><a href="figues-9-1-to-9-6.html#cb39-39"></a><span class="co"># Plot</span></span>
<span id="cb39-40"><a href="figues-9-1-to-9-6.html#cb39-40"></a><span class="kw">plot</span>(<span class="dt">x=</span>g.mat2[,<span class="dv">1</span>], <span class="dt">y=</span>g.mat2[,<span class="dv">2</span>], <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">50</span>,<span class="dv">210</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">2.7</span>,<span class="fl">2.7</span>), <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb39-41"><a href="figues-9-1-to-9-6.html#cb39-41"></a>     <span class="dt">xlab=</span><span class="st">&#39;Systolic blood pressure (mmHg)&#39;</span>, <span class="dt">ylab=</span><span class="st">&#39;&#39;</span>, <span class="dt">cex.lab=</span><span class="fl">1.2</span>, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span>mycolors[<span class="dv">1</span>])</span>
<span id="cb39-42"><a href="figues-9-1-to-9-6.html#cb39-42"></a><span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span><span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>))</span>
<span id="cb39-43"><a href="figues-9-1-to-9-6.html#cb39-43"></a><span class="kw">lines</span>(<span class="dt">x=</span>g.mat2[,<span class="dv">1</span>], <span class="dt">y=</span>g.mat2[,<span class="dv">3</span>], <span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span>mycolors[<span class="dv">2</span>])</span>
<span id="cb39-44"><a href="figues-9-1-to-9-6.html#cb39-44"></a><span class="kw">lines</span>(<span class="dt">x=</span>g.mat2[,<span class="dv">1</span>], <span class="dt">y=</span>g.mat2[,<span class="dv">4</span>], <span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">lwd=</span><span class="dv">3</span>, <span class="dt">col=</span>mycolors[<span class="dv">3</span>])</span>
<span id="cb39-45"><a href="figues-9-1-to-9-6.html#cb39-45"></a><span class="kw">lines</span>(<span class="dt">x=</span>g.mat2[,<span class="dv">1</span>], <span class="dt">y=</span>g.mat2[,<span class="dv">5</span>], <span class="dt">lty=</span><span class="dv">4</span>,<span class="dt">lwd=</span><span class="dv">3</span>, <span class="dt">col=</span>mycolors[<span class="dv">4</span>])</span>
<span id="cb39-46"><a href="figues-9-1-to-9-6.html#cb39-46"></a><span class="kw">histSpike</span>(<span class="dt">x=</span>TBI<span class="op">$</span>d.sysbpt, <span class="dt">side=</span><span class="dv">3</span>, <span class="dt">frac=</span>.<span class="dv">2</span>, <span class="dt">col=</span><span class="st">&quot;darkblue&quot;</span>, <span class="dt">add=</span>T)</span>
<span id="cb39-47"><a href="figues-9-1-to-9-6.html#cb39-47"></a><span class="kw">title</span>(<span class="st">&quot;3 categories&quot;</span>)</span></code></pre></div>
<p><img src="fig/Fig9.6-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ch-coding.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ch-restrictions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
