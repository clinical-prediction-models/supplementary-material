<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>18&nbsp; Presentation Formats – Clinical Prediction Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/19-external-validity.html" rel="next">
<link href="../chapters/17-validation.html" rel="prev">
<link href="../cover-snippet.PNG" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-22f1e9abd69a6835ab4f2e41b1700194.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>

<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">



</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/07-missing.html">Part II: Developing Valid Prediction Models</a></li><li class="breadcrumb-item"><a href="../chapters/18-presentation.html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Presentation Formats</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../cover-snippet.PNG" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../"></a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/clinical-prediction-models/supplementary-material" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Prediction Models in Medicine</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-applications-pred-mods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Applications of Prediction Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Study Design for Prediction Modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-stat-mods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Statistical Models for Prediction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05-overfitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overfitting and Optimism in Prediction Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06-choosing-alt-mods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Choosing Between Alternative Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: Developing Valid Prediction Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-missing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Missing values</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/08-case-study-missing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Case Study on Dealing with Missing Values</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09-coding-categ-contin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Coding of Categorical and Continuous Predictors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10-restrict-cand-pred.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Restrictions on Candidate Predictors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11-main-effects-select.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Selection of Main Effects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12-additivity-linearity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Assumptions in Regression Models - Additivity and Linearity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/13-modern-estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Modern Estimation Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/14-estimation-external.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Estimation with External Information</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/15-evaluation-performance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Evaluation of Performance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/16-clinical-usefulness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Evaluation of Clinical Usefulness</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/17-validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Validation of Prediction Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/18-presentation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Presentation Formats</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: Generalizability of Prediction Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/19-external-validity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Patterns of External Validity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/20-updating.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Updating for a New Setting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/21-updating-multiple.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Updating for Multiple Settings</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Part IV: Applications</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/22-case-study-gusto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Case Study on a Prediction of 30-Day Mortality</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/23-case-study-cardiovascular.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Case Study on Survival Analysis: Prediction of Cardiovascular Event</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/24-lessons-datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Overall Lessons and Data Sets</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#fit-logistic-models-in-n544-data-set-6-predictors" id="toc-fit-logistic-models-in-n544-data-set-6-predictors" class="nav-link active" data-scroll-target="#fit-logistic-models-in-n544-data-set-6-predictors">Fit logistic models in n544 data set; 6 predictors</a>
  <ul>
  <li><a href="#internal-validation-by-bootstrapping" id="toc-internal-validation-by-bootstrapping" class="nav-link" data-scroll-target="#internal-validation-by-bootstrapping">Internal validation by bootstrapping</a></li>
  <li><a href="#shrunk-model-and-penalization" id="toc-shrunk-model-and-penalization" class="nav-link" data-scroll-target="#shrunk-model-and-penalization">Shrunk model and penalization</a></li>
  <li><a href="#fit-penalized-model-and-compare-fits" id="toc-fit-penalized-model-and-compare-fits" class="nav-link" data-scroll-target="#fit-penalized-model-and-compare-fits">Fit penalized model and compare fits</a></li>
  </ul></li>
  <li><a href="#fig-18.1" id="toc-fig-18.1" class="nav-link" data-scroll-target="#fig-18.1">Fig 18.1</a>
  <ul>
  <li><a href="#make-nomogram-from-penalized-model" id="toc-make-nomogram-from-penalized-model" class="nav-link" data-scroll-target="#make-nomogram-from-penalized-model">Make nomogram from penalized model</a></li>
  <li><a href="#score-chart-creation-with-categorized-and-continuous-predictors" id="toc-score-chart-creation-with-categorized-and-continuous-predictors" class="nav-link" data-scroll-target="#score-chart-creation-with-categorized-and-continuous-predictors">Score chart creation with categorized and continuous predictors</a></li>
  <li><a href="#consider-making-rounded-scores-from-penalized-coefs" id="toc-consider-making-rounded-scores-from-penalized-coefs" class="nav-link" data-scroll-target="#consider-making-rounded-scores-from-penalized-coefs">Consider making rounded scores from penalized coefs</a></li>
  </ul></li>
  <li><a href="#scores-for-continuous-predictors" id="toc-scores-for-continuous-predictors" class="nav-link" data-scroll-target="#scores-for-continuous-predictors">Scores for continuous predictors</a>
  <ul>
  <li><a href="#ldh" id="toc-ldh" class="nav-link" data-scroll-target="#ldh">LDH</a></li>
  <li><a href="#study-scores-for-postchemotherapy-size" id="toc-study-scores-for-postchemotherapy-size" class="nav-link" data-scroll-target="#study-scores-for-postchemotherapy-size">Study scores for postchemotherapy size</a></li>
  <li><a href="#study-scores-for-reduction-in-size" id="toc-study-scores-for-reduction-in-size" class="nav-link" data-scroll-target="#study-scores-for-reduction-in-size">Study scores for reduction in size</a></li>
  </ul></li>
  <li><a href="#table-18.2" id="toc-table-18.2" class="nav-link" data-scroll-target="#table-18.2">Table 18.2</a>
  <ul>
  <li><a href="#make-a-score-chart" id="toc-make-a-score-chart" class="nav-link" data-scroll-target="#make-a-score-chart">Make a score chart</a></li>
  </ul></li>
  <li><a href="#fig-18.2" id="toc-fig-18.2" class="nav-link" data-scroll-target="#fig-18.2">Fig 18.2</a>
  <ul>
  <li><a href="#translate-score-in-probability-estimates-with-95-ci" id="toc-translate-score-in-probability-estimates-with-95-ci" class="nav-link" data-scroll-target="#translate-score-in-probability-estimates-with-95-ci">Translate score in probability estimates with 95% CI</a></li>
  </ul></li>
  <li><a href="#end-table-18.2-score-chart-and-fig-18.2-graphic-translation-from-score-to-probability" id="toc-end-table-18.2-score-chart-and-fig-18.2-graphic-translation-from-score-to-probability" class="nav-link" data-scroll-target="#end-table-18.2-score-chart-and-fig-18.2-graphic-translation-from-score-to-probability">End Table 18.2 (score chart) and Fig 18.2 (graphic translation from score to probability)</a>
  <ul>
  <li><a href="#categorized-coding" id="toc-categorized-coding" class="nav-link" data-scroll-target="#categorized-coding">Categorized coding</a></li>
  </ul></li>
  <li><a href="#table-18.3" id="toc-table-18.3" class="nav-link" data-scroll-target="#table-18.3">Table 18.3</a>
  <ul>
  <li><a href="#alternative-make-a-score-from-0---5" id="toc-alternative-make-a-score-from-0---5" class="nav-link" data-scroll-target="#alternative-make-a-score-from-0---5">Alternative: make a score from 0 - 5</a></li>
  </ul></li>
  <li><a href="#fig-18.3" id="toc-fig-18.3" class="nav-link" data-scroll-target="#fig-18.3">Fig 18.3</a>
  <ul>
  <li><a href="#iso-probability-lines" id="toc-iso-probability-lines" class="nav-link" data-scroll-target="#iso-probability-lines">Iso-probability lines</a></li>
  </ul></li>
  <li><a href="#fig-18.4" id="toc-fig-18.4" class="nav-link" data-scroll-target="#fig-18.4">Fig 18.4</a>
  <ul>
  <li><a href="#meta-model-with-tree-presentation" id="toc-meta-model-with-tree-presentation" class="nav-link" data-scroll-target="#meta-model-with-tree-presentation">Meta-model with tree presentation</a></li>
  </ul></li>
  <li><a href="#apparent-performance-of-penalized-vs-rescaled-vs-simplified-models" id="toc-apparent-performance-of-penalized-vs-rescaled-vs-simplified-models" class="nav-link" data-scroll-target="#apparent-performance-of-penalized-vs-rescaled-vs-simplified-models">Apparent performance of penalized vs rescaled vs simplified models</a>
  <ul>
  <li><a href="#end-comparisons-of-c-statistics" id="toc-end-comparisons-of-c-statistics" class="nav-link" data-scroll-target="#end-comparisons-of-c-statistics">End comparisons of c statistics</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/clinical-prediction-models/supplementary-material/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/07-missing.html">Part II: Developing Valid Prediction Models</a></li><li class="breadcrumb-item"><a href="../chapters/18-presentation.html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Presentation Formats</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="presentation" class="quarto-section-identifier"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Presentation Formats</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Show/hide all code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="fit-logistic-models-in-n544-data-set-6-predictors" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="fit-logistic-models-in-n544-data-set-6-predictors">Fit logistic models in n544 data set; 6 predictors</h2>
<p>We develop a prediction model with 6 predictors for presence of residual tumor in 544 men treated for metastatic nonseminomatous testicular cancer. Predictors were pre-specified based on review of the medical <a href="https://www.ncbi.nlm.nih.gov/pubmed/7999405">literature</a>.</p>
<ol type="1">
<li><p>We first consider and full model and 2 shrinkage variants: uniform shrinkage and a penalized model.</p></li>
<li><p>We then study various formats for presentation of the prediction model for application in medical practice. The formats differ in user-friendliness and accuracy: for some simplifications we sacrifice nearly nothing and for other a lot in terms of c statistic. The formats are:<br>
</p></li>
</ol>
<ol type="a">
<li>nomogram (Fig 18.1)</li>
<li>score chart (Table 18.2 and Fig 18.2)</li>
<li>simple table (Table 18.3)</li>
<li>iso-probability lines (Fig 18.3)</li>
<li>tree on a meta-model (Fig 18.4)</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a full 6 predictor model in n544</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">prType=</span><span class="st">'html'</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span>(<span class="fu">describe</span>(n544), <span class="at">scroll=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div style="width: 100ex; overflow: auto; height: 25ex;">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<style>
.earrows {color:silver;font-size:11px;}

fcap {
 font-family: Verdana;
 font-size: 12px;
 color: MidnightBlue
 }

smg {
 font-family: Verdana;
 font-size: 10px;
 color: &#808080;
}

hr.thinhr { margin-top: 0.15em; margin-bottom: 0.15em; }

span.xscript {
position: relative;
}
span.xscript sub {
position: absolute;
left: 0.1em;
bottom: -1ex;
}
</style>

<title>n544 Descriptives</title>
<font color="MidnightBlue"><div align="center"><span style="font-weight:bold">n544 <br><br> 11  Variables   544  Observations</span></div></font>
<hr class="thinhr">
<span style="font-weight:bold">Teratoma</span>
<style>
 .hmisctable354146 {
 border: none;
 font-size: 85%;
 }
 .hmisctable354146 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable354146 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table data-quarto-disable-processing="true" class="hmisctable354146">
 <tbody><tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Sum</th><th>Mean</th><th>Gmd</th></tr>
 <tr><td>544</td><td>0</td><td>2</td><td>0.746</td><td>252</td><td>0.4632</td><td>0.4982</td></tr>
 </tbody></table>

<hr class="thinhr">
<span style="font-weight:bold">Pre.AFP</span>
<style>
 .hmisctable156894 {
 border: none;
 font-size: 85%;
 }
 .hmisctable156894 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable156894 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table data-quarto-disable-processing="true" class="hmisctable156894">
 <tbody><tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Sum</th><th>Mean</th><th>Gmd</th></tr>
 <tr><td>544</td><td>0</td><td>2</td><td>0.675</td><td>186</td><td>0.3419</td><td>0.4508</td></tr>
 </tbody></table>

<hr class="thinhr">
<span style="font-weight:bold">Pre.HCG</span>
<style>
 .hmisctable948428 {
 border: none;
 font-size: 85%;
 }
 .hmisctable948428 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable948428 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table data-quarto-disable-processing="true" class="hmisctable948428">
 <tbody><tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Sum</th><th>Mean</th><th>Gmd</th></tr>
 <tr><td>544</td><td>0</td><td>2</td><td>0.704</td><td>205</td><td>0.3768</td><td>0.4705</td></tr>
 </tbody></table>

<hr class="thinhr">
<span style="font-weight:bold">Pre.lnLDH</span><div style="float: right; text-align: right;"><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAJcAAAANCAMAAACTvAxuAAAACVBMVEUAAADMzMz////1iUV5AAAAlklEQVQ4jc2TCw6AIAxDB/c/tMIYjEhGkY82UZzM9DlScrjo1kD7lMjjClwD7VOCjBLOL7mIlSGRb/ZyCY7m6rt+ydX2tvZwLjuAHMKy6oL3H+3p7WR0zb8qc8rzahZqRCTh2HSO+bQI00EukKga3HBsz3A1R+jfYK7jQphrSIs1pIaTwymSIuZqmZx+iFe0KsYk9nK/AF6VChag76rRAAAAAElFTkSuQmCC" alt="image"></div>
<pre style="font-size:85%;">        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
      544        0      472        1   0.4582   0.7327 -0.38735 -0.26645 -0.03266 
      .50      .75      .90      .95 
  0.31299  0.92886  1.33528  1.65328  </pre>

<style>
 .hmisctable959513 {
 border: none;
 font-size: 85%;
 }
 .hmisctable959513 td {
 text-align: right;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable959513 th {
 color: Black;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: bold;
 }
 </style>
 <table data-quarto-disable-processing="true" class="hmisctable959513">
 <tbody><tr><td><font color="MidnightBlue">lowest</font>&nbsp;:</td><td>-1.06582 </td><td>-0.948039</td><td>-0.766913</td><td>-0.731368</td><td>-0.564972</td></tr>
 <tr><td><font color="MidnightBlue">highest</font>:</td><td>2.42812  </td><td>2.44938  </td><td>2.48708  </td><td>2.6237   </td><td>2.76577  </td></tr>
 </tbody></table>

<hr class="thinhr">
<span style="font-weight:bold">sqpost</span><div style="float: right; text-align: right;"><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAJcAAAANCAMAAACTvAxuAAAACVBMVEUAAADMzMz////1iUV5AAAAgElEQVQ4je2TbQuAIAyEb/3/H501y+nOMJLhhw72Ig59FA7iBPA+VNicAN6HamGu9u5vXJNe8nO9PKZ4rq1Vzza5keY42PxXXW12mwH/NcAFMhTNldIA18PlC3A1IwFchi63jqt+wHwuddBZcIQmIiErKYt8gPrxittdrPS9mGIHtHsMDJxFbRkAAAAASUVORK5CYII=" alt="image"></div>
<style>
 .hmisctable907358 {
 border: none;
 font-size: 74%;
 }
 .hmisctable907358 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable907358 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table data-quarto-disable-processing="true" class="hmisctable907358">
 <tbody><tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Mean</th><th>Gmd</th><th>.05</th><th>.10</th><th>.25</th><th>.50</th><th>.75</th><th>.90</th><th>.95</th></tr>
 <tr><td>544</td><td>0</td><td>93</td><td>0.996</td><td>5.133</td><td>2.922</td><td> 1.414</td><td> 2.236</td><td> 3.162</td><td> 4.472</td><td> 6.652</td><td> 9.669</td><td>10.000</td></tr>
 </tbody></table>

<span style="font-size: 85%;"><font color="MidnightBlue">lowest</font>&nbsp;: 1.41421 1.73205 2       2.05477 2.23607 ,  <font color="MidnightBlue">highest</font>: 10.9545 12.2474 13.0384 13.784  17.3205</span>
<hr class="thinhr">
<span style="font-weight:bold">reduc10</span><div style="float: right; text-align: right;"><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAJcAAAANCAMAAACTvAxuAAAACVBMVEUAAADMzMz////1iUV5AAAAf0lEQVQ4je2T3Q6AIAiFj73/Qxdp8jNomdO6kDmHB6RPDaQhBvQW2IYYeusurrbo4mqL9vZN1E63dR9Ev70vN23yOwopu8d8Dpv7Jy6ZP4ur+IoLhYi5DPVrLi5kz6s1CAjJoqzqzEX/ftQYQQPRCqg7yc1S2UVL35KYff362A74CgwjAQ4HMgAAAABJRU5ErkJggg==" alt="image"></div>
<style>
 .hmisctable182406 {
 border: none;
 font-size: 74%;
 }
 .hmisctable182406 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable182406 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table data-quarto-disable-processing="true" class="hmisctable182406">
 <tbody><tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Mean</th><th>Gmd</th><th>.05</th><th>.10</th><th>.25</th><th>.50</th><th>.75</th><th>.90</th><th>.95</th></tr>
 <tr><td>544</td><td>0</td><td>200</td><td>0.998</td><td>4.482</td><td>4.307</td><td>-2.500</td><td> 0.000</td><td> 2.000</td><td> 5.167</td><td> 7.337</td><td> 8.785</td><td>10.000</td></tr>
 </tbody></table>

<span style="font-size: 85%;"><font color="MidnightBlue">lowest</font>&nbsp;: -13.8095 -10      -8.33333 -8.10811 -6       ,  <font color="MidnightBlue">highest</font>: 9.125    9.16667  9.28571  9.33333  10      </span>
<hr class="thinhr">
<span style="font-weight:bold">Necrosis</span>
<style>
 .hmisctable543952 {
 border: none;
 font-size: 85%;
 }
 .hmisctable543952 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable543952 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table data-quarto-disable-processing="true" class="hmisctable543952">
 <tbody><tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Sum</th><th>Mean</th><th>Gmd</th></tr>
 <tr><td>544</td><td>0</td><td>2</td><td>0.743</td><td>245</td><td>0.4504</td><td>0.496</td></tr>
 </tbody></table>

<hr class="thinhr">
<span style="font-weight:bold">Tumor</span>
<style>
 .hmisctable128601 {
 border: none;
 font-size: 85%;
 }
 .hmisctable128601 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable128601 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table data-quarto-disable-processing="true" class="hmisctable128601">
 <tbody><tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Sum</th><th>Mean</th><th>Gmd</th></tr>
 <tr><td>544</td><td>0</td><td>2</td><td>0.743</td><td>299</td><td>0.5496</td><td>0.496</td></tr>
 </tbody></table>

<hr class="thinhr">
<span style="font-weight:bold">Reduction</span><div style="float: right; text-align: right;"><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAJcAAAANCAMAAACTvAxuAAAACVBMVEUAAADMzMz////1iUV5AAAAf0lEQVQ4je2T3Q6AIAiFj73/Qxdp8jNomdO6kDmHB6RPDaQhBvQW2IYYeusurrbo4mqL9vZN1E63dR9Ev70vN23yOwopu8d8Dpv7Jy6ZP4ur+IoLhYi5DPVrLi5kz6s1CAjJoqzqzEX/ftQYQQPRCqg7yc1S2UVL35KYff362A74CgwjAQ4HMgAAAABJRU5ErkJggg==" alt="image"></div>
<style>
 .hmisctable186540 {
 border: none;
 font-size: 74%;
 }
 .hmisctable186540 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable186540 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table data-quarto-disable-processing="true" class="hmisctable186540">
 <tbody><tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Mean</th><th>Gmd</th><th>.05</th><th>.10</th><th>.25</th><th>.50</th><th>.75</th><th>.90</th><th>.95</th></tr>
 <tr><td>544</td><td>0</td><td>200</td><td>0.998</td><td>44.82</td><td>43.07</td><td>-25.00</td><td>  0.00</td><td> 20.00</td><td> 51.67</td><td> 73.37</td><td> 87.85</td><td>100.00</td></tr>
 </tbody></table>

<span style="font-size: 85%;"><font color="MidnightBlue">lowest</font>&nbsp;: -138.095 -100     -83.3333 -81.0811 -60      ,  <font color="MidnightBlue">highest</font>: 91.25    91.6667  92.8571  93.3333  100     </span>
<hr class="thinhr">
<span style="font-weight:bold">LDHst</span><div style="float: right; text-align: right;"><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAJcAAAANCAMAAACTvAxuAAAACVBMVEUAAADMzMz////1iUV5AAAAcklEQVQ4jc2V4QrAIAgGz73/Q49qarX1d34XgVnBIUmYAyYEl0OGAoQMml5oeoGYmKzXeP1OcRcmo0bhVVylZPOSEdu98ITvF5m+vbpaKJZ6ceKa5P41bB141JqwPv1ou9SH5b/6dLatXc0UsSbsYxm5G9LRDGryBqR6AAAAAElFTkSuQmCC" alt="image"></div>
<style>
 .hmisctable933632 {
 border: none;
 font-size: 74%;
 }
 .hmisctable933632 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable933632 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table data-quarto-disable-processing="true" class="hmisctable933632">
 <tbody><tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Mean</th><th>Gmd</th><th>.05</th><th>.10</th><th>.25</th><th>.50</th><th>.75</th><th>.90</th><th>.95</th></tr>
 <tr><td>544</td><td>0</td><td>472</td><td>1</td><td>2.03</td><td>1.605</td><td>0.6789</td><td>0.7661</td><td>0.9679</td><td>1.3675</td><td>2.5317</td><td>3.8014</td><td>5.2242</td></tr>
 </tbody></table>

<span style="font-size: 85%;"><font color="MidnightBlue">lowest</font>&nbsp;: 0.344444 0.3875   0.464444 0.48125  0.568376 ,  <font color="MidnightBlue">highest</font>: 11.3375  11.5812  12.0261  13.7867  15.8913 </span>
<hr class="thinhr">
<span style="font-weight:bold">Post.size</span><div style="float: right; text-align: right;"><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAJcAAAANCAMAAACTvAxuAAAACVBMVEUAAADMzMz////1iUV5AAAAbklEQVQ4je2TQQrAIAwEN/7/0TULSrCx6GXJoQsmCoKDOjAGGKVI0BhglCIpzAVccWnof667wDX0WJTyy0yNtbwrD1s7uDnhO04utuJcu/NLcCVPK+ZCwpV+ObGPu1icGZf0ZZbg0Guy7jh0sY8Hv6cMM8S7zDkAAAAASUVORK5CYII=" alt="image"></div>
<style>
 .hmisctable910781 {
 border: none;
 font-size: 74%;
 }
 .hmisctable910781 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable910781 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table data-quarto-disable-processing="true" class="hmisctable910781">
 <tbody><tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Mean</th><th>Gmd</th><th>.05</th><th>.10</th><th>.25</th><th>.50</th><th>.75</th><th>.90</th><th>.95</th></tr>
 <tr><td>544</td><td>0</td><td>93</td><td>0.996</td><td>33.26</td><td>33.37</td><td>  2.00</td><td>  5.00</td><td> 10.00</td><td> 20.00</td><td> 44.25</td><td> 93.50</td><td>100.00</td></tr>
 </tbody></table>

<span style="font-size: 85%;"><font color="MidnightBlue">lowest</font>&nbsp;: 2       3       4       4.22209 5       ,  <font color="MidnightBlue">highest</font>: 120     150     170     190     300    </span>
<hr class="thinhr">
</div>
</div>
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start the fitting of 3 models</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>full <span class="ot">&lt;-</span> <span class="fu">lrm</span>(Necrosis <span class="sc">~</span> Teratoma<span class="sc">+</span>Pre.AFP<span class="sc">+</span>Pre.HCG<span class="sc">+</span><span class="fu">log</span>(LDHst)<span class="sc">+</span><span class="fu">sqrt</span>(Post.size)<span class="sc">+</span>Reduction,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>n544,<span class="at">x=</span>T,<span class="at">y=</span>T,<span class="at">linear.predictors=</span>T)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><strong>Logistic Regression Model</strong></p>

<pre>lrm(formula = Necrosis ~ Teratoma + Pre.AFP + Pre.HCG + log(LDHst) + 
    sqrt(Post.size) + Reduction, data = n544, x = T, y = T, linear.predictors = T)
</pre>


<table class="gmisc_table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-left: 1px solid black; border-right: 1px solid black;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black;">Model Likelihood<br>
Ratio Test</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black;">Discrimination<br>
Indexes</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black;">Rank Discrim.<br>
Indexes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center; min-width: 9em; border-left: 1px solid black; border-right: 1px solid black;">Obs 544</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;">LR χ<sup>2</sup> 211.56</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;"><em>R</em><sup>2</sup> 0.431</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;"><em>C</em> 0.839</td>
</tr>
<tr class="even">
<td style="text-align: center; min-width: 9em; border-left: 1px solid black; border-right: 1px solid black;">0 299</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;">d.f. 6</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;"><em>R</em><sup><span style="font-size: 70%;">2</span></sup><sub><span style="font-size: 70%;">6,544</span></sub> 0.315</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;"><em>D</em><sub>xy</sub> 0.677</td>
</tr>
<tr class="odd">
<td style="text-align: center; min-width: 9em; border-left: 1px solid black; border-right: 1px solid black;">1 245</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;">Pr(&gt;χ<sup>2</sup>) &lt;0.0001</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;"><em>R</em><sup><span style="font-size: 70%;">2</span></sup><sub><span style="font-size: 70%;">6,404</span></sub> 0.399</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;">γ 0.678</td>
</tr>
<tr class="even">
<td style="text-align: center; min-width: 9em; border-bottom: 2px solid grey; border-left: 1px solid black; border-right: 1px solid black;">max |∂log <em>L</em>/∂β| 1×10<sup>-7</sup></td>
<td style="text-align: center; min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black;"></td>
<td style="text-align: center; min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black;">Brier 0.163</td>
<td style="text-align: center; min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black;">τ<sub>a</sub> 0.336</td>
</tr>
</tbody>
</table>




<table class="gmisc_table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; border-bottom: 1px solid grey; border-top: 2px solid grey;"></th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">β</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">S.E.</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">Wald <em>Z</em></th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">Pr(&gt;|<em>Z</em>|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; min-width: 7em;">Intercept</td>
<td style="text-align: right; min-width: 7em;">&nbsp;-1.0425</td>
<td style="text-align: right; min-width: 7em;">&nbsp;0.6086</td>
<td style="text-align: right; min-width: 7em;">-1.71</td>
<td style="text-align: right; min-width: 7em;">0.0867</td>
</tr>
<tr class="even">
<td style="text-align: left; min-width: 7em;">Teratoma</td>
<td style="text-align: right; min-width: 7em;">&nbsp; 0.9094</td>
<td style="text-align: right; min-width: 7em;">&nbsp;0.2140</td>
<td style="text-align: right; min-width: 7em;">4.25</td>
<td style="text-align: right; min-width: 7em;">&lt;0.0001</td>
</tr>
<tr class="odd">
<td style="text-align: left; min-width: 7em;">Pre.AFP</td>
<td style="text-align: right; min-width: 7em;">&nbsp; 0.9025</td>
<td style="text-align: right; min-width: 7em;">&nbsp;0.2333</td>
<td style="text-align: right; min-width: 7em;">3.87</td>
<td style="text-align: right; min-width: 7em;">0.0001</td>
</tr>
<tr class="even">
<td style="text-align: left; min-width: 7em;">Pre.HCG</td>
<td style="text-align: right; min-width: 7em;">&nbsp; 0.7827</td>
<td style="text-align: right; min-width: 7em;">&nbsp;0.2305</td>
<td style="text-align: right; min-width: 7em;">3.40</td>
<td style="text-align: right; min-width: 7em;">0.0007</td>
</tr>
<tr class="odd">
<td style="text-align: left; min-width: 7em;">LDHst</td>
<td style="text-align: right; min-width: 7em;">&nbsp; 0.9854</td>
<td style="text-align: right; min-width: 7em;">&nbsp;0.2089</td>
<td style="text-align: right; min-width: 7em;">4.72</td>
<td style="text-align: right; min-width: 7em;">&lt;0.0001</td>
</tr>
<tr class="even">
<td style="text-align: left; min-width: 7em;">Post.size</td>
<td style="text-align: right; min-width: 7em;">&nbsp;-0.2915</td>
<td style="text-align: right; min-width: 7em;">&nbsp;0.0815</td>
<td style="text-align: right; min-width: 7em;">-3.58</td>
<td style="text-align: right; min-width: 7em;">0.0003</td>
</tr>
<tr class="odd">
<td style="text-align: left; min-width: 7em; border-bottom: 2px solid grey;">Reduction</td>
<td style="text-align: right; min-width: 7em; border-bottom: 2px solid grey;">&nbsp; 0.0158</td>
<td style="text-align: right; min-width: 7em; border-bottom: 2px solid grey;">&nbsp;0.0052</td>
<td style="text-align: right; min-width: 7em; border-bottom: 2px solid grey;">3.04</td>
<td style="text-align: right; min-width: 7em; border-bottom: 2px solid grey;">0.0024</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="internal-validation-by-bootstrapping" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="internal-validation-by-bootstrapping">Internal validation by bootstrapping</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Validate model with bootstrapping</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>val.full  <span class="ot">&lt;-</span> <span class="fu">validate</span>(full, <span class="at">B=</span><span class="dv">100</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>val.full[<span class="dv">1</span>,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">5</span>) ] <span class="ot">&lt;-</span> val.full[<span class="dv">1</span>,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">5</span>) ]<span class="sc">/</span><span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="co"># transform Dxy to C</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>val.full[<span class="dv">1</span>,<span class="dv">4</span> ] <span class="ot">&lt;-</span> val.full[<span class="dv">1</span>,<span class="dv">4</span>]<span class="sc">/</span><span class="dv">2</span>  <span class="co"># optimism in c</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(val.full)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"C"</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(val.full[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,]), <span class="at">digits=</span><span class="dv">3</span>)  <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">index.orig</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">training</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">test</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">optimism</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">index.corrected</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: right;">0.839</td>
<td style="text-align: right;">0.839</td>
<td style="text-align: right;">0.835</td>
<td style="text-align: right;">0.004</td>
<td style="text-align: right;">0.835</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">R2</td>
<td style="text-align: right;">0.431</td>
<td style="text-align: right;">0.434</td>
<td style="text-align: right;">0.423</td>
<td style="text-align: right;">0.011</td>
<td style="text-align: right;">0.420</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Intercept</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Slope</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.978</td>
<td style="text-align: right;">0.022</td>
<td style="text-align: right;">0.978</td>
<td style="text-align: right;">100</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>So, limited optimism in c index (Dxy/2+0.5): <strong>0.004</strong>.<br>
And limited need for shrinkage, since the calibration slope is close to 1: <strong>0.98</strong>.<br>
For illustration, we consider 2 shrinkage approaches:<br>
1. shrink coefficients with a uniform factor (from bootstrap validation (or by a heuristic formula as described by <a href="https://www.jstor.org/stable/2345402">Copas 1983</a> and <a href="https://www.ncbi.nlm.nih.gov/pubmed/2277880">Van Houwelingen 1990</a> ). 2. penalize coefficients with a penalty factor as estimated by the optimal AIC in the <code>pentrace</code> function.</p>
<p>Empirical comparisons between shrinkage apporaches are here: <a href="https://www.ncbi.nlm.nih.gov/pubmed/10790680">Steyerberg 2000</a>. A recent study compared the stability of shrinkage estimators: <a href="https://arxiv.org/abs/1907.11493">Van Calster 2020</a>.</p>
</section>
<section id="shrunk-model-and-penalization" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="shrunk-model-and-penalization">Shrunk model and penalization</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply linear shrinkage</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>full.shrunk <span class="ot">&lt;-</span> full</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>full.shrunk<span class="sc">$</span>coef <span class="ot">&lt;-</span> val.full[<span class="dv">4</span>,<span class="dv">5</span>] <span class="sc">*</span> full.shrunk<span class="sc">$</span>coef  <span class="co"># use result from bootstrapping</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># val.full[4,5] is shrinkage factor; heuristic estimate (LR - df) / LR = (211-6)/211=0.97</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate new intercept, with shrunk lp as offset variable, i.e. coef fixed at unity</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>full.shrunk<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">lrm.fit</span>(<span class="at">y=</span>full<span class="sc">$</span>y, <span class="at">offset=</span> full<span class="sc">$</span>x <span class="sc">%*%</span> full.shrunk<span class="sc">$</span>coef[<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>])<span class="sc">$</span>coef[<span class="dv">1</span>]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a penalized model with pentrace function</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>p   <span class="ot">&lt;-</span> <span class="fu">pentrace</span>(full, <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">12</span>,<span class="dv">14</span>,<span class="dv">20</span>))</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p, <span class="at">which=</span><span class="st">'aic.c'</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">15</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">196</span>,<span class="dv">201</span>))</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="dv">196</span>, <span class="dv">1000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fig/shrunk.model-1.png" class="img-fluid figure-img" width="1122"></p>
</figure>
</div>
</div>
</div>
<p>The optimal penalty factor is 4. Let’s update the full model fit with this penalty term.</p>
</section>
<section id="fit-penalized-model-and-compare-fits" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="fit-penalized-model-and-compare-fits">Fit penalized model and compare fits</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>full.pen    <span class="ot">&lt;-</span> <span class="fu">update</span>(full, <span class="at">penalty=</span>p<span class="sc">$</span>penalty) </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="do">## compare coefs of 3 model variants</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>fit.coefs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">full=</span>full<span class="sc">$</span>coefficients, <span class="at">shrunk=</span>full.shrunk<span class="sc">$</span>coef, <span class="at">penalized=</span>full.pen<span class="sc">$</span>coefficients)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(fit.coefs, <span class="at">digits=</span><span class="dv">3</span>))  <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">full</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">shrunk</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">penalized</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Intercept</td>
<td style="text-align: right;">-1.042</td>
<td style="text-align: right;">-1.021</td>
<td style="text-align: right;">-1.090</td>
</tr>
<tr class="even">
<td style="text-align: left;">Teratoma</td>
<td style="text-align: right;">0.909</td>
<td style="text-align: right;">0.890</td>
<td style="text-align: right;">0.873</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pre.AFP</td>
<td style="text-align: right;">0.903</td>
<td style="text-align: right;">0.883</td>
<td style="text-align: right;">0.860</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pre.HCG</td>
<td style="text-align: right;">0.783</td>
<td style="text-align: right;">0.766</td>
<td style="text-align: right;">0.729</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LDHst</td>
<td style="text-align: right;">0.985</td>
<td style="text-align: right;">0.964</td>
<td style="text-align: right;">0.884</td>
</tr>
<tr class="even">
<td style="text-align: left;">Post.size</td>
<td style="text-align: right;">-0.292</td>
<td style="text-align: right;">-0.285</td>
<td style="text-align: right;">-0.261</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Reduction</td>
<td style="text-align: right;">0.016</td>
<td style="text-align: right;">0.015</td>
<td style="text-align: right;">0.016</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="fig-18.1" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="fig-18.1">Fig 18.1</h2>
<section id="make-nomogram-from-penalized-model" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="make-nomogram-from-penalized-model">Make nomogram from penalized model</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">4</span>,.<span class="dv">5</span>))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Need some stats for the data to plot nomogram</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>dd  <span class="ot">&lt;-</span> <span class="fu">datadist</span>(n544)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">datadist=</span><span class="st">"dd"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>nom <span class="ot">&lt;-</span> <span class="fu">nomogram</span>(full.pen,  <span class="at">fun=</span><span class="fu">c</span>(<span class="cf">function</span>(x)(<span class="dv">1</span><span class="sc">-</span><span class="fu">plogis</span>(x)), plogis), <span class="at">lp=</span>T,<span class="at">lp.at=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">LDHst=</span><span class="fu">c</span>(.<span class="dv">5</span>,<span class="dv">1</span>,<span class="fl">1.5</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">Post.size=</span><span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">20</span>,<span class="dv">10</span>,<span class="dv">5</span>,<span class="dv">2</span>), <span class="at">Reduction=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">35</span>,<span class="dv">70</span>,<span class="dv">100</span>), </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">fun.at=</span><span class="fu">c</span>(<span class="fu">seq</span>(.<span class="dv">1</span>,.<span class="dv">9</span>,<span class="at">by=</span>.<span class="dv">1</span>),<span class="fl">0.95</span>), </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">funlabel=</span><span class="fu">c</span>(<span class="st">"p(residual tumor)"</span>, <span class="st">"p(necrosis)"</span>),  <span class="at">vnames=</span><span class="st">"lab"</span>, <span class="at">maxscale=</span><span class="dv">10</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nom)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Testicular cancer prediction model: risk of residual tumor"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fig/nomogram-1.png" class="img-fluid figure-img" width="1122"></p>
</figure>
</div>
</div>
</div>
<p>So, we have a nice presentation that allows for assessing the relative importance of predictors (by length of the lines), and allows for precise estimates of risks of residual tumor (and its complement, necrosis, benign tissue).</p>
<blockquote class="blockquote">
<p><strong>Instruction to physicians using the model in their care:</strong><br>
Determine the patient’s value for each predictor, and draw a straight line upward to the points axis to determine how many points toward benign histology the patient receives. Sum the points received for each predictor and locate this sum on the total points axis. Draw a straight line down to find the patient’s predicted probability of residual tumor or necrosis (benign histology).</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Instruction to patient:</strong> “Mr.&nbsp;X, if we had 100 men exactly like you, we would expect that the chemotherapy was fully successful in approximately &lt;predicted probability from nomogram * 100&gt;, as reflected in fully benign disease at surgical resection of your abdominal lymph nodes.” <em><a href="https://www.ncbi.nlm.nih.gov/pubmed/14532778">see Kattan et al</a>.<br>
Note that the number 100 may be debated, since the effective sample size for some covariate patterns may be far less.</em></p>
</blockquote>
</section>
<section id="score-chart-creation-with-categorized-and-continuous-predictors" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="score-chart-creation-with-categorized-and-continuous-predictors">Score chart creation with categorized and continuous predictors</h3>
<p>We first search for some nice rounding of logistic regression coefficients. A classic approach is multiplying by 10. We find that multiplying by <strong>10/8, or 1.25</strong> works well.<br>
We then continue with searching for a similarly nice scoring for continuous predictors. This is a trial and error process, supported by graphical illustrations.</p>
</section>
<section id="consider-making-rounded-scores-from-penalized-coefs" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="consider-making-rounded-scores-from-penalized-coefs">Consider making rounded scores from penalized coefs</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>scores <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow=</span><span class="dv">10</span>, <span class="at">ncol=</span><span class="fu">length</span>(full.pen<span class="sc">$</span>coefficients), </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="cn">NULL</span>, <span class="fu">c</span>(<span class="st">"Multiplier"</span>, <span class="fu">names</span>(full.pen<span class="sc">$</span>coefficients[<span class="sc">-</span><span class="dv">1</span>]))))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  scores[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">/</span>i, <span class="fu">round</span>(full.pen<span class="sc">$</span>coefficients[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">*</span> <span class="dv">10</span> <span class="sc">/</span> i)) }</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># consider a range of multipliers</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(scores, <span class="at">digits=</span><span class="dv">3</span>))  <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Multiplier</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Teratoma</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Pre.AFP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Pre.HCG</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LDHst</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Post.size</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Reduction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10.00</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">-3</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">5.00</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3.33</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2.50</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.67</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1.11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rounded scores</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(<span class="at">mult10=</span><span class="fu">round</span>(<span class="dv">10</span><span class="sc">*</span>full.pen<span class="sc">$</span>coef[<span class="sc">-</span><span class="dv">1</span>]),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">mult1.25 =</span><span class="fu">round</span>(<span class="dv">10</span><span class="sc">/</span><span class="dv">8</span><span class="sc">*</span>full.pen<span class="sc">$</span>coef[<span class="sc">-</span><span class="dv">1</span>]))), <span class="at">digits=</span><span class="dv">3</span>)  <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Teratoma</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Pre.AFP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Pre.HCG</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LDHst</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Post.size</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Reduction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">mult10</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">-3</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">mult1.25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>So, we like the multiplier of <strong>10/8, or 1.25</strong>. Let’s search for the mapping of coefficients of continuous predictors on nice scores as well.</p>
</section>
</section>
<section id="scores-for-continuous-predictors" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="scores-for-continuous-predictors">Scores for continuous predictors</h2>
<section id="ldh" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ldh">LDH</h3>
<p>Start with LDH, where we use the log scale for standardized LDH values. We could e.g.&nbsp;find: 1 point per ln, so 1 point per 2.7 times normal. We use a score of 10/8 for LDH in a plot. We add reference lines for point allocation.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Use score of 10/8 for LDH, plot score by LDHst</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>LDHplot <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(n544<span class="sc">$</span>LDHst, <span class="fu">round</span>(<span class="dv">10</span><span class="sc">/</span><span class="dv">8</span><span class="sc">*</span>full.pen<span class="sc">$</span>coef[<span class="dv">5</span>]<span class="sc">*</span>n544<span class="sc">$</span>Pre.lnLDH,<span class="dv">1</span>)))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>LDHplot[,<span class="dv">1</span>], <span class="at">y=</span>LDHplot[,<span class="dv">2</span>], <span class="at">xlab=</span><span class="st">"LDHst (LDH / upper limit of normal LDH)"</span>, <span class="at">ylab=</span><span class="st">"Rounded score"</span>, </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">axes=</span>F, <span class="at">xlim=</span><span class="fu">c</span>(.<span class="dv">5</span>,<span class="fl">6.9</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">6</span>,<span class="fl">2.2</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">main =</span> <span class="st">"LDH"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">scat1d</span>(<span class="at">x=</span>n544<span class="sc">$</span>LDHst, <span class="at">side=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span><span class="fu">c</span>(.<span class="dv">5</span>,<span class="dv">1</span>,<span class="fl">1.5</span>,<span class="dv">2</span>,<span class="fl">2.5</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">2</span>, <span class="at">at=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">5</span>, <span class="dv">0</span>,.<span class="dv">5</span>,<span class="dv">1</span>,<span class="fl">1.5</span>,<span class="dv">2</span>))</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># horizontal reference lines</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">0</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">1</span>, <span class="at">b=</span><span class="dv">0</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">2</span>, <span class="at">b=</span><span class="dv">0</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># vertical reference lines</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">5</span>, .<span class="dv">5</span>), <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fl">2.5</span>,<span class="fl">2.5</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">5</span>, <span class="fl">1.5</span>))</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fl">2.5</span><span class="sc">^</span><span class="dv">2</span>,<span class="fl">2.5</span><span class="sc">^</span><span class="dv">2</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">5</span>, <span class="fl">2.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fig/LDH.scores-1.png" class="img-fluid figure-img" width="1122"></p>
</figure>
</div>
</div>
</div>
<p>We find that a score of 1 corresponds to 2.5 times larger LDH values.<br>
Continue with post.size.</p>
</section>
<section id="study-scores-for-postchemotherapy-size" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="study-scores-for-postchemotherapy-size">Study scores for postchemotherapy size</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate score by sequence 2 to 100mm; </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 is minimum for analysis; set 10 to zero in sequence (sqrt(seq(2,50,by=1))-sqrt(10))</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We use 10mm as a reference, set to zero</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>Sizeplot <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(n544<span class="sc">$</span>Post.size, </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">round</span>(<span class="dv">10</span><span class="sc">/</span><span class="dv">8</span><span class="sc">*</span>full.pen<span class="sc">$</span>coef[<span class="dv">6</span>]<span class="sc">*</span>(<span class="fu">sqrt</span>(n544<span class="sc">$</span>Post.size) <span class="sc">-</span> <span class="fu">sqrt</span>(<span class="dv">10</span>)),<span class="dv">1</span>)), <span class="at">main =</span> <span class="st">"Postchemotherapy size"</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>Sizeplot[,<span class="dv">1</span>], <span class="at">y=</span>Sizeplot[,<span class="dv">2</span>], <span class="at">xlab=</span><span class="st">"Postchemo size (mm)"</span>, <span class="at">ylab=</span><span class="st">"Rounded score"</span>, </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">axes=</span>F, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.1</span>,<span class="dv">1</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">main =</span> <span class="st">"Postsize"</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">scat1d</span>(<span class="at">x=</span>n544<span class="sc">$</span>Post.size, <span class="at">side=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">70</span>, <span class="dv">100</span>))</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">2</span>, <span class="at">at=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span>.<span class="dv">5</span>,<span class="dv">0</span>,<span class="fl">0.5</span>))</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># horizontal reference lines</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">0</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span>.<span class="dv">5</span>, <span class="at">b=</span><span class="dv">0</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="sc">-</span>.<span class="dv">5</span>, <span class="at">b=</span><span class="dv">0</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">b=</span><span class="dv">0</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">b=</span><span class="dv">0</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># vertical reference lines</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.1</span>, .<span class="dv">75</span>))</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">10</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.1</span>, <span class="fl">0.25</span>), <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">20</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.1</span>, <span class="sc">-</span>.<span class="dv">1</span>))</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">40</span>,<span class="dv">40</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.1</span>, <span class="sc">-</span><span class="fl">0.6</span>))</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">100</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.1</span>, <span class="sc">-</span><span class="fl">1.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fig/post.size-1.png" class="img-fluid figure-img" width="1122"></p>
</figure>
</div>
</div>
</div>
<p>So, approximate scores for clinically meaningful sizes: <strong>2 mm score +.5; 10mm, 0; 20mm, -.5; 40mm -1; 100 -2</strong></p>
<p>Continue with Reduction. This should be simple, since Reduction was modelled as a linear variable, without transformations.</p>
</section>
<section id="study-scores-for-reduction-in-size" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="study-scores-for-reduction-in-size">Study scores for reduction in size</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>Redplot <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(n544<span class="sc">$</span>Reduction, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">round</span>(<span class="dv">10</span><span class="sc">/</span><span class="dv">8</span><span class="sc">*</span>full.pen<span class="sc">$</span>coef[<span class="dv">7</span>]<span class="sc">*</span>n544<span class="sc">$</span>Reduction,<span class="dv">1</span>)))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>Redplot[,<span class="dv">1</span>], <span class="at">y=</span>Redplot[,<span class="dv">2</span>], <span class="at">xlab=</span><span class="st">"Reduction in size (%)"</span>, <span class="at">ylab=</span><span class="st">"Rounded score"</span>, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">axes=</span>F, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>,<span class="fl">2.1</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">main =</span> <span class="st">"Reduction in size"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">scat1d</span>(<span class="at">x=</span>n544<span class="sc">$</span>Reduction, <span class="at">side=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">25</span>,<span class="dv">50</span>,<span class="dv">75</span>,<span class="dv">100</span>))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">2</span>, <span class="at">at=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># horizontal reference lines</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">0</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">1</span>, <span class="at">b=</span><span class="dv">0</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">2</span>, <span class="at">b=</span><span class="dv">0</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co"># vertical reference lines</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">50</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.25</span>))</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">100</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">2.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fig/reduction-1.png" class="img-fluid figure-img" width="1122"></p>
</figure>
</div>
</div>
</div>
<p>So, scores for reduction in size: <strong>50%, score 1; 100%, score 2</strong></p>
<p>We store the scores in new variables for later use in a logistic regression model, to check the impact of rounding on model performance.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A score of 1 corresponds to 2.5 times larger LDH</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># rescale such that exp(l) does get more than 1 point; 1 point at 2.5 times normal LDH</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>LDHr  <span class="ot">&lt;-</span> <span class="fu">round</span>(n544<span class="sc">$</span>Pre.lnLDH<span class="sc">*</span><span class="fu">exp</span>(<span class="dv">1</span>)<span class="sc">/</span><span class="fl">2.5</span>,<span class="dv">1</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># postsize: coef -.3 per sqrt(mm). Hence -1 with 3.3*sqrt(mm)</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># So, approximate scores for clinically meaningful sizes:</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 mm score +.5; 10mm, 0; 20mm, -.5; 40mm -1; 100 -2</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># change the intercept by defining score = 0 for 10 mm, which is clinically of most interest</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>SQPOSTr  <span class="ot">&lt;-</span> <span class="fu">round</span>((n544<span class="sc">$</span>sqpost <span class="sc">-</span> <span class="fu">sqrt</span>(<span class="dv">10</span>)) <span class="sc">/</span> (<span class="fu">sqrt</span>(<span class="dv">10</span>) <span class="sc">-</span> <span class="fu">sqrt</span>(<span class="dv">40</span>)),<span class="dv">1</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Rescale reduction such that effect 1 point</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 50% reduction 1 point; i.e. 0% = 0; 50%=1; 100%=2</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>REDUC5  <span class="ot">&lt;-</span> <span class="fu">round</span>(n544<span class="sc">$</span>reduc10 <span class="sc">/</span> <span class="dv">5</span>,<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="table-18.2" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="table-18.2">Table 18.2</h2>
<section id="make-a-score-chart" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="make-a-score-chart">Make a score chart</h3>
<p>Score chart to be made by hand, using the points as derived above.<br>
Could also have kept life simpler by multiplying coefs by 10 and rounding.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>score.fit <span class="ot">&lt;-</span> <span class="fu">lrm</span>(Necrosis <span class="sc">~</span> Teratoma<span class="sc">+</span>Pre.AFP<span class="sc">+</span>Pre.HCG<span class="sc">+</span>LDHr<span class="sc">+</span>SQPOSTr<span class="sc">+</span>REDUC5,<span class="at">data=</span>n544, <span class="at">x=</span>T,<span class="at">y=</span>T)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># scores &lt;- as.data.frame(round(10/8*full.pen$coef[-1]))</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(<span class="dv">10</span><span class="sc">/</span><span class="dv">8</span><span class="sc">*</span>score.fit<span class="sc">$</span>coef[<span class="sc">-</span><span class="dv">1</span>]), <span class="at">digits=</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">10/8 * score.fit$coef[-1]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Teratoma</td>
<td style="text-align: right;">1.134</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pre.AFP</td>
<td style="text-align: right;">1.137</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pre.HCG</td>
<td style="text-align: right;">0.964</td>
</tr>
<tr class="even">
<td style="text-align: left;">LDHr</td>
<td style="text-align: right;">1.110</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SQPOSTr</td>
<td style="text-align: right;">1.114</td>
</tr>
<tr class="even">
<td style="text-align: left;">REDUC5</td>
<td style="text-align: right;">1.008</td>
</tr>
</tbody>
</table>
</div>
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Continuous scores</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>LDHvalues <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="dv">1</span>, <span class="fl">1.6</span>, <span class="fl">2.5</span>, <span class="dv">4</span>, <span class="dv">6</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(<span class="at">LDH=</span>LDHvalues, <span class="at">LDHscores=</span><span class="fu">log</span>(LDHvalues)<span class="sc">*</span><span class="fu">exp</span>(<span class="dv">1</span>)<span class="sc">/</span><span class="fl">2.5</span>)), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">col.names =</span><span class="cn">NULL</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">LDH</td>
<td style="text-align: right;">0.60</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.60</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: right;">4.00</td>
<td style="text-align: right;">6.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">LDHscores</td>
<td style="text-align: right;">-0.56</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.51</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.51</td>
<td style="text-align: right;">1.95</td>
</tr>
</tbody>
</table>
</div>
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>Postvalues <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">40</span>,<span class="dv">70</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(<span class="at">Postsize=</span>Postvalues, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Postscores=</span>(<span class="fu">sqrt</span>(Postvalues) <span class="sc">-</span> <span class="fu">sqrt</span>(<span class="dv">10</span>)) <span class="sc">/</span> (<span class="fu">sqrt</span>(<span class="dv">10</span>) <span class="sc">-</span> <span class="fu">sqrt</span>(<span class="dv">40</span>)))), </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">col.names =</span><span class="cn">NULL</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Postsize</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">20.00</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">70.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">Postscores</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-0.41</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">-1.65</td>
</tr>
</tbody>
</table>
</div>
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>Redvalues <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(<span class="at">Reduction=</span>Redvalues, </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Redscores=</span>Redvalues <span class="sc">/</span> <span class="dv">5</span>)), </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">col.names =</span><span class="cn">NULL</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Reduction</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">Redscores</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>So, we see that the continuous values of some predictors map to scores of approximately 0.5 or 1. Intermediate scores can be obtained by interpolation.</p>
<hr>
</section>
</section>
<section id="fig-18.2" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="fig-18.2">Fig 18.2</h2>
<section id="translate-score-in-probability-estimates-with-95-ci" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="translate-score-in-probability-estimates-with-95-ci">Translate score in probability estimates with 95% CI</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">##'# Function to relate scores to predictions in graph </span><span class="al">###</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>make.score.matrix <span class="ot">&lt;-</span><span class="cf">function</span>(fit, scores, <span class="at">shrinkage=</span><span class="dv">1</span>, <span class="at">limits.scores=</span><span class="cn">NULL</span>) {   </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lpscore for score chart + graph</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  fit         <span class="ot">&lt;-</span> <span class="fu">update</span>(fit, <span class="at">x=</span>T,<span class="at">y=</span>T, <span class="at">se.fit=</span>T)   <span class="co"># SE of predictions from original model</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  rounded.lp    <span class="ot">&lt;-</span> fit<span class="sc">$</span>x <span class="sc">%*%</span> scores                 <span class="co"># Linear predictor</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  multiplier  <span class="ot">&lt;-</span> <span class="fu">lrm.fit</span>(<span class="at">y=</span>fit<span class="sc">$</span>y, <span class="at">x=</span>rounded.lp)<span class="sc">$</span>coef[<span class="dv">2</span>]    <span class="do">## For score formula</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  shrunk.beta   <span class="ot">&lt;-</span> shrinkage <span class="sc">*</span> multiplier           <span class="co"># Shrinkage built in</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Estimate intercept for scores, using the scores as offset with shrinkage</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  fit.lp      <span class="ot">&lt;-</span> <span class="fu">lrm.fit</span>(<span class="at">y=</span>score.fit<span class="sc">$</span>y, <span class="at">offset=</span>shrunk.beta<span class="sc">*</span>rounded.lp) </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">## lp formula; this version is not fully rounded yet</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  lp2           <span class="ot">&lt;-</span> fit.lp<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> shrunk.beta<span class="sc">*</span>rounded.lp</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">linear predictor:"</span>, fit.lp<span class="sc">$</span>coef[<span class="dv">1</span>], <span class="st">"+"</span>, shrunk.beta, <span class="st">"* rounded.lp</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">" original range of scores"</span>, <span class="fu">min</span>(rounded.lp), <span class="fu">max</span>(rounded.lp), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(limits.scores))  {</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    rounded.lp[rounded.lp <span class="sc">&lt;</span> <span class="fu">min</span>(limits.scores)] <span class="ot">&lt;-</span> <span class="fu">min</span>(limits.scores)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    rounded.lp[rounded.lp <span class="sc">&gt;</span> <span class="fu">max</span>(limits.scores)] <span class="ot">&lt;-</span> <span class="fu">max</span>(limits.scores) }</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"restricted range of scores"</span>, <span class="fu">min</span>(rounded.lp), <span class="fu">max</span>(rounded.lp), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) </span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Data for graph</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  graph.lp      <span class="ot">&lt;-</span> <span class="fu">cbind</span>(rounded.lp, fit<span class="sc">$</span>se.fit)        <span class="co"># lp and se.fit in matrix</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  lp.events     <span class="ot">&lt;-</span> <span class="fu">tapply</span>(fit<span class="sc">$</span>y,<span class="fu">list</span>(<span class="fu">round</span>(graph.lp[,<span class="dv">1</span>],<span class="dv">0</span>)),sum)    <span class="co"># events per lp score</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  lp.nonevents <span class="ot">&lt;-</span> <span class="fu">tapply</span>(<span class="dv">1</span><span class="sc">-</span>fit<span class="sc">$</span>y,<span class="fu">list</span>(<span class="fu">round</span>(graph.lp[,<span class="dv">1</span>],<span class="dv">0</span>)),sum)   <span class="co"># non-events per lp score</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  se.lp           <span class="ot">&lt;-</span> <span class="fu">tapply</span>(graph.lp[,<span class="dv">2</span>],<span class="fu">list</span>(<span class="fu">round</span>(graph.lp[,<span class="dv">1</span>],<span class="dv">0</span>)),mean)  <span class="co"># mean se per lp score</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  lp.lp           <span class="ot">&lt;-</span> <span class="fu">tapply</span>(graph.lp[,<span class="dv">1</span>],<span class="fu">list</span>(<span class="fu">round</span>(graph.lp[,<span class="dv">1</span>],<span class="dv">0</span>)),mean)  <span class="co"># mean lp per lp score</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  score         <span class="ot">&lt;-</span> lp.lp                        <span class="co"># range of score, rounded to 0 decimals</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  lp3               <span class="ot">&lt;-</span> fit.lp<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> shrunk.beta<span class="sc">*</span><span class="fu">round</span>(score,<span class="dv">0</span>) <span class="co"># lp on logistic scale, rounded</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  <span class="do">## data frame with predicted prob + 95% CI</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  p.lp          <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(<span class="at">score=</span><span class="fu">round</span>(score,<span class="dv">0</span>),</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>                    <span class="at">p=</span><span class="fu">plogis</span>(lp3),<span class="at">plow=</span><span class="fu">plogis</span>(lp3<span class="fl">-1.96</span><span class="sc">*</span>se.lp),<span class="at">phigh=</span><span class="fu">plogis</span>(lp3<span class="fl">+1.96</span><span class="sc">*</span>se.lp),</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>                    lp.events,lp.nonevents))</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>  p.lp<span class="sc">$</span>total <span class="ot">&lt;-</span> p.lp<span class="sc">$</span>lp.events <span class="sc">+</span> p.lp<span class="sc">$</span>lp.nonevents</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  p.lp</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="do">## Make Fig 18.2 ##</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="do">## Continuous predictors in score</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>score.fit <span class="ot">&lt;-</span> <span class="fu">lrm</span>(Necrosis <span class="sc">~</span> Teratoma<span class="sc">+</span>Pre.AFP<span class="sc">+</span>Pre.HCG<span class="sc">+</span>LDHr<span class="sc">+</span>SQPOSTr<span class="sc">+</span>REDUC5,<span class="at">data=</span>n544, <span class="at">x=</span>T,<span class="at">y=</span>T)</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>scores  <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">6</span>)  <span class="co"># All scores a weight of 1</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>lp.n544 <span class="ot">&lt;-</span> <span class="fu">make.score.matrix</span>(<span class="at">fit=</span>score.fit, <span class="at">scores=</span>scores, <span class="at">shrinkage=</span><span class="fl">0.95</span>, <span class="at">limits.scores=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
linear predictor: -1.94 + 0.815 * rounded.lp
  original range of scores -4.3 6.7 
restricted range of scores -2 5 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(lp.n544), </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">score</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">plow</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">phigh</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lp.events</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lp.nonevents</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">-2</td>
<td style="text-align: right;">-2</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22</td>
</tr>
<tr class="even">
<td style="text-align: left;">-1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">48</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">59</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.36</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">77</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">107</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.62</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">0.74</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">99</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.79</td>
<td style="text-align: right;">0.68</td>
<td style="text-align: right;">0.87</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">85</td>
</tr>
<tr class="even">
<td style="text-align: left;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.89</td>
<td style="text-align: right;">0.82</td>
<td style="text-align: right;">0.94</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">47</td>
</tr>
</tbody>
</table>
</div>
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">mar=</span><span class="fu">c</span>(<span class="fl">4.5</span>,<span class="fl">4.5</span>,<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>lp.n544[,<span class="dv">1</span>], <span class="at">y=</span><span class="dv">100</span><span class="sc">*</span>lp.n544[,<span class="dv">2</span>], <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">las=</span><span class="dv">1</span>, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">cex.lab=</span><span class="fl">1.2</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Predicted probability of necrosis (%)"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">100</span>), </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab=</span><span class="st">"Sum score"</span>, <span class="at">cex=</span><span class="fu">sqrt</span>(lp.n544<span class="sc">$</span>total)<span class="sc">/</span><span class="dv">5</span>, <span class="at">xaxt=</span><span class="st">"n"</span>, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>,<span class="at">at=</span>lp.n544[,<span class="dv">1</span>], <span class="at">cex=</span><span class="dv">1</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># add 95% CI</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(lp.n544)) <span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(lp.n544[i,<span class="dv">1</span>], lp.n544[i,<span class="dv">1</span>]), <span class="at">y=</span><span class="fu">c</span>(<span class="dv">100</span><span class="sc">*</span>lp.n544[i,<span class="dv">3</span>], <span class="dv">100</span><span class="sc">*</span>lp.n544[i,<span class="dv">4</span>]), <span class="at">type=</span><span class="st">"l"</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># add N= ...</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">"N="</span>, <span class="at">side =</span> <span class="dv">2</span>, <span class="at">outer =</span> <span class="cn">FALSE</span>, <span class="at">line=</span><span class="fl">1.5</span>, <span class="at">at =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">adj =</span> <span class="dv">0</span>, <span class="at">las=</span><span class="dv">1</span>, <span class="at">cex=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span>lp.n544[,<span class="dv">1</span>],<span class="at">y=</span><span class="sc">-</span><span class="dv">10</span>,<span class="at">labels=</span>lp.n544<span class="sc">$</span>total, <span class="at">cex=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fig/scoreplot-1.png" class="img-fluid figure-img" width="1122"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="end-table-18.2-score-chart-and-fig-18.2-graphic-translation-from-score-to-probability" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="end-table-18.2-score-chart-and-fig-18.2-graphic-translation-from-score-to-probability">End Table 18.2 (score chart) and Fig 18.2 (graphic translation from score to probability)</h2>
<section id="categorized-coding" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="categorized-coding">Categorized coding</h3>
<p>We can categorize the continuous predictors; a <strong><a href="https://www.ncbi.nlm.nih.gov/pubmed/16217841">bad idea</a></strong> generally speaking</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LDH</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>PRELDH <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(n544<span class="sc">$</span>Pre.lnLDH<span class="sc">&lt;</span><span class="fu">log</span>(<span class="dv">1</span>),<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># PostSize simple coding: 0,1,2</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>POST2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(n544<span class="sc">$</span>sqpost<span class="sc">&lt;</span><span class="fu">sqrt</span>(<span class="dv">20</span>),<span class="dv">2</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>(n544<span class="sc">$</span>sqpost<span class="sc">&lt;</span><span class="fu">sqrt</span>(<span class="dv">50</span>),<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Reduction in categories: increase=-1, 0-49%=0, &gt;=50%=1</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>REDUCr  <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(n544<span class="sc">$</span>Reduction<span class="sc">&lt;</span><span class="dv">0</span>,<span class="sc">-</span><span class="dv">1</span>, <span class="fu">ifelse</span>(n544<span class="sc">$</span>Reduction<span class="sc">&gt;=</span><span class="dv">50</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Everything coded in categories</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>score.fit2 <span class="ot">&lt;-</span> <span class="fu">lrm</span>(Necrosis <span class="sc">~</span> Teratoma<span class="sc">+</span>Pre.AFP<span class="sc">+</span>Pre.HCG<span class="sc">+</span>PRELDH<span class="sc">+</span>POST2<span class="sc">+</span>REDUCr,<span class="at">data=</span>n544, <span class="at">x=</span>T,<span class="at">y=</span>T)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(<span class="at">x=</span><span class="dv">10</span><span class="sc">/</span><span class="dv">8</span><span class="sc">*</span>score.fit2<span class="sc">$</span>coef[<span class="sc">-</span><span class="dv">1</span>]), <span class="at">digits=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">10/8 * score.fit2$coef[-1]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Teratoma</td>
<td style="text-align: right;">1.15</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pre.AFP</td>
<td style="text-align: right;">1.08</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pre.HCG</td>
<td style="text-align: right;">0.83</td>
</tr>
<tr class="even">
<td style="text-align: left;">PRELDH</td>
<td style="text-align: right;">1.13</td>
</tr>
<tr class="odd">
<td style="text-align: left;">POST2</td>
<td style="text-align: right;">1.08</td>
</tr>
<tr class="even">
<td style="text-align: left;">REDUCr</td>
<td style="text-align: right;">0.98</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>So, each category approx 1 point.</p>
</section>
</section>
<section id="table-18.3" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="table-18.3">Table 18.3</h2>
<section id="alternative-make-a-score-from-0---5" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="alternative-make-a-score-from-0---5">Alternative: make a score from 0 - 5</h3>
<blockquote class="blockquote">
<p><strong>Ultra simple scores</strong><br>
“<em>.. categories of the predictors were simplified for practical application. We conclude that a simple statistical model, based on a limited number of patient characteristics, provides better guidelines for patient selection than those currently used in clinical practice. <a href="https://www.ncbi.nlm.nih.gov/pubmed/8912551">Br J Cancer 1996</a></em>”</p>
</blockquote>
<div class="cell">
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>score5  <span class="ot">&lt;-</span> n544<span class="sc">$</span>Teratoma<span class="sc">+</span>n544<span class="sc">$</span>Pre.AFP<span class="sc">+</span>n544<span class="sc">$</span>Pre.HCG<span class="sc">+</span>n544<span class="sc">$</span>PRELDH<span class="sc">+</span>n544<span class="sc">$</span>REDUCr</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>score5  <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(n544<span class="sc">$</span>REDUCr<span class="sc">&lt;</span><span class="dv">0</span>,<span class="dv">0</span>,score5)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>score5 <span class="ot">&lt;-</span> score5</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple coding: 5 categories for postsize (no difference 20-30 and 30-50 mm)</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>POST5 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(n544<span class="sc">$</span>sqpost<span class="sc">&lt;=</span><span class="fu">sqrt</span>(<span class="dv">10</span>),<span class="dv">0</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>(n544<span class="sc">$</span>sqpost<span class="sc">&lt;=</span><span class="fu">sqrt</span>(<span class="dv">20</span>),<span class="dv">1</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(n544<span class="sc">$</span>sqpost<span class="sc">&lt;=</span><span class="fu">sqrt</span>(<span class="dv">30</span>),<span class="dv">2</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">ifelse</span>(n544<span class="sc">$</span>sqpost<span class="sc">&lt;=</span><span class="fu">sqrt</span>(<span class="dv">50</span>),<span class="dv">3</span>,<span class="dv">4</span>))))</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>POST5 <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(POST5)  <span class="co"># add the post size categories as a factor</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>full.simple2  <span class="ot">&lt;-</span> <span class="fu">lrm</span>(Necrosis<span class="sc">~</span>POST5<span class="sc">+</span>score5, <span class="at">data=</span>n544, <span class="at">x=</span>T,<span class="at">y=</span>T,<span class="at">se.fit=</span>T)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>pred.simple2  <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="fu">plogis</span>(<span class="fu">predict</span>(full.simple2)), <span class="at">by=</span><span class="fu">list</span>(POST5, score5), <span class="at">FUN=</span>mean)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>pred.simple2  <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">with</span>(pred.simple2,<span class="fu">tapply</span>(x,<span class="fu">list</span>(Group<span class="fl">.1</span>,Group<span class="fl">.2</span>),mean)))</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(pred.simple2), <span class="at">digits =</span> <span class="dv">2</span>)  <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">0</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">3</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">4</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">0.71</td>
<td style="text-align: right;">0.85</td>
<td style="text-align: right;">0.93</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">0.66</td>
<td style="text-align: right;">0.81</td>
<td style="text-align: right;">0.91</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">0.63</td>
<td style="text-align: right;">0.79</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.30</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.69</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>POST5 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(n544<span class="sc">$</span>POST5)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make simple risk scores per category</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>simple.cat  <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(n544<span class="sc">$</span>POST5<span class="sc">==</span><span class="dv">3</span> <span class="sc">&amp;</span> score5<span class="sc">==</span><span class="dv">4</span>,<span class="dv">70</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">ifelse</span>(n544<span class="sc">$</span>POST5<span class="sc">==</span><span class="dv">3</span> <span class="sc">&amp;</span> score5<span class="sc">==</span><span class="dv">5</span>,<span class="dv">80</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">ifelse</span>(n544<span class="sc">$</span>POST5<span class="sc">==</span><span class="dv">2</span> <span class="sc">&amp;</span> score5<span class="sc">==</span><span class="dv">3</span>,<span class="dv">60</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">ifelse</span>(n544<span class="sc">$</span>POST5<span class="sc">==</span><span class="dv">2</span> <span class="sc">&amp;</span> score5<span class="sc">==</span><span class="dv">4</span>,<span class="dv">80</span>,                    </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">ifelse</span>(n544<span class="sc">$</span>POST5<span class="sc">==</span><span class="dv">2</span> <span class="sc">&amp;</span> score5<span class="sc">==</span><span class="dv">5</span>,<span class="dv">90</span>,                    </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(n544<span class="sc">$</span>POST5<span class="sc">&lt;</span><span class="dv">2</span> <span class="sc">&amp;</span> score5<span class="sc">==</span><span class="dv">2</span>,<span class="dv">60</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(n544<span class="sc">$</span>POST5<span class="sc">&lt;</span><span class="dv">2</span> <span class="sc">&amp;</span> score5<span class="sc">==</span><span class="dv">3</span>,<span class="dv">70</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(n544<span class="sc">$</span>POST5<span class="sc">&lt;</span><span class="dv">2</span> <span class="sc">&amp;</span> score5<span class="sc">==</span><span class="dv">4</span>,<span class="dv">80</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(n544<span class="sc">$</span>POST5<span class="sc">&lt;</span><span class="dv">2</span> <span class="sc">&amp;</span> score5<span class="sc">==</span><span class="dv">5</span>,<span class="dv">90</span>, <span class="dv">50</span>)))))))))</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>simple.tab <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">with</span>(n544,<span class="fu">tapply</span>(simple.cat,<span class="fu">list</span>(<span class="at">POST5=</span>POST5,<span class="at">score=</span>score5),mean)))</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>simple.tab[<span class="fu">is.na</span>(simple.tab)] <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(simple.tab) <span class="ot">&lt;-</span> <span class="fu">Cs</span>(score<span class="fl">.0</span>, score<span class="fl">.1</span>, score<span class="fl">.2</span>, score<span class="fl">.3</span>, score<span class="fl">.4</span>, score<span class="fl">.5</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(simple.tab) <span class="ot">&lt;-</span> <span class="fu">Cs</span>(size10, size20, size30, size50, size.gt<span class="fl">.50</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>simple.tab <span class="sc">%&gt;%</span> </span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">score.0 =</span> <span class="fu">cell_spec</span>(score<span class="fl">.0</span>, <span class="st">"html"</span>, <span class="at">color =</span> <span class="fu">ifelse</span>(score<span class="fl">.0</span> <span class="sc">&gt;</span> <span class="dv">50</span>, <span class="st">"orange"</span>, <span class="st">"red"</span>)),</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">score.1 =</span> <span class="fu">cell_spec</span>(score<span class="fl">.1</span>, <span class="st">"html"</span>, <span class="at">color =</span> <span class="fu">ifelse</span>(score<span class="fl">.1</span> <span class="sc">&gt;</span> <span class="dv">50</span>, <span class="st">"orange"</span>, <span class="st">"red"</span>)),</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">score.2 =</span> <span class="fu">cell_spec</span>(score<span class="fl">.2</span>, <span class="st">"html"</span>, <span class="at">color =</span> <span class="fu">ifelse</span>(score<span class="fl">.2</span> <span class="sc">&gt;</span> <span class="dv">50</span>, <span class="st">"orange"</span>, <span class="st">"red"</span>)),</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">score.3 =</span> <span class="fu">cell_spec</span>(score<span class="fl">.3</span>, <span class="st">"html"</span>, <span class="at">color =</span> <span class="fu">ifelse</span>(score<span class="fl">.3</span> <span class="sc">==</span> <span class="dv">70</span>, <span class="st">"green"</span>,</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">ifelse</span>(score<span class="fl">.3</span> <span class="sc">==</span> <span class="dv">60</span>, <span class="st">"orange"</span>,<span class="st">"red"</span>))),</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">score.4 =</span> <span class="fu">cell_spec</span>(score<span class="fl">.4</span>, <span class="st">"html"</span>, <span class="at">color =</span> <span class="fu">ifelse</span>(score<span class="fl">.4</span> <span class="sc">==</span> <span class="dv">80</span>, <span class="st">"white"</span>,</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">ifelse</span>(score<span class="fl">.4</span> <span class="sc">==</span> <span class="dv">70</span>, <span class="st">"green"</span>,</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">ifelse</span>(score<span class="fl">.4</span> <span class="sc">==</span> <span class="dv">60</span>, <span class="st">"orange"</span>,<span class="st">"red"</span>))),</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>                           <span class="at">background=</span><span class="fu">ifelse</span>(score<span class="fl">.4</span> <span class="sc">==</span> <span class="dv">80</span>, <span class="st">"green"</span>,<span class="st">"white"</span> )),</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">score.5 =</span> <span class="fu">cell_spec</span>(score<span class="fl">.5</span>, <span class="st">"html"</span>, <span class="at">color =</span> <span class="fu">ifelse</span>(score<span class="fl">.5</span> <span class="sc">&gt;=</span> <span class="dv">80</span>, <span class="st">"white"</span>,</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">ifelse</span>(score<span class="fl">.5</span> <span class="sc">==</span> <span class="dv">70</span>, <span class="st">"green"</span>,</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">ifelse</span>(score<span class="fl">.5</span> <span class="sc">==</span> <span class="dv">60</span>, <span class="st">"orange"</span>,<span class="st">"red"</span>))),</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>                           <span class="at">background=</span><span class="fu">ifelse</span>(score<span class="fl">.5</span> <span class="sc">==</span> <span class="dv">90</span>, <span class="st">"darkgreen"</span>,</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>                                             <span class="fu">ifelse</span>(score<span class="fl">.5</span> <span class="sc">==</span> <span class="dv">80</span>, <span class="st">"green"</span>,<span class="st">"white"</span> )))</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>, <span class="at">escape =</span> F, <span class="at">row.names =</span> T) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">score.0</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">score.1</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">score.2</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">score.3</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">score.4</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">score.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">size10</td>
<td style="text-align: left;"><span style="     color: red !important;">50</span></td>
<td style="text-align: left;"><span style="     color: red !important;">50</span></td>
<td style="text-align: left;"><span style="     color: orange !important;">60</span></td>
<td style="text-align: left;"><span style="     color: green !important;">70</span></td>
<td style="text-align: left;"><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: green !important;">80</span></td>
<td style="text-align: left;"><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: darkgreen !important;">90</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">size20</td>
<td style="text-align: left;"><span style="     color: red !important;">50</span></td>
<td style="text-align: left;"><span style="     color: red !important;">50</span></td>
<td style="text-align: left;"><span style="     color: red !important;">50</span></td>
<td style="text-align: left;"><span style="     color: orange !important;">60</span></td>
<td style="text-align: left;"><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: green !important;">80</span></td>
<td style="text-align: left;"><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: darkgreen !important;">90</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">size30</td>
<td style="text-align: left;"><span style="     color: red !important;">50</span></td>
<td style="text-align: left;"><span style="     color: red !important;">50</span></td>
<td style="text-align: left;"><span style="     color: red !important;">50</span></td>
<td style="text-align: left;"><span style="     color: red !important;">50</span></td>
<td style="text-align: left;"><span style="     color: green !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">70</span></td>
<td style="text-align: left;"><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: green !important;">80</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">size50</td>
<td style="text-align: left;"><span style="     color: red !important;">50</span></td>
<td style="text-align: left;"><span style="     color: red !important;">50</span></td>
<td style="text-align: left;"><span style="     color: red !important;">50</span></td>
<td style="text-align: left;"><span style="     color: red !important;">50</span></td>
<td style="text-align: left;"><span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">50</span></td>
<td style="text-align: left;"><span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">50</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">size.gt.50</td>
<td style="text-align: left;"><span style="     color: red !important;">50</span></td>
<td style="text-align: left;"><span style="     color: red !important;">50</span></td>
<td style="text-align: left;"><span style="     color: red !important;">50</span></td>
<td style="text-align: left;"><span style="     color: red !important;">50</span></td>
<td style="text-align: left;"><span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">50</span></td>
<td style="text-align: left;"><span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">50</span></td>
</tr>
</tbody>
</table>
</div>
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(simple.tab, digits = 2) %&gt;% kable_styling(full_width=F, position = "left") </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In this way we created a very simple table, with probability of necrosis according to post-chemotherapy mass size (rows) and a simple, categorized score of the other 5 predictors.</p>
</section>
</section>
<section id="fig-18.3" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="fig-18.3">Fig 18.3</h2>
<section id="iso-probability-lines" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="iso-probability-lines">Iso-probability lines</h3>
<p>For radiologists, it is natural to consider the pre-chemotherapy mass size and post-chemotherapy mass size. According to our analysis, the key information is the pre-chemotherapy size and the reduction in size. These pieces of information need to be considered jointly with the 4 other predictors (Teratoma, 3 tumor markers). We attempted to convey this message in iso-probability lines (Fig 18.3) <a href="https://www.ncbi.nlm.nih.gov/pubmed/10796922">Radiology</a></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Radiology paper: could graph pre - post with lines for score 1 - 4</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>score4  <span class="ot">&lt;-</span> n544<span class="sc">$</span>Teratoma<span class="sc">+</span>n544<span class="sc">$</span>Pre.AFP<span class="sc">+</span>n544<span class="sc">$</span>Pre.HCG<span class="sc">+</span>n544<span class="sc">$</span>Pre.lnLDH</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>full.simple3 <span class="ot">&lt;-</span> <span class="fu">lrm</span>(Necrosis <span class="sc">~</span> score4 <span class="sc">+</span> sqpost <span class="sc">+</span> reduc10, <span class="at">data=</span>n544, <span class="at">x=</span>T, <span class="at">y=</span>T)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(full.simple3<span class="sc">$</span>coef), <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">"left"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">full.simple3$coef</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Intercept</td>
<td style="text-align: right;">-1.20</td>
</tr>
<tr class="even">
<td style="text-align: left;">score4</td>
<td style="text-align: right;">0.89</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sqpost</td>
<td style="text-align: right;">-0.27</td>
</tr>
<tr class="even">
<td style="text-align: left;">reduc10</td>
<td style="text-align: right;">0.17</td>
</tr>
</tbody>
</table>
</div>
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a presize variable, based on reduction and postsize</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># reduc = (pre-post) / pre; reduc = 1 - post/pre; reduc-1 = -post/pre; pre = -post/(reduc-1)</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>presize <span class="ot">&lt;-</span> <span class="sc">-</span> n544<span class="sc">$</span>sqpost<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">ifelse</span>((n544<span class="sc">$</span>reduc10<span class="sc">/</span><span class="dv">10</span> <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">!=</span> <span class="dv">0</span>,(n544<span class="sc">$</span>reduc10<span class="sc">/</span><span class="dv">10</span> <span class="sc">-</span> <span class="dv">1</span>),<span class="sc">-</span>.<span class="dv">04</span>)  </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Now calculate iso probability lines: e.g. prob -70%, </span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate PRESIZE from SQPOST, for given probabilities</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># presize = f(sqpost, plogis(full))</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># pre = -post/(reduc10-10) # for reduc10&lt;10</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># range sqpost from 2 to 50; score 4 0 - 4</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Fig 18.3 ##</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># matrix with sqpost and scores</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>),<span class="dv">5</span>),<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">50</span>),<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">50</span>),<span class="fu">rep</span>(<span class="dv">2</span>,<span class="dv">50</span>),<span class="fu">rep</span>(<span class="dv">3</span>,<span class="dv">50</span>),<span class="fu">rep</span>(<span class="dv">4</span>,<span class="dv">50</span>))))</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co"># linear predictor from simple model 'full.simple3'</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>lp.simple3  <span class="ot">&lt;-</span> x <span class="sc">%*%</span> full.simple3<span class="sc">$</span>coef[<span class="dv">3</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">+</span> full.simple3<span class="sc">$</span>coef[<span class="dv">1</span>]</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co"># now calculate reduc10 with condition p=70% etc</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve equation qlogis(.7) = lp.simple3 + full.simple3$coef[4] * n544$REDUC10</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>reduc10<span class="fl">.70</span> <span class="ot">&lt;-</span> (<span class="fu">qlogis</span>(.<span class="dv">7</span>) <span class="sc">-</span> lp.simple3) <span class="sc">/</span>full.simple3<span class="sc">$</span>coef[<span class="dv">4</span>]</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate presizes: pre = -post/(reduc10/10-1)</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>presize<span class="fl">.70</span>  <span class="ot">&lt;-</span> <span class="sc">-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>,<span class="dv">5</span>) <span class="sc">/</span> (reduc10<span class="fl">.70</span><span class="sc">/</span><span class="dv">10-1</span>)</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co"># in 1 formula for efficiency</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>presize<span class="fl">.90</span>  <span class="ot">&lt;-</span> <span class="sc">-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>,<span class="dv">5</span>) <span class="sc">/</span> (((<span class="fu">qlogis</span>(.<span class="dv">9</span>) <span class="sc">-</span> lp.simple3) <span class="sc">/</span>(full.simple3<span class="sc">$</span>coef[<span class="dv">4</span>])<span class="sc">/</span><span class="dv">10</span>) <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>presize<span class="fl">.80</span>  <span class="ot">&lt;-</span> <span class="sc">-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>,<span class="dv">5</span>) <span class="sc">/</span> (((<span class="fu">qlogis</span>(.<span class="dv">8</span>) <span class="sc">-</span> lp.simple3) <span class="sc">/</span>(full.simple3<span class="sc">$</span>coef[<span class="dv">4</span>])<span class="sc">/</span><span class="dv">10</span>) <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>presize<span class="fl">.60</span>  <span class="ot">&lt;-</span> <span class="sc">-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>,<span class="dv">5</span>) <span class="sc">/</span> (((<span class="fu">qlogis</span>(.<span class="dv">6</span>) <span class="sc">-</span> lp.simple3) <span class="sc">/</span>(full.simple3<span class="sc">$</span>coef[<span class="dv">4</span>])<span class="sc">/</span><span class="dv">10</span>) <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>presize<span class="fl">.50</span>  <span class="ot">&lt;-</span> <span class="sc">-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>,<span class="dv">5</span>) <span class="sc">/</span> (((<span class="fu">qlogis</span>(.<span class="dv">5</span>) <span class="sc">-</span> lp.simple3) <span class="sc">/</span>(full.simple3<span class="sc">$</span>coef[<span class="dv">4</span>])<span class="sc">/</span><span class="dv">10</span>) <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="co"># make Postsize from sqpost</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>x[,<span class="dv">1</span>] <span class="ot">&lt;-</span> x[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="co"># combine results</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">cbind</span>(x,lp.simple3,</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>        reduc10<span class="fl">.70</span>, presize<span class="fl">.70</span>, presize<span class="fl">.90</span>,presize<span class="fl">.80</span>,presize<span class="fl">.60</span>,presize<span class="fl">.50</span> ))</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(x) <span class="ot">&lt;-</span> <span class="fu">Cs</span>(postsize, score4,lp,reduc1070,</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>          presize70,presize90,presize80,presize60,presize50)</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(x)</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>x[x<span class="sc">&lt;</span><span class="dv">0</span>]  <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Make some plots; isoprobability lines for different scores, x-axis=postsize</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">3</span>,.<span class="dv">5</span>))</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>  xp <span class="ot">=</span> x[x<span class="sc">$</span>score4<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(x<span class="sc">$</span>presize50) <span class="sc">&amp;</span> x<span class="sc">$</span>presize50<span class="sc">&lt;</span><span class="dv">100</span> <span class="sc">&amp;</span> x<span class="sc">$</span>postsize<span class="sc">&lt;</span><span class="dv">50</span>, ]</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>  xp <span class="ot">=</span> xp[<span class="fu">sort</span>(xp<span class="sc">$</span>presize50),]</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">y=</span>xp<span class="sc">$</span>postsize,<span class="at">x=</span>xp<span class="sc">$</span>presize50, <span class="at">main=</span><span class="fu">paste</span>(<span class="st">"Score="</span>,i,<span class="at">sep=</span><span class="st">""</span>),</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab=</span><span class="st">'Postchemo size (mm)'</span>, <span class="at">xlab=</span><span class="st">"Prechemo size (mm)"</span>, </span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>),<span class="at">type=</span><span class="st">"l"</span>, <span class="at">pch=</span><span class="st">"5"</span>, <span class="at">axes=</span>F,<span class="at">las=</span><span class="dv">1</span>, <span class="at">col=</span>mycolors[<span class="dv">5</span>], <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">2</span>,<span class="at">at=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">50</span>))</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>,<span class="at">at=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">20</span>,<span class="dv">50</span>,<span class="dv">100</span>))</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (i<span class="sc">==</span><span class="dv">1</span>) <span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">col=</span>mycolors[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>)], <span class="at">lwd=</span><span class="dv">2</span>,<span class="at">bty=</span><span class="st">"n"</span>,</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>                 <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"50%"</span>, <span class="st">"60"</span>, <span class="st">"70%"</span>, <span class="st">"80%"</span>, <span class="st">"90%"</span>))</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>xp <span class="ot">=</span> x[x<span class="sc">$</span>score4<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(x<span class="sc">$</span>presize60), ]</span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>xp <span class="ot">=</span> xp[<span class="fu">sort</span>(xp<span class="sc">$</span>presize60),]</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">y=</span>xp<span class="sc">$</span>postsize,<span class="at">x=</span>xp<span class="sc">$</span>presize60, <span class="at">pch=</span><span class="st">"6"</span>,<span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span>mycolors[<span class="dv">4</span>], <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>xp <span class="ot">=</span> x[x<span class="sc">$</span>score4<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(x<span class="sc">$</span>presize70), ]</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>xp <span class="ot">=</span> xp[<span class="fu">sort</span>(xp<span class="sc">$</span>presize70),]</span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">y=</span>xp<span class="sc">$</span>postsize,<span class="at">x=</span>xp<span class="sc">$</span>presize70, <span class="at">pch=</span><span class="st">"7"</span>,<span class="at">lty=</span><span class="dv">1</span>, <span class="at">col=</span>mycolors[<span class="dv">2</span>], <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>xp <span class="ot">=</span> x[x<span class="sc">$</span>score4<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(x<span class="sc">$</span>presize80), ]</span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>xp <span class="ot">=</span> xp[<span class="fu">sort</span>(xp<span class="sc">$</span>presize80),]</span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">y=</span>xp<span class="sc">$</span>postsize,<span class="at">x=</span>xp<span class="sc">$</span>presize80, <span class="at">pch=</span><span class="st">"8"</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span>mycolors[<span class="dv">3</span>], <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>xp <span class="ot">=</span> x[x<span class="sc">$</span>score4<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(x<span class="sc">$</span>presize90), ]</span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>xp <span class="ot">=</span> xp[<span class="fu">sort</span>(xp<span class="sc">$</span>presize90),]</span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">y=</span>xp<span class="sc">$</span>postsize,<span class="at">x=</span>xp<span class="sc">$</span>presize90, <span class="at">pch=</span><span class="st">"9"</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">col=</span>mycolors[<span class="dv">6</span>], <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>} <span class="co"># end loop over score 1 - 4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fig/Fig18.3-1.png" class="img-fluid figure-img" width="1122"></p>
</figure>
</div>
</div>
</div>
<p>So, we obtain some nice graphics. With score 0, men are at high risk of tumor. With score 4, even a relatively large post-chemotherapy mass size leads to high probabilities of necrosis, especially if the pre-chemotherapy mass was large.</p>
</section>
</section>
<section id="fig-18.4" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="fig-18.4">Fig 18.4</h2>
<section id="meta-model-with-tree-presentation" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="meta-model-with-tree-presentation">Meta-model with tree presentation</h3>
<p>We can present a decision rule for patients with testicular cancer, assuming a threshold of 70% for the probability of necrosis. If the probability is higher than 70%, this is a good prognosis group which could be spared surgery.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Start with dichotomizing predictions from full as &lt;70% vs &gt;=70%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>predhigh <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">plogis</span>(full<span class="sc">$</span>linear.predictor)<span class="sc">&lt;</span>.<span class="dv">7</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Try to make tree model for this outcome</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>tree.orig <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Necrosis <span class="sc">~</span> Teratoma<span class="sc">+</span>Pre.AFP<span class="sc">+</span>Pre.HCG<span class="sc">+</span>LDHst<span class="sc">+</span>Post.size<span class="sc">+</span>Reduction,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>n544)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tree.orig)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(tree.orig, <span class="at">use.n=</span>F)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Meta-model for original predictions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fig/Fig18.4-1.png" class="img-fluid figure-img" width="1122"></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>tree.meta <span class="ot">&lt;-</span> <span class="fu">rpart</span>(predhigh <span class="sc">~</span> Teratoma<span class="sc">+</span>Pre.AFP<span class="sc">+</span>Pre.HCG<span class="sc">+</span>LDHst<span class="sc">+</span>Post.size<span class="sc">+</span>Reduction,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>n544)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tree.meta)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(tree.meta, <span class="at">use.n=</span>F)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Meta-model for probability &gt; 70%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fig/Fig18.4-2.png" class="img-fluid figure-img" width="1122"></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Make smooth tree presentation; classification with reduction, teratoma, AFP</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>score3  <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(n544<span class="sc">$</span>Reduction<span class="sc">&gt;</span><span class="dv">70</span>)<span class="sc">+</span><span class="fu">as.numeric</span>(n544<span class="sc">$</span>Teratoma<span class="sc">==</span><span class="dv">1</span>)<span class="sc">+</span><span class="fu">as.numeric</span>(n544<span class="sc">$</span>Pre.AFP<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>tree.cat  <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(n544<span class="sc">$</span>Reduction<span class="sc">&gt;</span><span class="dv">50</span> <span class="sc">&amp;</span> score3<span class="sc">&gt;=</span><span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>tree.results <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(n544<span class="sc">$</span>tree.cat, n544<span class="sc">$</span>Necrosis))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tree.results) <span class="ot">&lt;-</span> <span class="fu">Cs</span>(<span class="st">"Risk group"</span>, Necrosis, N)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tree.results, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">"left"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Risk group</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Necrosis</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">N</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: right;">264</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">0</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">134</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">111</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>end tree analysis</p>
</section>
</section>
<section id="apparent-performance-of-penalized-vs-rescaled-vs-simplified-models" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="apparent-performance-of-penalized-vs-rescaled-vs-simplified-models">Apparent performance of penalized vs rescaled vs simplified models</h2>
<p>What is the c statistic of various formats to predict necrosis at resection after chemotherapy? a) nomogram (Fig 18.1): original or penalized coefficients, negligable difference expected b) score chart (Table 18.2 and Fig 18.2): rounding, minor decline expected c) simple table (Table 18.3): categorization and simplification, much loss expected d) iso-probability lines (Fig 18.3): major predictors (size, reduction) kept continuous, some loss expected e) tree on a meta-model (Fig 18.4): ultra simple, major loss in performance expected</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 variants of full model fit</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>cstats <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rcorr.cens</span>(full<span class="sc">$</span>linear.predictor, n544<span class="sc">$</span>Necrosis)[<span class="dv">1</span>],</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rcorr.cens</span>(full.shrunk<span class="sc">$</span>linear.predictor, n544<span class="sc">$</span>Necrosis)[<span class="dv">1</span>],</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rcorr.cens</span>(full.pen<span class="sc">$</span>linear.predictor, n544<span class="sc">$</span>Necrosis)[<span class="dv">1</span>],</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rounding for score chart</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rcorr.cens</span>(score.fit<span class="sc">$</span>linear.predictor, n544<span class="sc">$</span>Necrosis)[<span class="dv">1</span>],</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simple table</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rcorr.cens</span>(n544<span class="sc">$</span>simple.cat, n544<span class="sc">$</span>Necrosis)[<span class="dv">1</span>],</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Radiology paper</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rcorr.cens</span>(full.simple3<span class="sc">$</span>linear.predictor, n544<span class="sc">$</span>Necrosis)[<span class="dv">1</span>],</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tree</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rcorr.cens</span>(n544<span class="sc">$</span>tree.cat, n544<span class="sc">$</span>Necrosis)[<span class="dv">1</span>])</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cstats) <span class="ot">&lt;-</span> <span class="fu">Cs</span>(full, shrunk, penalized, scores, table, radiology, tree)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(cstats) <span class="ot">&lt;-</span> <span class="st">"C"</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="fu">dotchart</span>(cstats, <span class="at">xlab=</span><span class="st">"C statistic"</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="fl">0.6</span>,.<span class="dv">9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fig/performance-1.png" class="img-fluid figure-img" width="1122"></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(cstats), <span class="at">digits =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">"left"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">full</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">shrunk</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">penalized</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">scores</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">table</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">radiology</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">tree</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: right;">0.839</td>
<td style="text-align: right;">0.839</td>
<td style="text-align: right;">0.839</td>
<td style="text-align: right;">0.838</td>
<td style="text-align: right;">0.725</td>
<td style="text-align: right;">0.838</td>
<td style="text-align: right;">0.668</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="end-comparisons-of-c-statistics" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="end-comparisons-of-c-statistics">End comparisons of c statistics</h3>
<p>As expected, the apparent performance of penalized vs rescaled models was very similar. Two formats led to a substantial loss in performance:</p>
<ul>
<li>simple table (Table 18.3): categorization and simplification, c=0.73 cp to c=0.84<br>
</li>
<li>tree on a meta-model (Fig 18.4): ultra simple, c=0.67, for a single threshold to classify men as low risk and spare them resection.</li>
</ul>
<p>Please use and improve the code above when desired. The major tools for presentation are:<br>
1. The <code>nomogram</code> function: allows for scores with categorical and continuous predictors, with transformations.<br>
2. The regression formula: can be implemented in wwww tools, including the <a href="https://www.evidencio.com/models">Evidencio</a> toolbox.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/17-validation.html" class="pagination-link" aria-label="Validation of Prediction Models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Validation of Prediction Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/19-external-validity.html" class="pagination-link" aria-label="Patterns of External Validity">
        <span class="nav-page-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Patterns of External Validity</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Clinical Prediction Models</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/clinical-prediction-models/supplementary-material/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a> and <a href="https://posit.co/products/open-source/rstudio/">RStudio</a></p>
</div>
  </div>
</footer>




</body></html>