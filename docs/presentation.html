<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>18 Presentation Formats | Clinical prediction models</title>
  <meta name="description" content="18 Presentation Formats | Clinical prediction models" />
  <meta name="generator" content="bookdown 0.30 and GitBook 2.6.7" />

  <meta property="og:title" content="18 Presentation Formats | Clinical prediction models" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="clinical-prediction-models/supplementary-material" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="18 Presentation Formats | Clinical prediction models" />
  
  
  

<meta name="author" content="Ewout Steyerberg" />


<meta name="date" content="2023-01-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="validation.html"/>
<link rel="next" href="external-validity.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Clinical Prediction Models</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="part"><span><b>I Part I: Prediction models in medicine</b></span></li>
<li class="chapter" data-level="2" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>2</b> Applications of Prediction Models</a></li>
<li class="chapter" data-level="3" data-path="design.html"><a href="design.html"><i class="fa fa-check"></i><b>3</b> Study Design for Prediction Modeling</a></li>
<li class="chapter" data-level="4" data-path="statmods.html"><a href="statmods.html"><i class="fa fa-check"></i><b>4</b> Statistical Models for Prediction</a></li>
<li class="chapter" data-level="5" data-path="overfitting.html"><a href="overfitting.html"><i class="fa fa-check"></i><b>5</b> Overfitting and Optimism in Prediction Models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="overfitting.html"><a href="overfitting.html#figures-5.2-to-5.5"><i class="fa fa-check"></i><b>5.1</b> Figures 5.2 to 5.5</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="overfitting.html"><a href="overfitting.html#fig-5.2-noise-in-estimating-10-mortality-per-center"><i class="fa fa-check"></i><b>5.1.1</b> Fig 5.2: Noise in estimating 10% mortality per center</a></li>
<li class="chapter" data-level="5.1.2" data-path="overfitting.html"><a href="overfitting.html#figs-5.3-and-5.4"><i class="fa fa-check"></i><b>5.1.2</b> Figs 5.3 and 5.4</a></li>
<li class="chapter" data-level="5.1.3" data-path="overfitting.html"><a href="overfitting.html#n20"><i class="fa fa-check"></i><b>5.1.3</b> n=20</a></li>
<li class="chapter" data-level="5.1.4" data-path="overfitting.html"><a href="overfitting.html#n200"><i class="fa fa-check"></i><b>5.1.4</b> n=200</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="altmods.html"><a href="altmods.html"><i class="fa fa-check"></i><b>6</b> Choosing Between Alternative Models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="altmods.html"><a href="altmods.html#non-linearity-illustrations"><i class="fa fa-check"></i><b>6.1</b> Non-linearity illustrations</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="altmods.html"><a href="altmods.html#prepare-gusto-data"><i class="fa fa-check"></i><b>6.1.1</b> Prepare GUSTO data</a></li>
<li class="chapter" data-level="6.1.2" data-path="altmods.html"><a href="altmods.html#anova-results-for-the-different-fits"><i class="fa fa-check"></i><b>6.1.2</b> anova results for the different fits</a></li>
<li class="chapter" data-level="6.1.3" data-path="altmods.html"><a href="altmods.html#plotting-of-age-effects"><i class="fa fa-check"></i><b>6.1.3</b> Plotting of age effects</a></li>
<li class="chapter" data-level="6.1.4" data-path="altmods.html"><a href="altmods.html#start-surgical-mortality-by-age-in-medicare"><i class="fa fa-check"></i><b>6.1.4</b> Start surgical mortality by age in Medicare</a></li>
<li class="chapter" data-level="6.1.5" data-path="altmods.html"><a href="altmods.html#anova-results-for-the-fit-of-age-with-interaction-by-type-of-surgery"><i class="fa fa-check"></i><b>6.1.5</b> anova results for the fit of age, with interaction by type of surgery</a></li>
<li class="chapter" data-level="6.1.6" data-path="altmods.html"><a href="altmods.html#plotting-of-predicted-age-effects-with-interaction-by-type-of-surgery-add-95-ci"><i class="fa fa-check"></i><b>6.1.6</b> Plotting of predicted age effects, with interaction by type of surgery; add 95% CI</a></li>
<li class="chapter" data-level="6.1.7" data-path="altmods.html"><a href="altmods.html#plotting-of-age-effects-with-original-data-points"><i class="fa fa-check"></i><b>6.1.7</b> Plotting of age effects with original data points</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Part II: Developing Valid Prediction Models</b></span></li>
<li class="chapter" data-level="7" data-path="missing.html"><a href="missing.html"><i class="fa fa-check"></i><b>7</b> Missing values</a></li>
<li class="chapter" data-level="8" data-path="missing-case.html"><a href="missing-case.html"><i class="fa fa-check"></i><b>8</b> Case Study on Dealing with Missing Values</a></li>
<li class="chapter" data-level="9" data-path="coding.html"><a href="coding.html"><i class="fa fa-check"></i><b>9</b> Coding of Categorical and Continuous Predictors</a>
<ul>
<li class="chapter" data-level="9.1" data-path="coding.html"><a href="coding.html#figues-9.1-to-9.6"><i class="fa fa-check"></i><b>9.1</b> Figues 9.1 to 9.6</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="coding.html"><a href="coding.html#fig-9.1-age-linear-add-square-rcs-in-gusto-i"><i class="fa fa-check"></i><b>9.1.1</b> Fig 9.1: Age linear; add square; rcs in GUSTO-I</a></li>
<li class="chapter" data-level="9.1.2" data-path="coding.html"><a href="coding.html#fig-9.2-impact-of-number-of-st-elevations-ste"><i class="fa fa-check"></i><b>9.1.2</b> Fig 9.2: Impact of number of ST elevations (STE)</a></li>
<li class="chapter" data-level="9.1.3" data-path="coding.html"><a href="coding.html#fig-9.3-non-linearities-in-small-sample-n751-and-full-gusto-i-n40830"><i class="fa fa-check"></i><b>9.1.3</b> Fig 9.3: Non-linearities in small sample (n=751); and full GUSTO-I (n=40,830)</a></li>
<li class="chapter" data-level="9.1.4" data-path="coding.html"><a href="coding.html#fig-9.4-glucose-and-hb-in-tbi"><i class="fa fa-check"></i><b>9.1.4</b> Fig 9.4: Glucose and hb in TBI</a></li>
<li class="chapter" data-level="9.1.5" data-path="coding.html"><a href="coding.html#fig-9.5-non-linear-association-of-glucose"><i class="fa fa-check"></i><b>9.1.5</b> Fig 9.5: Non-linear association of glucose</a></li>
<li class="chapter" data-level="9.1.6" data-path="coding.html"><a href="coding.html#fig-9.6-systolic-blood-pressure-in-tbi"><i class="fa fa-check"></i><b>9.1.6</b> Fig 9.6: Systolic blood pressure in TBI</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="restrictions.html"><a href="restrictions.html"><i class="fa fa-check"></i><b>10</b> Restrictions on Candidate Predictors</a></li>
<li class="chapter" data-level="11" data-path="selection.html"><a href="selection.html"><i class="fa fa-check"></i><b>11</b> Selection of Main Effects</a></li>
<li class="chapter" data-level="12" data-path="additivity-linearity.html"><a href="additivity-linearity.html"><i class="fa fa-check"></i><b>12</b> Assumptions in Regression Models - Additivity and Linearity</a>
<ul>
<li class="chapter" data-level="12.1" data-path="additivity-linearity.html"><a href="additivity-linearity.html#gusto-i-interaction-analysis"><i class="fa fa-check"></i><b>12.1</b> GUSTO-I interaction analysis</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="additivity-linearity.html"><a href="additivity-linearity.html#examine-interactions"><i class="fa fa-check"></i><b>12.1.1</b> Examine interactions</a></li>
<li class="chapter" data-level="12.1.2" data-path="additivity-linearity.html"><a href="additivity-linearity.html#fig-12.1"><i class="fa fa-check"></i><b>12.1.2</b> Fig 12.1</a></li>
<li class="chapter" data-level="12.1.3" data-path="additivity-linearity.html"><a href="additivity-linearity.html#fig-12.2"><i class="fa fa-check"></i><b>12.1.3</b> Fig 12.2</a></li>
<li class="chapter" data-level="12.1.4" data-path="additivity-linearity.html"><a href="additivity-linearity.html#smart-coding-illustration"><i class="fa fa-check"></i><b>12.1.4</b> Smart coding illustration</a></li>
<li class="chapter" data-level="12.1.5" data-path="additivity-linearity.html"><a href="additivity-linearity.html#table-12.2-better-predictions"><i class="fa fa-check"></i><b>12.1.5</b> Table 12.2 Better predictions?</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="additivity-linearity.html"><a href="additivity-linearity.html#mfp-and-other-non-linear-analyses-in-n544-data"><i class="fa fa-check"></i><b>12.2</b> MFP and other non-linear analyses in n544 data</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="estimation.html"><a href="estimation.html"><i class="fa fa-check"></i><b>13</b> Modern Estimation Methods</a></li>
<li class="chapter" data-level="14" data-path="estimation-external.html"><a href="estimation-external.html"><i class="fa fa-check"></i><b>14</b> Estimation with External Information</a>
<ul>
<li class="chapter" data-level="" data-path="estimation-external.html"><a href="estimation-external.html#learning-from-external-information"><i class="fa fa-check"></i>Learning from external information</a>
<ul>
<li class="chapter" data-level="14.0.1" data-path="estimation-external.html"><a href="estimation-external.html#a-local-model-with-external-information-table-14.1"><i class="fa fa-check"></i><b>14.0.1</b> A local model with external information: Table 14.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="estimation-external.html"><a href="estimation-external.html#the-data-tbi-n11022-and-aaa-n238-data-sets"><i class="fa fa-check"></i>The data: TBI (n=11022) and AAA (n=238) data sets</a></li>
<li class="chapter" data-level="" data-path="estimation-external.html"><a href="estimation-external.html#the-impact-study"><i class="fa fa-check"></i>The impact study</a>
<ul>
<li class="chapter" data-level="14.0.2" data-path="estimation-external.html"><a href="estimation-external.html#descriptives"><i class="fa fa-check"></i><b>14.0.2</b> Descriptives</a></li>
<li class="chapter" data-level="14.0.3" data-path="estimation-external.html"><a href="estimation-external.html#analyses-for-table-14.2"><i class="fa fa-check"></i><b>14.0.3</b> Analyses for Table 14.2</a></li>
<li class="chapter" data-level="14.0.4" data-path="estimation-external.html"><a href="estimation-external.html#estimation-of-coefficients-naive-stratified-and-ipd-ma"><i class="fa fa-check"></i><b>14.0.4</b> Estimation of coefficients: naive, stratified and IPD-MA</a></li>
<li class="chapter" data-level="14.0.5" data-path="estimation-external.html"><a href="estimation-external.html#estimation-of-standard-errors"><i class="fa fa-check"></i><b>14.0.5</b> Estimation of standard errors</a></li>
<li class="chapter" data-level="14.0.6" data-path="estimation-external.html"><a href="estimation-external.html#estimation-for-a-specific-study-assuming-a-global-model-holds"><i class="fa fa-check"></i><b>14.0.6</b> Estimation for a specific study, assuming a global model holds</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="estimation-external.html"><a href="estimation-external.html#the-aaa-study"><i class="fa fa-check"></i>The AAA study</a>
<ul>
<li class="chapter" data-level="14.0.7" data-path="estimation-external.html"><a href="estimation-external.html#descriptives-1"><i class="fa fa-check"></i><b>14.0.7</b> Descriptives</a></li>
<li class="chapter" data-level="14.0.8" data-path="estimation-external.html"><a href="estimation-external.html#literature-univariate-estimates-table-14.4"><i class="fa fa-check"></i><b>14.0.8</b> Literature, univariate estimates: Table 14.4</a></li>
<li class="chapter" data-level="14.0.9" data-path="estimation-external.html"><a href="estimation-external.html#a-simple-prediction-model-table-14.5"><i class="fa fa-check"></i><b>14.0.9</b> A simple prediction model: Table 14.5</a></li>
<li class="chapter" data-level="14.0.10" data-path="estimation-external.html"><a href="estimation-external.html#adaptation-of-univariate-coefficients-table-14.6"><i class="fa fa-check"></i><b>14.0.10</b> Adaptation of univariate coefficients: Table 14.6</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="estimation-external.html"><a href="estimation-external.html#conclusions"><i class="fa fa-check"></i>Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="evaluation.html"><a href="evaluation.html"><i class="fa fa-check"></i><b>15</b> Evaluation of Performance</a></li>
<li class="chapter" data-level="16" data-path="usefulness.html"><a href="usefulness.html"><i class="fa fa-check"></i><b>16</b> Evaluation of Clinical Usefulness</a></li>
<li class="chapter" data-level="17" data-path="validation.html"><a href="validation.html"><i class="fa fa-check"></i><b>17</b> Validation of Prediction Models</a></li>
<li class="chapter" data-level="18" data-path="presentation.html"><a href="presentation.html"><i class="fa fa-check"></i><b>18</b> Presentation Formats</a>
<ul>
<li class="chapter" data-level="18.1" data-path="presentation.html"><a href="presentation.html#fit-logistic-models-in-n544-data-set-6-predictors"><i class="fa fa-check"></i><b>18.1</b> Fit logistic models in n544 data set; 6 predictors</a>
<ul>
<li class="chapter" data-level="18.1.1" data-path="presentation.html"><a href="presentation.html#internal-validation-by-bootstrapping"><i class="fa fa-check"></i><b>18.1.1</b> Internal validation by bootstrapping</a></li>
<li class="chapter" data-level="18.1.2" data-path="presentation.html"><a href="presentation.html#shrunk-model-and-penalization"><i class="fa fa-check"></i><b>18.1.2</b> Shrunk model and penalization</a></li>
<li class="chapter" data-level="18.1.3" data-path="presentation.html"><a href="presentation.html#fit-penalized-model-and-compare-fits"><i class="fa fa-check"></i><b>18.1.3</b> Fit penalized model and compare fits</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="presentation.html"><a href="presentation.html#fig-18.1"><i class="fa fa-check"></i>Fig 18.1</a>
<ul>
<li class="chapter" data-level="18.1.4" data-path="presentation.html"><a href="presentation.html#make-nomogram-from-penalized-model"><i class="fa fa-check"></i><b>18.1.4</b> Make nomogram from penalized model</a></li>
<li class="chapter" data-level="18.1.5" data-path="presentation.html"><a href="presentation.html#score-chart-creation-with-categorized-and-continuous-predictors"><i class="fa fa-check"></i><b>18.1.5</b> Score chart creation with categorized and continuous predictors</a></li>
<li class="chapter" data-level="18.1.6" data-path="presentation.html"><a href="presentation.html#consider-making-rounded-scores-from-penalized-coefs"><i class="fa fa-check"></i><b>18.1.6</b> Consider making rounded scores from penalized coefs</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="presentation.html"><a href="presentation.html#scores-for-continuous-predictors"><i class="fa fa-check"></i><b>18.2</b> Scores for continuous predictors</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="presentation.html"><a href="presentation.html#ldh"><i class="fa fa-check"></i><b>18.2.1</b> LDH</a></li>
<li class="chapter" data-level="18.2.2" data-path="presentation.html"><a href="presentation.html#study-scores-for-postchemotherapy-size"><i class="fa fa-check"></i><b>18.2.2</b> Study scores for postchemotherapy size</a></li>
<li class="chapter" data-level="18.2.3" data-path="presentation.html"><a href="presentation.html#study-scores-for-reduction-in-size"><i class="fa fa-check"></i><b>18.2.3</b> Study scores for reduction in size</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="presentation.html"><a href="presentation.html#table-18.2"><i class="fa fa-check"></i>Table 18.2</a>
<ul>
<li class="chapter" data-level="18.2.4" data-path="presentation.html"><a href="presentation.html#make-a-score-chart"><i class="fa fa-check"></i><b>18.2.4</b> Make a score chart</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="presentation.html"><a href="presentation.html#fig-18.2"><i class="fa fa-check"></i>Fig 18.2</a>
<ul>
<li class="chapter" data-level="18.2.5" data-path="presentation.html"><a href="presentation.html#translate-score-in-probability-estimates-with-95-ci"><i class="fa fa-check"></i><b>18.2.5</b> Translate score in probability estimates with 95% CI</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="presentation.html"><a href="presentation.html#end-table-18.2-score-chart-and-fig-18.2-graphic-translation-from-score-to-probability"><i class="fa fa-check"></i>End Table 18.2 (score chart) and Fig 18.2 (graphic translation from score to probability)</a>
<ul>
<li class="chapter" data-level="18.2.6" data-path="presentation.html"><a href="presentation.html#categorized-coding"><i class="fa fa-check"></i><b>18.2.6</b> Categorized coding</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="presentation.html"><a href="presentation.html#table-18.3"><i class="fa fa-check"></i>Table 18.3</a>
<ul>
<li class="chapter" data-level="18.2.7" data-path="presentation.html"><a href="presentation.html#alternative-make-a-score-from-0---5"><i class="fa fa-check"></i><b>18.2.7</b> Alternative: make a score from 0 - 5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="presentation.html"><a href="presentation.html#fig-18.3"><i class="fa fa-check"></i>Fig 18.3</a>
<ul>
<li class="chapter" data-level="18.2.8" data-path="presentation.html"><a href="presentation.html#iso-probability-lines"><i class="fa fa-check"></i><b>18.2.8</b> Iso-probability lines</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="presentation.html"><a href="presentation.html#fig-18.4"><i class="fa fa-check"></i>Fig 18.4</a>
<ul>
<li class="chapter" data-level="18.2.9" data-path="presentation.html"><a href="presentation.html#meta-model-with-tree-presentation"><i class="fa fa-check"></i><b>18.2.9</b> Meta-model with tree presentation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="presentation.html"><a href="presentation.html#apparent-performance-of-penalized-vs-rescaled-vs-simplified-models"><i class="fa fa-check"></i>Apparent performance of penalized vs rescaled vs simplified models</a>
<ul>
<li class="chapter" data-level="18.2.10" data-path="presentation.html"><a href="presentation.html#end-comparisons-of-c-statistics"><i class="fa fa-check"></i><b>18.2.10</b> End comparisons of c statistics</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Part III: Generalizability of Prediction Models</b></span></li>
<li class="chapter" data-level="19" data-path="external-validity.html"><a href="external-validity.html"><i class="fa fa-check"></i><b>19</b> Patterns of External Validity</a>
<ul>
<li class="chapter" data-level="19.0.1" data-path="external-validity.html"><a href="external-validity.html#fig-19.1-a-missed-predictor-z"><i class="fa fa-check"></i><b>19.0.1</b> Fig 19.1: a missed predictor Z</a></li>
<li class="chapter" data-level="19.0.2" data-path="external-validity.html"><a href="external-validity.html#fig-19.2-a-missed-predictor-z-with-identical-distribution"><i class="fa fa-check"></i><b>19.0.2</b> Fig 19.2: a missed predictor Z with identical distribution</a></li>
<li class="chapter" data-level="19.0.3" data-path="external-validity.html"><a href="external-validity.html#fig-19.3-more-or-less-severe-cases-selected"><i class="fa fa-check"></i><b>19.0.3</b> Fig 19.3: more or less severe cases selected</a></li>
<li class="chapter" data-level="19.0.4" data-path="external-validity.html"><a href="external-validity.html#fig-19.4-more-or-less-heterogeneous-cases-selected"><i class="fa fa-check"></i><b>19.0.4</b> Fig 19.4: more or less heterogeneous cases selected</a></li>
<li class="chapter" data-level="19.0.5" data-path="external-validity.html"><a href="external-validity.html#fig-19.5-more-or-less-severe-cases-selected-by-z"><i class="fa fa-check"></i><b>19.0.5</b> Fig 19.5: more or less severe cases selected by Z</a></li>
<li class="chapter" data-level="19.0.6" data-path="external-validity.html"><a href="external-validity.html#fig-19.6-more-or-less-heterogeneous-cases-selected-by-z"><i class="fa fa-check"></i><b>19.0.6</b> Fig 19.6: more or less heterogeneous cases selected by Z</a></li>
<li class="chapter" data-level="19.1" data-path="external-validity.html"><a href="external-validity.html#fig-19.7-case-control-design-disturbs-calibration"><i class="fa fa-check"></i><b>19.1</b> Fig 19.7: Case-control design disturbs calibration</a>
<ul>
<li class="chapter" data-level="19.1.1" data-path="external-validity.html"><a href="external-validity.html#fig-19.8-overfitting-disturbs-discrimination-and-calibration"><i class="fa fa-check"></i><b>19.1.1</b> Fig 19.8: Overfitting disturbs discrimination and calibration</a></li>
<li class="chapter" data-level="19.1.2" data-path="external-validity.html"><a href="external-validity.html#fig-19.9-different-coeficients-model-misspecification-disturbs-discrimination-and-calibration"><i class="fa fa-check"></i><b>19.1.2</b> Fig 19.9: Different coeficients (model misspecification) disturbs discrimination and calibration</a></li>
<li class="chapter" data-level="19.1.3" data-path="external-validity.html"><a href="external-validity.html#scenarios-table-19.4"><i class="fa fa-check"></i><b>19.1.3</b> Scenarios: Table 19.4</a></li>
<li class="chapter" data-level="19.1.4" data-path="external-validity.html"><a href="external-validity.html#uncertainty-in-validation-simulations"><i class="fa fa-check"></i><b>19.1.4</b> Uncertainty in validation simulations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="updating.html"><a href="updating.html"><i class="fa fa-check"></i><b>20</b> Updating for a New Setting</a></li>
<li class="chapter" data-level="21" data-path="updating-multiple.html"><a href="updating-multiple.html"><i class="fa fa-check"></i><b>21</b> Updating for Multiple Settings</a></li>
<li class="part"><span><b>IV Part IIII: Applications</b></span></li>
<li class="chapter" data-level="22" data-path="case-study-gusto.html"><a href="case-study-gusto.html"><i class="fa fa-check"></i><b>22</b> Case Study on a Prediction of 30-Day Mortality</a></li>
<li class="chapter" data-level="23" data-path="case-study-cardiovascular.html"><a href="case-study-cardiovascular.html"><i class="fa fa-check"></i><b>23</b> Case Study on Survival Analysis: Prediction of Cardiovascular Event</a></li>
<li class="chapter" data-level="24" data-path="lessons-datasets.html"><a href="lessons-datasets.html"><i class="fa fa-check"></i><b>24</b> Overall Lessons and Data Sets</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Clinical prediction models</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="presentation" class="section level1 hasAnchor" number="18">
<h1><span class="header-section-number">18</span> Presentation Formats<a href="presentation.html#presentation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="fit-logistic-models-in-n544-data-set-6-predictors" class="section level2 hasAnchor" number="18.1">
<h2><span class="header-section-number">18.1</span> Fit logistic models in n544 data set; 6 predictors<a href="presentation.html#fit-logistic-models-in-n544-data-set-6-predictors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We develop a prediction model with 6 predictors for presence of residual tumor in 544 men treated for metastatic nonseminomatous testicular cancer. Predictors were pre-specified based on review of the medical <a href="https://www.ncbi.nlm.nih.gov/pubmed/7999405">literature</a>.</p>
<ol style="list-style-type: decimal">
<li><p>We first consider and full model and 2 shrinkage variants: uniform shrinkage and a penalized model.</p></li>
<li><p>We then study various formats for presentation of the prediction model for application in medical practice. The formats differ in user-friendliness and accuracy: for some simplifications we sacrifice nearly nothing and for other a lot in terms of c statistic. The formats are:<br />
</p></li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>nomogram (Fig 18.1)</li>
<li>score chart (Table 18.2 and Fig 18.2)</li>
<li>simple table (Table 18.3)</li>
<li>iso-probability lines (Fig 18.3)</li>
<li>tree on a meta-model (Fig 18.4)</li>
</ol>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="presentation.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a full 6 predictor model in n544</span></span>
<span id="cb79-2"><a href="presentation.html#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">prType=</span><span class="st">&#39;html&#39;</span>)</span>
<span id="cb79-3"><a href="presentation.html#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span>(<span class="fu">describe</span>(n544), <span class="at">scroll=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<div style="width: 100ex; overflow: auto; height: 25ex;"> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<script type="text/javascript">
<!--
    function expand_collapse(id) {
       var e = document.getElementById(id);
       var f = document.getElementById(id+"_earrows");
       if(e.style.display == 'none'){
          e.style.display = 'block';
          f.innerHTML = '&#9650';
       }
       else {
          e.style.display = 'none';
          f.innerHTML = '&#9660';
       }
    }
//-->
</script>
<style>
.earrows {color:silver;font-size:11px;}

fcap {
 font-family: Verdana;
 font-size: 12px;
 color: MidnightBlue
 }

smg {
 font-family: Verdana;
 font-size: 10px;
 color: &#808080;
}

hr.thinhr { margin-top: 0.15em; margin-bottom: 0.15em; }

span.xscript {
position: relative;
}
span.xscript sub {
position: absolute;
left: 0.1em;
bottom: -1ex;
}
</style>
 <title>n544 Descriptives</title> <font color="MidnightBlue"><div align=center><span style="font-weight:bold">n544 <br><br> 11  Variables   544  Observations</span></div></font> <hr class="thinhr"> <span style="font-weight:bold">Teratoma</span> <style>
 .hmisctable927586 {
 border: none;
 font-size: 85%;
 }
 .hmisctable927586 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable927586 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table class="hmisctable927586">
 <tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Sum</th><th>Mean</th><th>Gmd</th></tr>
 <tr><td>544</td><td>0</td><td>2</td><td>0.746</td><td>252</td><td>0.4632</td><td>0.4982</td></tr>
 </table>
 <hr class="thinhr"> <span style="font-weight:bold">Pre.AFP</span> <style>
 .hmisctable636950 {
 border: none;
 font-size: 85%;
 }
 .hmisctable636950 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable636950 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table class="hmisctable636950">
 <tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Sum</th><th>Mean</th><th>Gmd</th></tr>
 <tr><td>544</td><td>0</td><td>2</td><td>0.675</td><td>186</td><td>0.3419</td><td>0.4508</td></tr>
 </table>
 <hr class="thinhr"> <span style="font-weight:bold">Pre.HCG</span> <style>
 .hmisctable894878 {
 border: none;
 font-size: 85%;
 }
 .hmisctable894878 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable894878 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table class="hmisctable894878">
 <tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Sum</th><th>Mean</th><th>Gmd</th></tr>
 <tr><td>544</td><td>0</td><td>2</td><td>0.704</td><td>205</td><td>0.3768</td><td>0.4705</td></tr>
 </table>
 <hr class="thinhr"> <span style="font-weight:bold">Pre.lnLDH</span><div style='float: right; text-align: right;'><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAJcAAAANCAMAAACTvAxuAAAACVBMVEUAAADMzMz////1iUV5AAAAm0lEQVQ4jdXTBw6AMAgF0I/3P7SRDuhG22okwdqheUEBmQNw+UrgMAc47Oen4vcuQLn2A4evDwRAyRquhVijC6i6MkgynUMO+wtluEW3SbpHw6LsbenHvFBSMD36Y6G28SecrFfXZQnVp5n8W1dSoqrribD+yC1RiskWCpcRudDV4SbfWtnaSG4onxTHlS7St65ZOaVziaeiuK4nvTgJ6AglmqYAAAAASUVORK5CYII=" alt="image" /></div> <pre style="font-size:85%;">
        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
      544        0      472        1   0.4582   0.7327 -0.38735 -0.26645 -0.03266 
      .50      .75      .90      .95 
  0.31299  0.92886  1.33528  1.65328 
 </pre>
 <span style="font-size: 85%;"><font color="MidnightBlue">lowest</font> : -1.066 -0.948 -0.767 -0.731 -0.565 ,  <font color="MidnightBlue">highest</font>:  2.428  2.449  2.487  2.624  2.766</span> <hr class="thinhr"> <span style="font-weight:bold">sqpost</span><div style='float: right; text-align: right;'><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAJcAAAANCAMAAACTvAxuAAAACVBMVEUAAADMzMz////1iUV5AAAAf0lEQVQ4je2TgQ6AIAhEj/7/ozNNxMBcC51t3cZBufJlO5ASYM9ThU0JsOepWpjruvc7Lqcv+bkevqZkru7Sy9DPp1OCxXnVXXoZ+qfh/x9jD6a4gK9w3Wy+AhevCpqhXILuHBUQ3xzElRIUG45KZojsq/wcCaNcnC6rtbMYagegsAwG302zWwAAAABJRU5ErkJggg==" alt="image" /></div> <style>
 .hmisctable391133 {
 border: none;
 font-size: 74%;
 }
 .hmisctable391133 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable391133 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table class="hmisctable391133">
 <tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Mean</th><th>Gmd</th><th>.05</th><th>.10</th><th>.25</th><th>.50</th><th>.75</th><th>.90</th><th>.95</th></tr>
 <tr><td>544</td><td>0</td><td>93</td><td>0.996</td><td>5.133</td><td>2.922</td><td> 1.414</td><td> 2.236</td><td> 3.162</td><td> 4.472</td><td> 6.652</td><td> 9.669</td><td>10.000</td></tr>
 </table>
 <span style="font-size: 85%;"><font color="MidnightBlue">lowest</font> :  1.41  1.73  2.00  2.05  2.24 ,  <font color="MidnightBlue">highest</font>: 10.95 12.25 13.04 13.78 17.32</span> <hr class="thinhr"> <span style="font-weight:bold">reduc10</span><div style='float: right; text-align: right;'><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAJcAAAANCAMAAACTvAxuAAAACVBMVEUAAADMzMz////1iUV5AAAAf0lEQVQ4je1TWw6AIAwr3P/QslccEAgJkvlBUWJXaaowpBMAth3yCWDb9uZallm9uZZlyfVF+/XdNLedy6zG/i95aN6O3scy/yLXW7Q4kGhBuYxUuaDIdjHZz9V/fKv6zUKFhjrB5aKzP+iLQf8Qg5R4NbQAoTTAt83LSGpVbB75jQwcqR5CuQAAAABJRU5ErkJggg==" alt="image" /></div> <style>
 .hmisctable901042 {
 border: none;
 font-size: 74%;
 }
 .hmisctable901042 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable901042 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table class="hmisctable901042">
 <tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Mean</th><th>Gmd</th><th>.05</th><th>.10</th><th>.25</th><th>.50</th><th>.75</th><th>.90</th><th>.95</th></tr>
 <tr><td>544</td><td>0</td><td>200</td><td>0.998</td><td>4.482</td><td>4.307</td><td>-2.500</td><td> 0.000</td><td> 2.000</td><td> 5.167</td><td> 7.337</td><td> 8.785</td><td>10.000</td></tr>
 </table>
 <span style="font-size: 85%;"><font color="MidnightBlue">lowest</font> : -13.81 -10.00  -8.33  -8.11  -6.00 ,  <font color="MidnightBlue">highest</font>:   9.12   9.17   9.29   9.33  10.00</span> <hr class="thinhr"> <span style="font-weight:bold">Necrosis</span> <style>
 .hmisctable256598 {
 border: none;
 font-size: 85%;
 }
 .hmisctable256598 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable256598 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table class="hmisctable256598">
 <tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Sum</th><th>Mean</th><th>Gmd</th></tr>
 <tr><td>544</td><td>0</td><td>2</td><td>0.743</td><td>245</td><td>0.4504</td><td>0.496</td></tr>
 </table>
 <hr class="thinhr"> <span style="font-weight:bold">Tumor</span> <style>
 .hmisctable892796 {
 border: none;
 font-size: 85%;
 }
 .hmisctable892796 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable892796 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table class="hmisctable892796">
 <tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Sum</th><th>Mean</th><th>Gmd</th></tr>
 <tr><td>544</td><td>0</td><td>2</td><td>0.743</td><td>299</td><td>0.5496</td><td>0.496</td></tr>
 </table>
 <hr class="thinhr"> <span style="font-weight:bold">Reduction</span><div style='float: right; text-align: right;'><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAJcAAAANCAMAAACTvAxuAAAACVBMVEUAAADMzMz////1iUV5AAAAgElEQVQ4je2TSw6AIAxEB+5/aKCfiBBIk0rqgkGJ7UjzFIp0QoC7Qj4huMteLrNN7uUy28z1RfvN3bQvu7fJjf1f/DC8Hb2Pdf4F15NUHDBaEJcGLy6Isl4U+Lnmjx/dbrMGzRk1Oq529hd9seifFoFTtBqSAIdtgG6dzUpSqpYp9/cMGuU/RRgAAAAASUVORK5CYII=" alt="image" /></div> <style>
 .hmisctable589191 {
 border: none;
 font-size: 74%;
 }
 .hmisctable589191 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable589191 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table class="hmisctable589191">
 <tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Mean</th><th>Gmd</th><th>.05</th><th>.10</th><th>.25</th><th>.50</th><th>.75</th><th>.90</th><th>.95</th></tr>
 <tr><td>544</td><td>0</td><td>200</td><td>0.998</td><td>44.82</td><td>43.07</td><td>-25.00</td><td>  0.00</td><td> 20.00</td><td> 51.67</td><td> 73.37</td><td> 87.85</td><td>100.00</td></tr>
 </table>
 <span style="font-size: 85%;"><font color="MidnightBlue">lowest</font> : -138.1 -100.0  -83.3  -81.1  -60.0 ,  <font color="MidnightBlue">highest</font>:   91.2   91.7   92.9   93.3  100.0</span> <hr class="thinhr"> <span style="font-weight:bold">LDHst</span><div style='float: right; text-align: right;'><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAH8AAAANCAMAAAC3iUHrAAAACVBMVEUAAADMzMz////1iUV5AAAAWElEQVQ4je2TwQoAIAhDt/7/oyO1RnRvHRqRCcFT2MAQQI/QQqh6XW/w8fkuftk/ZPN/8R37i24Z4C3+GEHVwsdlvty/izp6Mnsyb870cEVHGcrvu9l5tB18PQqGyHjWvgAAAABJRU5ErkJggg==" alt="image" /></div> <style>
 .hmisctable402988 {
 border: none;
 font-size: 74%;
 }
 .hmisctable402988 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable402988 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table class="hmisctable402988">
 <tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Mean</th><th>Gmd</th><th>.05</th><th>.10</th><th>.25</th><th>.50</th><th>.75</th><th>.90</th><th>.95</th></tr>
 <tr><td>544</td><td>0</td><td>472</td><td>1</td><td>2.03</td><td>1.605</td><td>0.6789</td><td>0.7661</td><td>0.9679</td><td>1.3675</td><td>2.5317</td><td>3.8014</td><td>5.2242</td></tr>
 </table>
 <span style="font-size: 85%;"><font color="MidnightBlue">lowest</font> :  0.344  0.388  0.464  0.481  0.568 ,  <font color="MidnightBlue">highest</font>: 11.338 11.581 12.026 13.787 15.891</span> <hr class="thinhr"> <span style="font-weight:bold">Post.size</span><div style='float: right; text-align: right;'><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAJcAAAANCAMAAACTvAxuAAAACVBMVEUAAADMzMz////1iUV5AAAAbElEQVQ4je2TQQoAIQwDU///6LUBRdYK9VJycMBWQXBQAyPAKCKgEWAUEYS9gCuvGvvndQc8hg6bJZJZk1relcPWEjdX+I7Ti03c63S+hFfwtMVeCLzCL1ecxxO2zoxL5mWWJUPb5L8jmcU+PrdsDDFh9GqnAAAAAElFTkSuQmCC" alt="image" /></div> <style>
 .hmisctable142744 {
 border: none;
 font-size: 74%;
 }
 .hmisctable142744 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable142744 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table class="hmisctable142744">
 <tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Mean</th><th>Gmd</th><th>.05</th><th>.10</th><th>.25</th><th>.50</th><th>.75</th><th>.90</th><th>.95</th></tr>
 <tr><td>544</td><td>0</td><td>93</td><td>0.996</td><td>33.26</td><td>33.37</td><td>  2.00</td><td>  5.00</td><td> 10.00</td><td> 20.00</td><td> 44.25</td><td> 93.50</td><td>100.00</td></tr>
 </table>
 <span style="font-size: 85%;"><font color="MidnightBlue">lowest</font> :   2.00   3.00   4.00   4.22   5.00 ,  <font color="MidnightBlue">highest</font>: 120.00 150.00 170.00 190.00 300.00</span> <hr class="thinhr"> </div>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="presentation.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start the fitting of 3 models</span></span>
<span id="cb80-2"><a href="presentation.html#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb80-3"><a href="presentation.html#cb80-3" aria-hidden="true" tabindex="-1"></a>full <span class="ot">&lt;-</span> <span class="fu">lrm</span>(Necrosis <span class="sc">~</span> Teratoma<span class="sc">+</span>Pre.AFP<span class="sc">+</span>Pre.HCG<span class="sc">+</span><span class="fu">log</span>(LDHst)<span class="sc">+</span><span class="fu">sqrt</span>(Post.size)<span class="sc">+</span>Reduction,</span>
<span id="cb80-4"><a href="presentation.html#cb80-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>n544,<span class="at">x=</span>T,<span class="at">y=</span>T,<span class="at">linear.predictors=</span>T)</span>
<span id="cb80-5"><a href="presentation.html#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(full)</span></code></pre></div>

 <strong>Logistic Regression Model</strong>
 
 <pre>
 lrm(formula = Necrosis ~ Teratoma + Pre.AFP + Pre.HCG + log(LDHst) + 
     sqrt(Post.size) + Reduction, data = n544, x = T, y = T, linear.predictors = T)
 </pre>
 
 <table class='gmisc_table' style='border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;' >
<thead>
<tr>
<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-left: 1px solid black; border-right: 1px solid black; text-align: center;'></th>
<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black; text-align: center;'>Model Likelihood<br>Ratio Test</th>
<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black; text-align: center;'>Discrimination<br>Indexes</th>
<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black; text-align: center;'>Rank Discrim.<br>Indexes</th>
</tr>
</thead>
<tbody>
<tr>
<td style='min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;'>Obs 544</td>
<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'>LR χ<sup>2</sup> 211.56</td>
<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'><i>R</i><sup>2</sup> 0.431</td>
<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'><i>C</i> 0.839</td>
</tr>
<tr>
<td style='min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;'> 0 299</td>
<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'>d.f. 6</td>
<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'><i>R</i><sup><span style='font-size: 70%;'>2</span></sup><sub style='position: relative; left: -.47em; bottom: -.4em;'><span style='font-size: 70%;'>6,544</span></sub> 0.315</td>
<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'><i>D</i><sub>xy</sub> 0.677</td>
</tr>
<tr>
<td style='min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;'> 1 245</td>
<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'>Pr(>χ<sup>2</sup>) <0.0001</td>
<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'><i>R</i><sup><span style='font-size: 70%;'>2</span></sup><sub style='position: relative; left: -.47em; bottom: -.4em;'><span style='font-size: 70%;'>6,404</span></sub> 0.399</td>
<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'>γ 0.678</td>
</tr>
<tr>
<td style='min-width: 9em; border-bottom: 2px solid grey; border-left: 1px solid black; border-right: 1px solid black; text-align: center;'>max |∂log <i>L</i>/∂β| 1×10<sup>-7</sup></td>
<td style='min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black; text-align: center;'></td>
<td style='min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black; text-align: center;'>Brier 0.163</td>
<td style='min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black; text-align: center;'>τ<sub>a</sub> 0.336</td>
</tr>
</tbody>
</table>

 
 <table class='gmisc_table' style='border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;' >
<thead>
<tr><th style='border-bottom: 1px solid grey; font-weight: 900; border-top: 2px solid grey; min-width: 7em; text-align: center;'></th>
<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;'>β</th>
<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;'>S.E.</th>
<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;'>Wald <i>Z</i></th>
<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;'>Pr(>|<i>Z</i>|)</th>
</tr>
</thead>
<tbody>
<tr>
<td style='min-width: 7em; text-align: left;'>Intercept</td>
<td style='min-width: 7em; text-align: right;'> -1.0425</td>
<td style='min-width: 7em; text-align: right;'> 0.6086</td>
<td style='min-width: 7em; text-align: right;'>-1.71</td>
<td style='min-width: 7em; text-align: right;'>0.0867</td>
</tr>
<tr>
<td style='min-width: 7em; text-align: left;'>Teratoma</td>
<td style='min-width: 7em; text-align: right;'>  0.9094</td>
<td style='min-width: 7em; text-align: right;'> 0.2140</td>
<td style='min-width: 7em; text-align: right;'> 4.25</td>
<td style='min-width: 7em; text-align: right;'><0.0001</td>
</tr>
<tr>
<td style='min-width: 7em; text-align: left;'>Pre.AFP</td>
<td style='min-width: 7em; text-align: right;'>  0.9025</td>
<td style='min-width: 7em; text-align: right;'> 0.2333</td>
<td style='min-width: 7em; text-align: right;'> 3.87</td>
<td style='min-width: 7em; text-align: right;'>0.0001</td>
</tr>
<tr>
<td style='min-width: 7em; text-align: left;'>Pre.HCG</td>
<td style='min-width: 7em; text-align: right;'>  0.7827</td>
<td style='min-width: 7em; text-align: right;'> 0.2305</td>
<td style='min-width: 7em; text-align: right;'> 3.40</td>
<td style='min-width: 7em; text-align: right;'>0.0007</td>
</tr>
<tr>
<td style='min-width: 7em; text-align: left;'>LDHst</td>
<td style='min-width: 7em; text-align: right;'>  0.9854</td>
<td style='min-width: 7em; text-align: right;'> 0.2089</td>
<td style='min-width: 7em; text-align: right;'> 4.72</td>
<td style='min-width: 7em; text-align: right;'><0.0001</td>
</tr>
<tr>
<td style='min-width: 7em; text-align: left;'>Post.size</td>
<td style='min-width: 7em; text-align: right;'> -0.2915</td>
<td style='min-width: 7em; text-align: right;'> 0.0815</td>
<td style='min-width: 7em; text-align: right;'>-3.58</td>
<td style='min-width: 7em; text-align: right;'>0.0003</td>
</tr>
<tr>
<td style='min-width: 7em; border-bottom: 2px solid grey; text-align: left;'>Reduction</td>
<td style='min-width: 7em; border-bottom: 2px solid grey; text-align: right;'>  0.0158</td>
<td style='min-width: 7em; border-bottom: 2px solid grey; text-align: right;'> 0.0052</td>
<td style='min-width: 7em; border-bottom: 2px solid grey; text-align: right;'> 3.04</td>
<td style='min-width: 7em; border-bottom: 2px solid grey; text-align: right;'>0.0024</td>
</tr>
</tbody>
</table>

<div id="internal-validation-by-bootstrapping" class="section level3 hasAnchor" number="18.1.1">
<h3><span class="header-section-number">18.1.1</span> Internal validation by bootstrapping<a href="presentation.html#internal-validation-by-bootstrapping" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="presentation.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Validate model with bootstrapping</span></span>
<span id="cb81-2"><a href="presentation.html#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb81-3"><a href="presentation.html#cb81-3" aria-hidden="true" tabindex="-1"></a>val.full  <span class="ot">&lt;-</span> <span class="fu">validate</span>(full, <span class="at">B=</span><span class="dv">100</span>)</span>
<span id="cb81-4"><a href="presentation.html#cb81-4" aria-hidden="true" tabindex="-1"></a>val.full[<span class="dv">1</span>,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">5</span>) ] <span class="ot">&lt;-</span> val.full[<span class="dv">1</span>,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">5</span>) ]<span class="sc">/</span><span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="co"># transform Dxy to C</span></span>
<span id="cb81-5"><a href="presentation.html#cb81-5" aria-hidden="true" tabindex="-1"></a>val.full[<span class="dv">1</span>,<span class="dv">4</span> ] <span class="ot">&lt;-</span> val.full[<span class="dv">1</span>,<span class="dv">4</span>]<span class="sc">/</span><span class="dv">2</span>  <span class="co"># optimism in c</span></span>
<span id="cb81-6"><a href="presentation.html#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(val.full)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;C&quot;</span></span>
<span id="cb81-7"><a href="presentation.html#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(val.full[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,]), <span class="at">digits=</span><span class="dv">3</span>)  <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
index.orig
</th>
<th style="text-align:right;">
training
</th>
<th style="text-align:right;">
test
</th>
<th style="text-align:right;">
optimism
</th>
<th style="text-align:right;">
index.corrected
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
0.839
</td>
<td style="text-align:right;">
0.839
</td>
<td style="text-align:right;">
0.835
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.835
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:left;">
R2
</td>
<td style="text-align:right;">
0.431
</td>
<td style="text-align:right;">
0.434
</td>
<td style="text-align:right;">
0.423
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
0.420
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:left;">
Slope
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.978
</td>
<td style="text-align:right;">
0.022
</td>
<td style="text-align:right;">
0.978
</td>
<td style="text-align:right;">
100
</td>
</tr>
</tbody>
</table>
<p>So, limited optimism in c index (Dxy/2+0.5): <strong>0.004</strong>.<br />
And limited need for shrinkage, since the calibration slope is close to 1: <strong>0.98</strong>.<br />
For illustration, we consider 2 shrinkage approaches:<br />
1. shrink coefficients with a uniform factor (from bootstrap validation (or by a heuristic formula as described by <a href="https://www.jstor.org/stable/2345402">Copas 1983</a> and <a href="https://www.ncbi.nlm.nih.gov/pubmed/2277880">Van Houwelingen 1990</a> ).
2. penalize coefficients with a penalty factor as estimated by the optimal AIC in the <code>pentrace</code> function.</p>
<p>Empirical comparisons between shrinkage apporaches are here: <a href="https://www.ncbi.nlm.nih.gov/pubmed/10790680">Steyerberg 2000</a>. A recent study compared the stability of shrinkage estimators: <a href="https://arxiv.org/abs/1907.11493">Van Calster 2020</a>.</p>
</div>
<div id="shrunk-model-and-penalization" class="section level3 hasAnchor" number="18.1.2">
<h3><span class="header-section-number">18.1.2</span> Shrunk model and penalization<a href="presentation.html#shrunk-model-and-penalization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="presentation.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply linear shrinkage</span></span>
<span id="cb82-2"><a href="presentation.html#cb82-2" aria-hidden="true" tabindex="-1"></a>full.shrunk <span class="ot">&lt;-</span> full</span>
<span id="cb82-3"><a href="presentation.html#cb82-3" aria-hidden="true" tabindex="-1"></a>full.shrunk<span class="sc">$</span>coef <span class="ot">&lt;-</span> val.full[<span class="dv">4</span>,<span class="dv">5</span>] <span class="sc">*</span> full.shrunk<span class="sc">$</span>coef  <span class="co"># use result from bootstrapping</span></span>
<span id="cb82-4"><a href="presentation.html#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co"># val.full[4,5] is shrinkage factor; heuristic estimate (LR - df) / LR = (211-6)/211=0.97</span></span>
<span id="cb82-5"><a href="presentation.html#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="presentation.html#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate new intercept, with shrunk lp as offset variable, i.e. coef fixed at unity</span></span>
<span id="cb82-7"><a href="presentation.html#cb82-7" aria-hidden="true" tabindex="-1"></a>full.shrunk<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">lrm.fit</span>(<span class="at">y=</span>full<span class="sc">$</span>y, <span class="at">offset=</span> full<span class="sc">$</span>x <span class="sc">%*%</span> full.shrunk<span class="sc">$</span>coef[<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>])<span class="sc">$</span>coef[<span class="dv">1</span>]</span>
<span id="cb82-8"><a href="presentation.html#cb82-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-9"><a href="presentation.html#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a penalized model with pentrace function</span></span>
<span id="cb82-10"><a href="presentation.html#cb82-10" aria-hidden="true" tabindex="-1"></a>p   <span class="ot">&lt;-</span> <span class="fu">pentrace</span>(full, <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">12</span>,<span class="dv">14</span>,<span class="dv">20</span>))</span>
<span id="cb82-11"><a href="presentation.html#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p, <span class="at">which=</span><span class="st">&#39;aic.c&#39;</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">15</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">196</span>,<span class="dv">201</span>))</span>
<span id="cb82-12"><a href="presentation.html#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="dv">196</span>, <span class="dv">1000</span>))</span></code></pre></div>
<p><img src="fig/shrunk.model-1.png" width="672" /></p>
<p>The optimal penalty factor is 4. Let’s update the full model fit with this penalty term.</p>
</div>
<div id="fit-penalized-model-and-compare-fits" class="section level3 hasAnchor" number="18.1.3">
<h3><span class="header-section-number">18.1.3</span> Fit penalized model and compare fits<a href="presentation.html#fit-penalized-model-and-compare-fits" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="presentation.html#cb83-1" aria-hidden="true" tabindex="-1"></a>full.pen    <span class="ot">&lt;-</span> <span class="fu">update</span>(full, <span class="at">penalty=</span>p<span class="sc">$</span>penalty) </span>
<span id="cb83-2"><a href="presentation.html#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="presentation.html#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="do">## compare coefs of 3 model variants</span></span>
<span id="cb83-4"><a href="presentation.html#cb83-4" aria-hidden="true" tabindex="-1"></a>fit.coefs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">full=</span>full<span class="sc">$</span>coefficients, <span class="at">shrunk=</span>full.shrunk<span class="sc">$</span>coef, <span class="at">penalized=</span>full.pen<span class="sc">$</span>coefficients)</span>
<span id="cb83-5"><a href="presentation.html#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(fit.coefs, <span class="at">digits=</span><span class="dv">3</span>))  <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
full
</th>
<th style="text-align:right;">
shrunk
</th>
<th style="text-align:right;">
penalized
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
-1.042
</td>
<td style="text-align:right;">
-1.021
</td>
<td style="text-align:right;">
-1.090
</td>
</tr>
<tr>
<td style="text-align:left;">
Teratoma
</td>
<td style="text-align:right;">
0.909
</td>
<td style="text-align:right;">
0.890
</td>
<td style="text-align:right;">
0.873
</td>
</tr>
<tr>
<td style="text-align:left;">
Pre.AFP
</td>
<td style="text-align:right;">
0.903
</td>
<td style="text-align:right;">
0.883
</td>
<td style="text-align:right;">
0.860
</td>
</tr>
<tr>
<td style="text-align:left;">
Pre.HCG
</td>
<td style="text-align:right;">
0.783
</td>
<td style="text-align:right;">
0.766
</td>
<td style="text-align:right;">
0.729
</td>
</tr>
<tr>
<td style="text-align:left;">
LDHst
</td>
<td style="text-align:right;">
0.985
</td>
<td style="text-align:right;">
0.964
</td>
<td style="text-align:right;">
0.884
</td>
</tr>
<tr>
<td style="text-align:left;">
Post.size
</td>
<td style="text-align:right;">
-0.292
</td>
<td style="text-align:right;">
-0.285
</td>
<td style="text-align:right;">
-0.261
</td>
</tr>
<tr>
<td style="text-align:left;">
Reduction
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
0.016
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="fig-18.1" class="section level2 unnumbered hasAnchor">
<h2>Fig 18.1<a href="presentation.html#fig-18.1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="make-nomogram-from-penalized-model" class="section level3 hasAnchor" number="18.1.4">
<h3><span class="header-section-number">18.1.4</span> Make nomogram from penalized model<a href="presentation.html#make-nomogram-from-penalized-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="presentation.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">4</span>,.<span class="dv">5</span>))</span>
<span id="cb84-2"><a href="presentation.html#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Need some stats for the data to plot nomogram</span></span>
<span id="cb84-3"><a href="presentation.html#cb84-3" aria-hidden="true" tabindex="-1"></a>dd  <span class="ot">&lt;-</span> <span class="fu">datadist</span>(n544)</span>
<span id="cb84-4"><a href="presentation.html#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">datadist=</span><span class="st">&quot;dd&quot;</span>)</span>
<span id="cb84-5"><a href="presentation.html#cb84-5" aria-hidden="true" tabindex="-1"></a>nom <span class="ot">&lt;-</span> <span class="fu">nomogram</span>(full.pen,  <span class="at">fun=</span><span class="fu">c</span>(<span class="cf">function</span>(x)(<span class="dv">1</span><span class="sc">-</span><span class="fu">plogis</span>(x)), plogis), <span class="at">lp=</span>T,<span class="at">lp.at=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb84-6"><a href="presentation.html#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">LDHst=</span><span class="fu">c</span>(.<span class="dv">5</span>,<span class="dv">1</span>,<span class="fl">1.5</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">Post.size=</span><span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">20</span>,<span class="dv">10</span>,<span class="dv">5</span>,<span class="dv">2</span>), <span class="at">Reduction=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">35</span>,<span class="dv">70</span>,<span class="dv">100</span>), </span>
<span id="cb84-7"><a href="presentation.html#cb84-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">fun.at=</span><span class="fu">c</span>(<span class="fu">seq</span>(.<span class="dv">1</span>,.<span class="dv">9</span>,<span class="at">by=</span>.<span class="dv">1</span>),<span class="fl">0.95</span>), </span>
<span id="cb84-8"><a href="presentation.html#cb84-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">funlabel=</span><span class="fu">c</span>(<span class="st">&quot;p(residual tumor)&quot;</span>, <span class="st">&quot;p(necrosis)&quot;</span>),  <span class="at">vnames=</span><span class="st">&quot;lab&quot;</span>, <span class="at">maxscale=</span><span class="dv">10</span>)</span>
<span id="cb84-9"><a href="presentation.html#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nom)</span>
<span id="cb84-10"><a href="presentation.html#cb84-10" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Testicular cancer prediction model: risk of residual tumor&quot;</span>)</span></code></pre></div>
<p><img src="fig/nomogram-1.png" width="672" /></p>
<p>So, we have a nice presentation that allows for assessing the relative importance of predictors (by length of the lines), and allows for precise estimates of risks of residual tumor (and its complement, necrosis, benign tissue).</p>
<blockquote>
<p><strong>Instruction to physicians using the model in their care:</strong><br />
Determine the patient’s value for each predictor, and draw a straight line
upward to the points axis to determine how many points toward benign histology
the patient receives. Sum the points received for each predictor and
locate this sum on the total points axis. Draw a straight line down to find the
patient’s predicted probability of residual tumor or necrosis (benign histology).</p>
</blockquote>
<blockquote>
<p><strong>Instruction to patient:</strong>
“Mr. X, if we had 100 men exactly like you, we would expect that the
chemotherapy was fully successful in approximately &lt;predicted probability
from nomogram * 100&gt;, as reflected in fully benign disease at surgical
resection of your abdominal lymph nodes.” <em><a href="https://www.ncbi.nlm.nih.gov/pubmed/14532778">see Kattan et al</a>.<br />
Note that the number 100 may be debated, since the effective sample
size for some covariate patterns may be far less.</em></p>
</blockquote>
</div>
<div id="score-chart-creation-with-categorized-and-continuous-predictors" class="section level3 hasAnchor" number="18.1.5">
<h3><span class="header-section-number">18.1.5</span> Score chart creation with categorized and continuous predictors<a href="presentation.html#score-chart-creation-with-categorized-and-continuous-predictors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We first search for some nice rounding of logistic regression coefficients. A classic approach is multiplying by 10. We find that multiplying by <strong>10/8, or 1.25</strong> works well.<br />
We then continue with searching for a similarly nice scoring for continuous predictors. This is a trial and error process, supported by graphical illustrations.</p>
</div>
<div id="consider-making-rounded-scores-from-penalized-coefs" class="section level3 hasAnchor" number="18.1.6">
<h3><span class="header-section-number">18.1.6</span> Consider making rounded scores from penalized coefs<a href="presentation.html#consider-making-rounded-scores-from-penalized-coefs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="presentation.html#cb85-1" aria-hidden="true" tabindex="-1"></a>scores <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow=</span><span class="dv">10</span>, <span class="at">ncol=</span><span class="fu">length</span>(full.pen<span class="sc">$</span>coefficients), </span>
<span id="cb85-2"><a href="presentation.html#cb85-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="cn">NULL</span>, <span class="fu">c</span>(<span class="st">&quot;Multiplier&quot;</span>, <span class="fu">names</span>(full.pen<span class="sc">$</span>coefficients[<span class="sc">-</span><span class="dv">1</span>]))))</span>
<span id="cb85-3"><a href="presentation.html#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb85-4"><a href="presentation.html#cb85-4" aria-hidden="true" tabindex="-1"></a>  scores[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">/</span>i, <span class="fu">round</span>(full.pen<span class="sc">$</span>coefficients[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">*</span> <span class="dv">10</span> <span class="sc">/</span> i)) }</span>
<span id="cb85-5"><a href="presentation.html#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="co"># consider a range of multipliers</span></span>
<span id="cb85-6"><a href="presentation.html#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(scores, <span class="at">digits=</span><span class="dv">3</span>))  <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:right;">
Multiplier
</th>
<th style="text-align:right;">
Teratoma
</th>
<th style="text-align:right;">
Pre.AFP
</th>
<th style="text-align:right;">
Pre.HCG
</th>
<th style="text-align:right;">
LDHst
</th>
<th style="text-align:right;">
Post.size
</th>
<th style="text-align:right;">
Reduction
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
10.00
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
-3
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
5.00
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
3.33
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
2.50
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
2.00
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1.67
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1.43
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1.25
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1.11
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="presentation.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rounded scores</span></span>
<span id="cb86-2"><a href="presentation.html#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(<span class="at">mult10=</span><span class="fu">round</span>(<span class="dv">10</span><span class="sc">*</span>full.pen<span class="sc">$</span>coef[<span class="sc">-</span><span class="dv">1</span>]),</span>
<span id="cb86-3"><a href="presentation.html#cb86-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">mult1.25 =</span><span class="fu">round</span>(<span class="dv">10</span><span class="sc">/</span><span class="dv">8</span><span class="sc">*</span>full.pen<span class="sc">$</span>coef[<span class="sc">-</span><span class="dv">1</span>]))), <span class="at">digits=</span><span class="dv">3</span>)  <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Teratoma
</th>
<th style="text-align:right;">
Pre.AFP
</th>
<th style="text-align:right;">
Pre.HCG
</th>
<th style="text-align:right;">
LDHst
</th>
<th style="text-align:right;">
Post.size
</th>
<th style="text-align:right;">
Reduction
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
mult10
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
-3
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
mult1.25
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p>So, we like the multiplier of <strong>10/8, or 1.25</strong>. Let’s search for the mapping of coefficients of continuous predictors on nice scores as well.</p>
</div>
</div>
<div id="scores-for-continuous-predictors" class="section level2 hasAnchor" number="18.2">
<h2><span class="header-section-number">18.2</span> Scores for continuous predictors<a href="presentation.html#scores-for-continuous-predictors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="ldh" class="section level3 hasAnchor" number="18.2.1">
<h3><span class="header-section-number">18.2.1</span> LDH<a href="presentation.html#ldh" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Start with LDH, where we use the log scale for standardized LDH values. We could e.g. find: 1 point per ln, so 1 point per 2.7 times normal. We use a score of 10/8 for LDH in a plot. We add reference lines for point allocation.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="presentation.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb87-2"><a href="presentation.html#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Use score of 10/8 for LDH, plot score by LDHst</span></span>
<span id="cb87-3"><a href="presentation.html#cb87-3" aria-hidden="true" tabindex="-1"></a>LDHplot <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(n544<span class="sc">$</span>LDHst, <span class="fu">round</span>(<span class="dv">10</span><span class="sc">/</span><span class="dv">8</span><span class="sc">*</span>full.pen<span class="sc">$</span>coef[<span class="dv">5</span>]<span class="sc">*</span>n544<span class="sc">$</span>Pre.lnLDH,<span class="dv">1</span>)))</span>
<span id="cb87-4"><a href="presentation.html#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>LDHplot[,<span class="dv">1</span>], <span class="at">y=</span>LDHplot[,<span class="dv">2</span>], <span class="at">xlab=</span><span class="st">&quot;LDHst (LDH / upper limit of normal LDH)&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Rounded score&quot;</span>, </span>
<span id="cb87-5"><a href="presentation.html#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">axes=</span>F, <span class="at">xlim=</span><span class="fu">c</span>(.<span class="dv">5</span>,<span class="fl">6.9</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">6</span>,<span class="fl">2.2</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">main =</span> <span class="st">&quot;LDH&quot;</span>)</span>
<span id="cb87-6"><a href="presentation.html#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="fu">scat1d</span>(<span class="at">x=</span>n544<span class="sc">$</span>LDHst, <span class="at">side=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb87-7"><a href="presentation.html#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span><span class="fu">c</span>(.<span class="dv">5</span>,<span class="dv">1</span>,<span class="fl">1.5</span>,<span class="dv">2</span>,<span class="fl">2.5</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>))</span>
<span id="cb87-8"><a href="presentation.html#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">2</span>, <span class="at">at=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">5</span>, <span class="dv">0</span>,.<span class="dv">5</span>,<span class="dv">1</span>,<span class="fl">1.5</span>,<span class="dv">2</span>))</span>
<span id="cb87-9"><a href="presentation.html#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co"># horizontal reference lines</span></span>
<span id="cb87-10"><a href="presentation.html#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">0</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb87-11"><a href="presentation.html#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">1</span>, <span class="at">b=</span><span class="dv">0</span>)</span>
<span id="cb87-12"><a href="presentation.html#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">2</span>, <span class="at">b=</span><span class="dv">0</span>)</span>
<span id="cb87-13"><a href="presentation.html#cb87-13" aria-hidden="true" tabindex="-1"></a><span class="co"># vertical reference lines</span></span>
<span id="cb87-14"><a href="presentation.html#cb87-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">5</span>, .<span class="dv">5</span>), <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb87-15"><a href="presentation.html#cb87-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fl">2.5</span>,<span class="fl">2.5</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">5</span>, <span class="fl">1.5</span>))</span>
<span id="cb87-16"><a href="presentation.html#cb87-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fl">2.5</span><span class="sc">^</span><span class="dv">2</span>,<span class="fl">2.5</span><span class="sc">^</span><span class="dv">2</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">5</span>, <span class="fl">2.5</span>))</span></code></pre></div>
<p><img src="fig/LDH.scores-1.png" width="672" /></p>
<p>We find that a score of 1 corresponds to 2.5 times larger LDH values.<br />
Continue with post.size.</p>
</div>
<div id="study-scores-for-postchemotherapy-size" class="section level3 hasAnchor" number="18.2.2">
<h3><span class="header-section-number">18.2.2</span> Study scores for postchemotherapy size<a href="presentation.html#study-scores-for-postchemotherapy-size" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="presentation.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate score by sequence 2 to 100mm; </span></span>
<span id="cb88-2"><a href="presentation.html#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 is minimum for analysis; set 10 to zero in sequence (sqrt(seq(2,50,by=1))-sqrt(10))</span></span>
<span id="cb88-3"><a href="presentation.html#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="presentation.html#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We use 10mm as a reference, set to zero</span></span>
<span id="cb88-5"><a href="presentation.html#cb88-5" aria-hidden="true" tabindex="-1"></a>Sizeplot <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(n544<span class="sc">$</span>Post.size, </span>
<span id="cb88-6"><a href="presentation.html#cb88-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">round</span>(<span class="dv">10</span><span class="sc">/</span><span class="dv">8</span><span class="sc">*</span>full.pen<span class="sc">$</span>coef[<span class="dv">6</span>]<span class="sc">*</span>(<span class="fu">sqrt</span>(n544<span class="sc">$</span>Post.size) <span class="sc">-</span> <span class="fu">sqrt</span>(<span class="dv">10</span>)),<span class="dv">1</span>)), <span class="at">main =</span> <span class="st">&quot;Postchemotherapy size&quot;</span>)</span>
<span id="cb88-7"><a href="presentation.html#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>Sizeplot[,<span class="dv">1</span>], <span class="at">y=</span>Sizeplot[,<span class="dv">2</span>], <span class="at">xlab=</span><span class="st">&quot;Postchemo size (mm)&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Rounded score&quot;</span>, </span>
<span id="cb88-8"><a href="presentation.html#cb88-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">axes=</span>F, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.1</span>,<span class="dv">1</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">main =</span> <span class="st">&quot;Postsize&quot;</span>)</span>
<span id="cb88-9"><a href="presentation.html#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="fu">scat1d</span>(<span class="at">x=</span>n544<span class="sc">$</span>Post.size, <span class="at">side=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb88-10"><a href="presentation.html#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">70</span>, <span class="dv">100</span>))</span>
<span id="cb88-11"><a href="presentation.html#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">2</span>, <span class="at">at=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span>.<span class="dv">5</span>,<span class="dv">0</span>,<span class="fl">0.5</span>))</span>
<span id="cb88-12"><a href="presentation.html#cb88-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-13"><a href="presentation.html#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="co"># horizontal reference lines</span></span>
<span id="cb88-14"><a href="presentation.html#cb88-14" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">0</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb88-15"><a href="presentation.html#cb88-15" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span>.<span class="dv">5</span>, <span class="at">b=</span><span class="dv">0</span>)</span>
<span id="cb88-16"><a href="presentation.html#cb88-16" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="sc">-</span>.<span class="dv">5</span>, <span class="at">b=</span><span class="dv">0</span>)</span>
<span id="cb88-17"><a href="presentation.html#cb88-17" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">b=</span><span class="dv">0</span>)</span>
<span id="cb88-18"><a href="presentation.html#cb88-18" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">b=</span><span class="dv">0</span>)</span>
<span id="cb88-19"><a href="presentation.html#cb88-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-20"><a href="presentation.html#cb88-20" aria-hidden="true" tabindex="-1"></a><span class="co"># vertical reference lines</span></span>
<span id="cb88-21"><a href="presentation.html#cb88-21" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.1</span>, .<span class="dv">75</span>))</span>
<span id="cb88-22"><a href="presentation.html#cb88-22" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">10</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.1</span>, <span class="fl">0.25</span>), <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb88-23"><a href="presentation.html#cb88-23" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">20</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.1</span>, <span class="sc">-</span>.<span class="dv">1</span>))</span>
<span id="cb88-24"><a href="presentation.html#cb88-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">40</span>,<span class="dv">40</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.1</span>, <span class="sc">-</span><span class="fl">0.6</span>))</span>
<span id="cb88-25"><a href="presentation.html#cb88-25" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">100</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.1</span>, <span class="sc">-</span><span class="fl">1.5</span>))</span></code></pre></div>
<p><img src="fig/post.size-1.png" width="672" /></p>
<p>So, approximate scores for clinically meaningful sizes:
<strong>2 mm score +.5; 10mm, 0; 20mm, -.5; 40mm -1; 100 -2</strong></p>
<p>Continue with Reduction. This should be simple, since Reduction was modelled as a linear variable, without transformations.</p>
</div>
<div id="study-scores-for-reduction-in-size" class="section level3 hasAnchor" number="18.2.3">
<h3><span class="header-section-number">18.2.3</span> Study scores for reduction in size<a href="presentation.html#study-scores-for-reduction-in-size" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="presentation.html#cb89-1" aria-hidden="true" tabindex="-1"></a>Redplot <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(n544<span class="sc">$</span>Reduction, </span>
<span id="cb89-2"><a href="presentation.html#cb89-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">round</span>(<span class="dv">10</span><span class="sc">/</span><span class="dv">8</span><span class="sc">*</span>full.pen<span class="sc">$</span>coef[<span class="dv">7</span>]<span class="sc">*</span>n544<span class="sc">$</span>Reduction,<span class="dv">1</span>)))</span>
<span id="cb89-3"><a href="presentation.html#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>Redplot[,<span class="dv">1</span>], <span class="at">y=</span>Redplot[,<span class="dv">2</span>], <span class="at">xlab=</span><span class="st">&quot;Reduction in size (%)&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Rounded score&quot;</span>, </span>
<span id="cb89-4"><a href="presentation.html#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">axes=</span>F, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>,<span class="fl">2.1</span>), <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Reduction in size&quot;</span>)</span>
<span id="cb89-5"><a href="presentation.html#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="fu">scat1d</span>(<span class="at">x=</span>n544<span class="sc">$</span>Reduction, <span class="at">side=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb89-6"><a href="presentation.html#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">25</span>,<span class="dv">50</span>,<span class="dv">75</span>,<span class="dv">100</span>))</span>
<span id="cb89-7"><a href="presentation.html#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">2</span>, <span class="at">at=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb89-8"><a href="presentation.html#cb89-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-9"><a href="presentation.html#cb89-9" aria-hidden="true" tabindex="-1"></a><span class="co"># horizontal reference lines</span></span>
<span id="cb89-10"><a href="presentation.html#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">0</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb89-11"><a href="presentation.html#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">1</span>, <span class="at">b=</span><span class="dv">0</span>)</span>
<span id="cb89-12"><a href="presentation.html#cb89-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">2</span>, <span class="at">b=</span><span class="dv">0</span>)</span>
<span id="cb89-13"><a href="presentation.html#cb89-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-14"><a href="presentation.html#cb89-14" aria-hidden="true" tabindex="-1"></a><span class="co"># vertical reference lines</span></span>
<span id="cb89-15"><a href="presentation.html#cb89-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb89-16"><a href="presentation.html#cb89-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">50</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.25</span>))</span>
<span id="cb89-17"><a href="presentation.html#cb89-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">100</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">2.5</span>))</span></code></pre></div>
<p><img src="fig/reduction-1.png" width="672" /></p>
<p>So, scores for reduction in size:
<strong>50%, score 1; 100%, score 2</strong></p>
<p>We store the scores in new variables for later use in a logistic regression model, to check the impact of rounding on model performance.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="presentation.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A score of 1 corresponds to 2.5 times larger LDH</span></span>
<span id="cb90-2"><a href="presentation.html#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co"># rescale such that exp(l) does get more than 1 point; 1 point at 2.5 times normal LDH</span></span>
<span id="cb90-3"><a href="presentation.html#cb90-3" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>LDHr  <span class="ot">&lt;-</span> <span class="fu">round</span>(n544<span class="sc">$</span>Pre.lnLDH<span class="sc">*</span><span class="fu">exp</span>(<span class="dv">1</span>)<span class="sc">/</span><span class="fl">2.5</span>,<span class="dv">1</span>)</span>
<span id="cb90-4"><a href="presentation.html#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="presentation.html#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="co"># postsize: coef -.3 per sqrt(mm). Hence -1 with 3.3*sqrt(mm)</span></span>
<span id="cb90-6"><a href="presentation.html#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co"># So, approximate scores for clinically meaningful sizes:</span></span>
<span id="cb90-7"><a href="presentation.html#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 mm score +.5; 10mm, 0; 20mm, -.5; 40mm -1; 100 -2</span></span>
<span id="cb90-8"><a href="presentation.html#cb90-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-9"><a href="presentation.html#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="co"># change the intercept by defining score = 0 for 10 mm, which is clinically of most interest</span></span>
<span id="cb90-10"><a href="presentation.html#cb90-10" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>SQPOSTr  <span class="ot">&lt;-</span> <span class="fu">round</span>((n544<span class="sc">$</span>sqpost <span class="sc">-</span> <span class="fu">sqrt</span>(<span class="dv">10</span>)) <span class="sc">/</span> (<span class="fu">sqrt</span>(<span class="dv">10</span>) <span class="sc">-</span> <span class="fu">sqrt</span>(<span class="dv">40</span>)),<span class="dv">1</span>)</span>
<span id="cb90-11"><a href="presentation.html#cb90-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-12"><a href="presentation.html#cb90-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Rescale reduction such that effect 1 point</span></span>
<span id="cb90-13"><a href="presentation.html#cb90-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 50% reduction 1 point; i.e. 0% = 0; 50%=1; 100%=2</span></span>
<span id="cb90-14"><a href="presentation.html#cb90-14" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>REDUC5  <span class="ot">&lt;-</span> <span class="fu">round</span>(n544<span class="sc">$</span>reduc10 <span class="sc">/</span> <span class="dv">5</span>,<span class="dv">1</span>)</span></code></pre></div>
</div>
</div>
<div id="table-18.2" class="section level2 unnumbered hasAnchor">
<h2>Table 18.2<a href="presentation.html#table-18.2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="make-a-score-chart" class="section level3 hasAnchor" number="18.2.4">
<h3><span class="header-section-number">18.2.4</span> Make a score chart<a href="presentation.html#make-a-score-chart" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Score chart to be made by hand, using the points as derived above.<br />
Could also have kept life simpler by multiplying coefs by 10 and rounding.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="presentation.html#cb91-1" aria-hidden="true" tabindex="-1"></a>score.fit <span class="ot">&lt;-</span> <span class="fu">lrm</span>(Necrosis <span class="sc">~</span> Teratoma<span class="sc">+</span>Pre.AFP<span class="sc">+</span>Pre.HCG<span class="sc">+</span>LDHr<span class="sc">+</span>SQPOSTr<span class="sc">+</span>REDUC5,<span class="at">data=</span>n544, <span class="at">x=</span>T,<span class="at">y=</span>T)</span>
<span id="cb91-2"><a href="presentation.html#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="presentation.html#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co"># scores &lt;- as.data.frame(round(10/8*full.pen$coef[-1]))</span></span>
<span id="cb91-4"><a href="presentation.html#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(<span class="dv">10</span><span class="sc">/</span><span class="dv">8</span><span class="sc">*</span>score.fit<span class="sc">$</span>coef[<span class="sc">-</span><span class="dv">1</span>]), <span class="at">digits=</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
10/8 * score.fit$coef[-1]
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Teratoma
</td>
<td style="text-align:right;">
1.134
</td>
</tr>
<tr>
<td style="text-align:left;">
Pre.AFP
</td>
<td style="text-align:right;">
1.137
</td>
</tr>
<tr>
<td style="text-align:left;">
Pre.HCG
</td>
<td style="text-align:right;">
0.964
</td>
</tr>
<tr>
<td style="text-align:left;">
LDHr
</td>
<td style="text-align:right;">
1.110
</td>
</tr>
<tr>
<td style="text-align:left;">
SQPOSTr
</td>
<td style="text-align:right;">
1.114
</td>
</tr>
<tr>
<td style="text-align:left;">
REDUC5
</td>
<td style="text-align:right;">
1.008
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="presentation.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb92-2"><a href="presentation.html#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Continuous scores</span></span>
<span id="cb92-3"><a href="presentation.html#cb92-3" aria-hidden="true" tabindex="-1"></a>LDHvalues <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="dv">1</span>, <span class="fl">1.6</span>, <span class="fl">2.5</span>, <span class="dv">4</span>, <span class="dv">6</span>)</span>
<span id="cb92-4"><a href="presentation.html#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(<span class="at">LDH=</span>LDHvalues, <span class="at">LDHscores=</span><span class="fu">log</span>(LDHvalues)<span class="sc">*</span><span class="fu">exp</span>(<span class="dv">1</span>)<span class="sc">/</span><span class="fl">2.5</span>)), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">col.names =</span><span class="cn">NULL</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<table class="table" style="width: auto !important; ">
<tbody>
<tr>
<td style="text-align:left;">
LDH
</td>
<td style="text-align:right;">
0.60
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.60
</td>
<td style="text-align:right;">
2.5
</td>
<td style="text-align:right;">
4.00
</td>
<td style="text-align:right;">
6.00
</td>
</tr>
<tr>
<td style="text-align:left;">
LDHscores
</td>
<td style="text-align:right;">
-0.56
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.51
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
1.51
</td>
<td style="text-align:right;">
1.95
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="presentation.html#cb93-1" aria-hidden="true" tabindex="-1"></a>Postvalues <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">40</span>,<span class="dv">70</span>)</span>
<span id="cb93-2"><a href="presentation.html#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(<span class="at">Postsize=</span>Postvalues, </span>
<span id="cb93-3"><a href="presentation.html#cb93-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Postscores=</span>(<span class="fu">sqrt</span>(Postvalues) <span class="sc">-</span> <span class="fu">sqrt</span>(<span class="dv">10</span>)) <span class="sc">/</span> (<span class="fu">sqrt</span>(<span class="dv">10</span>) <span class="sc">-</span> <span class="fu">sqrt</span>(<span class="dv">40</span>)))), </span>
<span id="cb93-4"><a href="presentation.html#cb93-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">col.names =</span><span class="cn">NULL</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<table class="table" style="width: auto !important; ">
<tbody>
<tr>
<td style="text-align:left;">
Postsize
</td>
<td style="text-align:right;">
2.00
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
20.00
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
70.00
</td>
</tr>
<tr>
<td style="text-align:left;">
Postscores
</td>
<td style="text-align:right;">
0.55
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-0.41
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
-1.65
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="presentation.html#cb94-1" aria-hidden="true" tabindex="-1"></a>Redvalues <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>)</span>
<span id="cb94-2"><a href="presentation.html#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(<span class="at">Reduction=</span>Redvalues, </span>
<span id="cb94-3"><a href="presentation.html#cb94-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Redscores=</span>Redvalues <span class="sc">/</span> <span class="dv">5</span>)), </span>
<span id="cb94-4"><a href="presentation.html#cb94-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">col.names =</span><span class="cn">NULL</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<table class="table" style="width: auto !important; ">
<tbody>
<tr>
<td style="text-align:left;">
Reduction
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
Redscores
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table>
<p>So, we see that the continuous values of some predictors map to scores of approximately 0.5 or 1.
Intermediate scores can be obtained by interpolation.</p>
<hr />
</div>
</div>
<div id="fig-18.2" class="section level2 unnumbered hasAnchor">
<h2>Fig 18.2<a href="presentation.html#fig-18.2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="translate-score-in-probability-estimates-with-95-ci" class="section level3 hasAnchor" number="18.2.5">
<h3><span class="header-section-number">18.2.5</span> Translate score in probability estimates with 95% CI<a href="presentation.html#translate-score-in-probability-estimates-with-95-ci" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="presentation.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39;# Function to relate scores to predictions in graph </span><span class="al">###</span></span>
<span id="cb95-2"><a href="presentation.html#cb95-2" aria-hidden="true" tabindex="-1"></a>make.score.matrix <span class="ot">&lt;-</span><span class="cf">function</span>(fit, scores, <span class="at">shrinkage=</span><span class="dv">1</span>, <span class="at">limits.scores=</span><span class="cn">NULL</span>) {   </span>
<span id="cb95-3"><a href="presentation.html#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lpscore for score chart + graph</span></span>
<span id="cb95-4"><a href="presentation.html#cb95-4" aria-hidden="true" tabindex="-1"></a>  fit         <span class="ot">&lt;-</span> <span class="fu">update</span>(fit, <span class="at">x=</span>T,<span class="at">y=</span>T, <span class="at">se.fit=</span>T)   <span class="co"># SE of predictions from original model</span></span>
<span id="cb95-5"><a href="presentation.html#cb95-5" aria-hidden="true" tabindex="-1"></a>  rounded.lp    <span class="ot">&lt;-</span> fit<span class="sc">$</span>x <span class="sc">%*%</span> scores                 <span class="co"># Linear predictor</span></span>
<span id="cb95-6"><a href="presentation.html#cb95-6" aria-hidden="true" tabindex="-1"></a>  multiplier  <span class="ot">&lt;-</span> <span class="fu">lrm.fit</span>(<span class="at">y=</span>fit<span class="sc">$</span>y, <span class="at">x=</span>rounded.lp)<span class="sc">$</span>coef[<span class="dv">2</span>]    <span class="do">## For score formula</span></span>
<span id="cb95-7"><a href="presentation.html#cb95-7" aria-hidden="true" tabindex="-1"></a>  shrunk.beta   <span class="ot">&lt;-</span> shrinkage <span class="sc">*</span> multiplier           <span class="co"># Shrinkage built in</span></span>
<span id="cb95-8"><a href="presentation.html#cb95-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Estimate intercept for scores, using the scores as offset with shrinkage</span></span>
<span id="cb95-9"><a href="presentation.html#cb95-9" aria-hidden="true" tabindex="-1"></a>  fit.lp      <span class="ot">&lt;-</span> <span class="fu">lrm.fit</span>(<span class="at">y=</span>score.fit<span class="sc">$</span>y, <span class="at">offset=</span>shrunk.beta<span class="sc">*</span>rounded.lp) </span>
<span id="cb95-10"><a href="presentation.html#cb95-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">## lp formula; this version is not fully rounded yet</span></span>
<span id="cb95-11"><a href="presentation.html#cb95-11" aria-hidden="true" tabindex="-1"></a>  lp2           <span class="ot">&lt;-</span> fit.lp<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> shrunk.beta<span class="sc">*</span>rounded.lp</span>
<span id="cb95-12"><a href="presentation.html#cb95-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">linear predictor:&quot;</span>, fit.lp<span class="sc">$</span>coef[<span class="dv">1</span>], <span class="st">&quot;+&quot;</span>, shrunk.beta, <span class="st">&quot;* rounded.lp</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb95-13"><a href="presentation.html#cb95-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot; original range of scores&quot;</span>, <span class="fu">min</span>(rounded.lp), <span class="fu">max</span>(rounded.lp), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb95-14"><a href="presentation.html#cb95-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(limits.scores))  {</span>
<span id="cb95-15"><a href="presentation.html#cb95-15" aria-hidden="true" tabindex="-1"></a>    rounded.lp[rounded.lp <span class="sc">&lt;</span> <span class="fu">min</span>(limits.scores)] <span class="ot">&lt;-</span> <span class="fu">min</span>(limits.scores)</span>
<span id="cb95-16"><a href="presentation.html#cb95-16" aria-hidden="true" tabindex="-1"></a>    rounded.lp[rounded.lp <span class="sc">&gt;</span> <span class="fu">max</span>(limits.scores)] <span class="ot">&lt;-</span> <span class="fu">max</span>(limits.scores) }</span>
<span id="cb95-17"><a href="presentation.html#cb95-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;restricted range of scores&quot;</span>, <span class="fu">min</span>(rounded.lp), <span class="fu">max</span>(rounded.lp), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>) </span>
<span id="cb95-18"><a href="presentation.html#cb95-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-19"><a href="presentation.html#cb95-19" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Data for graph</span></span>
<span id="cb95-20"><a href="presentation.html#cb95-20" aria-hidden="true" tabindex="-1"></a>  graph.lp      <span class="ot">&lt;-</span> <span class="fu">cbind</span>(rounded.lp, fit<span class="sc">$</span>se.fit)        <span class="co"># lp and se.fit in matrix</span></span>
<span id="cb95-21"><a href="presentation.html#cb95-21" aria-hidden="true" tabindex="-1"></a>  lp.events     <span class="ot">&lt;-</span> <span class="fu">tapply</span>(fit<span class="sc">$</span>y,<span class="fu">list</span>(<span class="fu">round</span>(graph.lp[,<span class="dv">1</span>],<span class="dv">0</span>)),sum)    <span class="co"># events per lp score</span></span>
<span id="cb95-22"><a href="presentation.html#cb95-22" aria-hidden="true" tabindex="-1"></a>  lp.nonevents <span class="ot">&lt;-</span> <span class="fu">tapply</span>(<span class="dv">1</span><span class="sc">-</span>fit<span class="sc">$</span>y,<span class="fu">list</span>(<span class="fu">round</span>(graph.lp[,<span class="dv">1</span>],<span class="dv">0</span>)),sum)   <span class="co"># non-events per lp score</span></span>
<span id="cb95-23"><a href="presentation.html#cb95-23" aria-hidden="true" tabindex="-1"></a>  se.lp           <span class="ot">&lt;-</span> <span class="fu">tapply</span>(graph.lp[,<span class="dv">2</span>],<span class="fu">list</span>(<span class="fu">round</span>(graph.lp[,<span class="dv">1</span>],<span class="dv">0</span>)),mean)  <span class="co"># mean se per lp score</span></span>
<span id="cb95-24"><a href="presentation.html#cb95-24" aria-hidden="true" tabindex="-1"></a>  lp.lp           <span class="ot">&lt;-</span> <span class="fu">tapply</span>(graph.lp[,<span class="dv">1</span>],<span class="fu">list</span>(<span class="fu">round</span>(graph.lp[,<span class="dv">1</span>],<span class="dv">0</span>)),mean)  <span class="co"># mean lp per lp score</span></span>
<span id="cb95-25"><a href="presentation.html#cb95-25" aria-hidden="true" tabindex="-1"></a>  score         <span class="ot">&lt;-</span> lp.lp                        <span class="co"># range of score, rounded to 0 decimals</span></span>
<span id="cb95-26"><a href="presentation.html#cb95-26" aria-hidden="true" tabindex="-1"></a>  lp3               <span class="ot">&lt;-</span> fit.lp<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> shrunk.beta<span class="sc">*</span><span class="fu">round</span>(score,<span class="dv">0</span>) <span class="co"># lp on logistic scale, rounded</span></span>
<span id="cb95-27"><a href="presentation.html#cb95-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-28"><a href="presentation.html#cb95-28" aria-hidden="true" tabindex="-1"></a>  <span class="do">## data frame with predicted prob + 95% CI</span></span>
<span id="cb95-29"><a href="presentation.html#cb95-29" aria-hidden="true" tabindex="-1"></a>  p.lp          <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(<span class="at">score=</span><span class="fu">round</span>(score,<span class="dv">0</span>),</span>
<span id="cb95-30"><a href="presentation.html#cb95-30" aria-hidden="true" tabindex="-1"></a>                    <span class="at">p=</span><span class="fu">plogis</span>(lp3),<span class="at">plow=</span><span class="fu">plogis</span>(lp3<span class="fl">-1.96</span><span class="sc">*</span>se.lp),<span class="at">phigh=</span><span class="fu">plogis</span>(lp3<span class="fl">+1.96</span><span class="sc">*</span>se.lp),</span>
<span id="cb95-31"><a href="presentation.html#cb95-31" aria-hidden="true" tabindex="-1"></a>                    lp.events,lp.nonevents))</span>
<span id="cb95-32"><a href="presentation.html#cb95-32" aria-hidden="true" tabindex="-1"></a>  p.lp<span class="sc">$</span>total <span class="ot">&lt;-</span> p.lp<span class="sc">$</span>lp.events <span class="sc">+</span> p.lp<span class="sc">$</span>lp.nonevents</span>
<span id="cb95-33"><a href="presentation.html#cb95-33" aria-hidden="true" tabindex="-1"></a>  p.lp</span>
<span id="cb95-34"><a href="presentation.html#cb95-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-35"><a href="presentation.html#cb95-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-36"><a href="presentation.html#cb95-36" aria-hidden="true" tabindex="-1"></a><span class="do">## Make Fig 18.2 ##</span></span>
<span id="cb95-37"><a href="presentation.html#cb95-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-38"><a href="presentation.html#cb95-38" aria-hidden="true" tabindex="-1"></a><span class="do">## Continuous predictors in score</span></span>
<span id="cb95-39"><a href="presentation.html#cb95-39" aria-hidden="true" tabindex="-1"></a>score.fit <span class="ot">&lt;-</span> <span class="fu">lrm</span>(Necrosis <span class="sc">~</span> Teratoma<span class="sc">+</span>Pre.AFP<span class="sc">+</span>Pre.HCG<span class="sc">+</span>LDHr<span class="sc">+</span>SQPOSTr<span class="sc">+</span>REDUC5,<span class="at">data=</span>n544, <span class="at">x=</span>T,<span class="at">y=</span>T)</span>
<span id="cb95-40"><a href="presentation.html#cb95-40" aria-hidden="true" tabindex="-1"></a>scores  <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">6</span>)  <span class="co"># All scores a weight of 1</span></span>
<span id="cb95-41"><a href="presentation.html#cb95-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-42"><a href="presentation.html#cb95-42" aria-hidden="true" tabindex="-1"></a>lp.n544 <span class="ot">&lt;-</span> <span class="fu">make.score.matrix</span>(<span class="at">fit=</span>score.fit, <span class="at">scores=</span>scores, <span class="at">shrinkage=</span><span class="fl">0.95</span>, <span class="at">limits.scores=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">5</span>))</span></code></pre></div>
<pre><code>## 
## linear predictor: -1.94 + 0.815 * rounded.lp
##   original range of scores -4.3 6.7 
## restricted range of scores -2 5</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="presentation.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(lp.n544), </span>
<span id="cb97-2"><a href="presentation.html#cb97-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
score
</th>
<th style="text-align:right;">
p
</th>
<th style="text-align:right;">
plow
</th>
<th style="text-align:right;">
phigh
</th>
<th style="text-align:right;">
lp.events
</th>
<th style="text-align:right;">
lp.nonevents
</th>
<th style="text-align:right;">
total
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
-2
</td>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
22
</td>
</tr>
<tr>
<td style="text-align:left;">
-1
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
0.11
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
46
</td>
<td style="text-align:right;">
48
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.13
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
0.21
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
53
</td>
<td style="text-align:right;">
59
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.24
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
58
</td>
<td style="text-align:right;">
77
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.42
</td>
<td style="text-align:right;">
0.31
</td>
<td style="text-align:right;">
0.54
</td>
<td style="text-align:right;">
48
</td>
<td style="text-align:right;">
59
</td>
<td style="text-align:right;">
107
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.62
</td>
<td style="text-align:right;">
0.49
</td>
<td style="text-align:right;">
0.74
</td>
<td style="text-align:right;">
62
</td>
<td style="text-align:right;">
37
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.79
</td>
<td style="text-align:right;">
0.68
</td>
<td style="text-align:right;">
0.87
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
85
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.89
</td>
<td style="text-align:right;">
0.82
</td>
<td style="text-align:right;">
0.94
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
47
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="presentation.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">mar=</span><span class="fu">c</span>(<span class="fl">4.5</span>,<span class="fl">4.5</span>,<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb98-2"><a href="presentation.html#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>lp.n544[,<span class="dv">1</span>], <span class="at">y=</span><span class="dv">100</span><span class="sc">*</span>lp.n544[,<span class="dv">2</span>], <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">las=</span><span class="dv">1</span>, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>, <span class="at">cex.lab=</span><span class="fl">1.2</span>,</span>
<span id="cb98-3"><a href="presentation.html#cb98-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Predicted probability of necrosis (%)&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">100</span>), </span>
<span id="cb98-4"><a href="presentation.html#cb98-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab=</span><span class="st">&quot;Sum score&quot;</span>, <span class="at">cex=</span><span class="fu">sqrt</span>(lp.n544<span class="sc">$</span>total)<span class="sc">/</span><span class="dv">5</span>, <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span>, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb98-5"><a href="presentation.html#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>,<span class="at">at=</span>lp.n544[,<span class="dv">1</span>], <span class="at">cex=</span><span class="dv">1</span>)</span>
<span id="cb98-6"><a href="presentation.html#cb98-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-7"><a href="presentation.html#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="co"># add 95% CI</span></span>
<span id="cb98-8"><a href="presentation.html#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(lp.n544)) <span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(lp.n544[i,<span class="dv">1</span>], lp.n544[i,<span class="dv">1</span>]), <span class="at">y=</span><span class="fu">c</span>(<span class="dv">100</span><span class="sc">*</span>lp.n544[i,<span class="dv">3</span>], <span class="dv">100</span><span class="sc">*</span>lp.n544[i,<span class="dv">4</span>]), <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb98-9"><a href="presentation.html#cb98-9" aria-hidden="true" tabindex="-1"></a><span class="co"># add N= ...</span></span>
<span id="cb98-10"><a href="presentation.html#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&quot;N=&quot;</span>, <span class="at">side =</span> <span class="dv">2</span>, <span class="at">outer =</span> <span class="cn">FALSE</span>, <span class="at">line=</span><span class="fl">1.5</span>, <span class="at">at =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">adj =</span> <span class="dv">0</span>, <span class="at">las=</span><span class="dv">1</span>, <span class="at">cex=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb98-11"><a href="presentation.html#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span>lp.n544[,<span class="dv">1</span>],<span class="at">y=</span><span class="sc">-</span><span class="dv">10</span>,<span class="at">labels=</span>lp.n544<span class="sc">$</span>total, <span class="at">cex=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="fig/scoreplot-1.png" width="672" /></p>
</div>
</div>
<div id="end-table-18.2-score-chart-and-fig-18.2-graphic-translation-from-score-to-probability" class="section level2 unnumbered hasAnchor">
<h2>End Table 18.2 (score chart) and Fig 18.2 (graphic translation from score to probability)<a href="presentation.html#end-table-18.2-score-chart-and-fig-18.2-graphic-translation-from-score-to-probability" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="categorized-coding" class="section level3 hasAnchor" number="18.2.6">
<h3><span class="header-section-number">18.2.6</span> Categorized coding<a href="presentation.html#categorized-coding" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can categorize the continuous predictors; a <strong><a href="https://www.ncbi.nlm.nih.gov/pubmed/16217841">bad idea</a></strong> generally speaking</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="presentation.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LDH</span></span>
<span id="cb99-2"><a href="presentation.html#cb99-2" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>PRELDH <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(n544<span class="sc">$</span>Pre.lnLDH<span class="sc">&lt;</span><span class="fu">log</span>(<span class="dv">1</span>),<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb99-3"><a href="presentation.html#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="co"># PostSize simple coding: 0,1,2</span></span>
<span id="cb99-4"><a href="presentation.html#cb99-4" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>POST2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(n544<span class="sc">$</span>sqpost<span class="sc">&lt;</span><span class="fu">sqrt</span>(<span class="dv">20</span>),<span class="dv">2</span>,</span>
<span id="cb99-5"><a href="presentation.html#cb99-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>(n544<span class="sc">$</span>sqpost<span class="sc">&lt;</span><span class="fu">sqrt</span>(<span class="dv">50</span>),<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb99-6"><a href="presentation.html#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Reduction in categories: increase=-1, 0-49%=0, &gt;=50%=1</span></span>
<span id="cb99-7"><a href="presentation.html#cb99-7" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>REDUCr  <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(n544<span class="sc">$</span>Reduction<span class="sc">&lt;</span><span class="dv">0</span>,<span class="sc">-</span><span class="dv">1</span>, <span class="fu">ifelse</span>(n544<span class="sc">$</span>Reduction<span class="sc">&gt;=</span><span class="dv">50</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb99-8"><a href="presentation.html#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Everything coded in categories</span></span>
<span id="cb99-9"><a href="presentation.html#cb99-9" aria-hidden="true" tabindex="-1"></a>score.fit2 <span class="ot">&lt;-</span> <span class="fu">lrm</span>(Necrosis <span class="sc">~</span> Teratoma<span class="sc">+</span>Pre.AFP<span class="sc">+</span>Pre.HCG<span class="sc">+</span>PRELDH<span class="sc">+</span>POST2<span class="sc">+</span>REDUCr,<span class="at">data=</span>n544, <span class="at">x=</span>T,<span class="at">y=</span>T)</span>
<span id="cb99-10"><a href="presentation.html#cb99-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(<span class="at">x=</span><span class="dv">10</span><span class="sc">/</span><span class="dv">8</span><span class="sc">*</span>score.fit2<span class="sc">$</span>coef[<span class="sc">-</span><span class="dv">1</span>]), <span class="at">digits=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
10/8 * score.fit2$coef[-1]
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Teratoma
</td>
<td style="text-align:right;">
1.15
</td>
</tr>
<tr>
<td style="text-align:left;">
Pre.AFP
</td>
<td style="text-align:right;">
1.08
</td>
</tr>
<tr>
<td style="text-align:left;">
Pre.HCG
</td>
<td style="text-align:right;">
0.83
</td>
</tr>
<tr>
<td style="text-align:left;">
PRELDH
</td>
<td style="text-align:right;">
1.13
</td>
</tr>
<tr>
<td style="text-align:left;">
POST2
</td>
<td style="text-align:right;">
1.08
</td>
</tr>
<tr>
<td style="text-align:left;">
REDUCr
</td>
<td style="text-align:right;">
0.98
</td>
</tr>
</tbody>
</table>
<p>So, each category approx 1 point.</p>
</div>
</div>
<div id="table-18.3" class="section level2 unnumbered hasAnchor">
<h2>Table 18.3<a href="presentation.html#table-18.3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="alternative-make-a-score-from-0---5" class="section level3 hasAnchor" number="18.2.7">
<h3><span class="header-section-number">18.2.7</span> Alternative: make a score from 0 - 5<a href="presentation.html#alternative-make-a-score-from-0---5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p><strong>Ultra simple scores</strong><br />
“<em>.. categories of the predictors were simplified for practical application. We conclude that a simple statistical model, based on a limited number of patient characteristics, provides better guidelines for patient selection than those currently used in clinical practice. <a href="https://www.ncbi.nlm.nih.gov/pubmed/8912551">Br J Cancer 1996</a></em>”</p>
</blockquote>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="presentation.html#cb100-1" aria-hidden="true" tabindex="-1"></a>score5  <span class="ot">&lt;-</span> n544<span class="sc">$</span>Teratoma<span class="sc">+</span>n544<span class="sc">$</span>Pre.AFP<span class="sc">+</span>n544<span class="sc">$</span>Pre.HCG<span class="sc">+</span>n544<span class="sc">$</span>PRELDH<span class="sc">+</span>n544<span class="sc">$</span>REDUCr</span>
<span id="cb100-2"><a href="presentation.html#cb100-2" aria-hidden="true" tabindex="-1"></a>score5  <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(n544<span class="sc">$</span>REDUCr<span class="sc">&lt;</span><span class="dv">0</span>,<span class="dv">0</span>,score5)</span>
<span id="cb100-3"><a href="presentation.html#cb100-3" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>score5 <span class="ot">&lt;-</span> score5</span>
<span id="cb100-4"><a href="presentation.html#cb100-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-5"><a href="presentation.html#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple coding: 5 categories for postsize (no difference 20-30 and 30-50 mm)</span></span>
<span id="cb100-6"><a href="presentation.html#cb100-6" aria-hidden="true" tabindex="-1"></a>POST5 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(n544<span class="sc">$</span>sqpost<span class="sc">&lt;=</span><span class="fu">sqrt</span>(<span class="dv">10</span>),<span class="dv">0</span>,</span>
<span id="cb100-7"><a href="presentation.html#cb100-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>(n544<span class="sc">$</span>sqpost<span class="sc">&lt;=</span><span class="fu">sqrt</span>(<span class="dv">20</span>),<span class="dv">1</span>,</span>
<span id="cb100-8"><a href="presentation.html#cb100-8" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(n544<span class="sc">$</span>sqpost<span class="sc">&lt;=</span><span class="fu">sqrt</span>(<span class="dv">30</span>),<span class="dv">2</span>,</span>
<span id="cb100-9"><a href="presentation.html#cb100-9" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">ifelse</span>(n544<span class="sc">$</span>sqpost<span class="sc">&lt;=</span><span class="fu">sqrt</span>(<span class="dv">50</span>),<span class="dv">3</span>,<span class="dv">4</span>))))</span>
<span id="cb100-10"><a href="presentation.html#cb100-10" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>POST5 <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(POST5)  <span class="co"># add the post size categories as a factor</span></span>
<span id="cb100-11"><a href="presentation.html#cb100-11" aria-hidden="true" tabindex="-1"></a>full.simple2  <span class="ot">&lt;-</span> <span class="fu">lrm</span>(Necrosis<span class="sc">~</span>POST5<span class="sc">+</span>score5, <span class="at">data=</span>n544, <span class="at">x=</span>T,<span class="at">y=</span>T,<span class="at">se.fit=</span>T)</span>
<span id="cb100-12"><a href="presentation.html#cb100-12" aria-hidden="true" tabindex="-1"></a>pred.simple2  <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="fu">plogis</span>(<span class="fu">predict</span>(full.simple2)), <span class="at">by=</span><span class="fu">list</span>(POST5, score5), <span class="at">FUN=</span>mean)</span>
<span id="cb100-13"><a href="presentation.html#cb100-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-14"><a href="presentation.html#cb100-14" aria-hidden="true" tabindex="-1"></a>pred.simple2  <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">with</span>(pred.simple2,<span class="fu">tapply</span>(x,<span class="fu">list</span>(Group<span class="fl">.1</span>,Group<span class="fl">.2</span>),mean)))</span>
<span id="cb100-15"><a href="presentation.html#cb100-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-16"><a href="presentation.html#cb100-16" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(pred.simple2), <span class="at">digits =</span> <span class="dv">2</span>)  <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
0
</th>
<th style="text-align:right;">
1
</th>
<th style="text-align:right;">
2
</th>
<th style="text-align:right;">
3
</th>
<th style="text-align:right;">
4
</th>
<th style="text-align:right;">
5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.32
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
0.85
</td>
<td style="text-align:right;">
0.93
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.14
</td>
<td style="text-align:right;">
0.27
</td>
<td style="text-align:right;">
0.45
</td>
<td style="text-align:right;">
0.66
</td>
<td style="text-align:right;">
0.81
</td>
<td style="text-align:right;">
0.91
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.12
</td>
<td style="text-align:right;">
0.24
</td>
<td style="text-align:right;">
0.42
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;">
0.79
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:right;">
0.30
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.69
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
0.19
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.55
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="presentation.html#cb101-1" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>POST5 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(n544<span class="sc">$</span>POST5)</span>
<span id="cb101-2"><a href="presentation.html#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="presentation.html#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make simple risk scores per category</span></span>
<span id="cb101-4"><a href="presentation.html#cb101-4" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>simple.cat  <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(n544<span class="sc">$</span>POST5<span class="sc">==</span><span class="dv">3</span> <span class="sc">&amp;</span> score5<span class="sc">==</span><span class="dv">4</span>,<span class="dv">70</span>,</span>
<span id="cb101-5"><a href="presentation.html#cb101-5" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">ifelse</span>(n544<span class="sc">$</span>POST5<span class="sc">==</span><span class="dv">3</span> <span class="sc">&amp;</span> score5<span class="sc">==</span><span class="dv">5</span>,<span class="dv">80</span>,</span>
<span id="cb101-6"><a href="presentation.html#cb101-6" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">ifelse</span>(n544<span class="sc">$</span>POST5<span class="sc">==</span><span class="dv">2</span> <span class="sc">&amp;</span> score5<span class="sc">==</span><span class="dv">3</span>,<span class="dv">60</span>,</span>
<span id="cb101-7"><a href="presentation.html#cb101-7" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">ifelse</span>(n544<span class="sc">$</span>POST5<span class="sc">==</span><span class="dv">2</span> <span class="sc">&amp;</span> score5<span class="sc">==</span><span class="dv">4</span>,<span class="dv">80</span>,                    </span>
<span id="cb101-8"><a href="presentation.html#cb101-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">ifelse</span>(n544<span class="sc">$</span>POST5<span class="sc">==</span><span class="dv">2</span> <span class="sc">&amp;</span> score5<span class="sc">==</span><span class="dv">5</span>,<span class="dv">90</span>,                    </span>
<span id="cb101-9"><a href="presentation.html#cb101-9" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(n544<span class="sc">$</span>POST5<span class="sc">&lt;</span><span class="dv">2</span> <span class="sc">&amp;</span> score5<span class="sc">==</span><span class="dv">2</span>,<span class="dv">60</span>,</span>
<span id="cb101-10"><a href="presentation.html#cb101-10" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(n544<span class="sc">$</span>POST5<span class="sc">&lt;</span><span class="dv">2</span> <span class="sc">&amp;</span> score5<span class="sc">==</span><span class="dv">3</span>,<span class="dv">70</span>,</span>
<span id="cb101-11"><a href="presentation.html#cb101-11" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(n544<span class="sc">$</span>POST5<span class="sc">&lt;</span><span class="dv">2</span> <span class="sc">&amp;</span> score5<span class="sc">==</span><span class="dv">4</span>,<span class="dv">80</span>,</span>
<span id="cb101-12"><a href="presentation.html#cb101-12" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(n544<span class="sc">$</span>POST5<span class="sc">&lt;</span><span class="dv">2</span> <span class="sc">&amp;</span> score5<span class="sc">==</span><span class="dv">5</span>,<span class="dv">90</span>, <span class="dv">50</span>)))))))))</span>
<span id="cb101-13"><a href="presentation.html#cb101-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-14"><a href="presentation.html#cb101-14" aria-hidden="true" tabindex="-1"></a>simple.tab <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">with</span>(n544,<span class="fu">tapply</span>(simple.cat,<span class="fu">list</span>(<span class="at">POST5=</span>POST5,<span class="at">score=</span>score5),mean)))</span>
<span id="cb101-15"><a href="presentation.html#cb101-15" aria-hidden="true" tabindex="-1"></a>simple.tab[<span class="fu">is.na</span>(simple.tab)] <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb101-16"><a href="presentation.html#cb101-16" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(simple.tab) <span class="ot">&lt;-</span> <span class="fu">Cs</span>(score<span class="fl">.0</span>, score<span class="fl">.1</span>, score<span class="fl">.2</span>, score<span class="fl">.3</span>, score<span class="fl">.4</span>, score<span class="fl">.5</span>)</span>
<span id="cb101-17"><a href="presentation.html#cb101-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(simple.tab) <span class="ot">&lt;-</span> <span class="fu">Cs</span>(size10, size20, size30, size50, size.gt<span class="fl">.50</span>)</span>
<span id="cb101-18"><a href="presentation.html#cb101-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-19"><a href="presentation.html#cb101-19" aria-hidden="true" tabindex="-1"></a>simple.tab <span class="sc">%&gt;%</span> </span>
<span id="cb101-20"><a href="presentation.html#cb101-20" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">score.0 =</span> <span class="fu">cell_spec</span>(score<span class="fl">.0</span>, <span class="st">&quot;html&quot;</span>, <span class="at">color =</span> <span class="fu">ifelse</span>(score<span class="fl">.0</span> <span class="sc">&gt;</span> <span class="dv">50</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;red&quot;</span>)),</span>
<span id="cb101-21"><a href="presentation.html#cb101-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">score.1 =</span> <span class="fu">cell_spec</span>(score<span class="fl">.1</span>, <span class="st">&quot;html&quot;</span>, <span class="at">color =</span> <span class="fu">ifelse</span>(score<span class="fl">.1</span> <span class="sc">&gt;</span> <span class="dv">50</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;red&quot;</span>)),</span>
<span id="cb101-22"><a href="presentation.html#cb101-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">score.2 =</span> <span class="fu">cell_spec</span>(score<span class="fl">.2</span>, <span class="st">&quot;html&quot;</span>, <span class="at">color =</span> <span class="fu">ifelse</span>(score<span class="fl">.2</span> <span class="sc">&gt;</span> <span class="dv">50</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;red&quot;</span>)),</span>
<span id="cb101-23"><a href="presentation.html#cb101-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">score.3 =</span> <span class="fu">cell_spec</span>(score<span class="fl">.3</span>, <span class="st">&quot;html&quot;</span>, <span class="at">color =</span> <span class="fu">ifelse</span>(score<span class="fl">.3</span> <span class="sc">==</span> <span class="dv">70</span>, <span class="st">&quot;green&quot;</span>,</span>
<span id="cb101-24"><a href="presentation.html#cb101-24" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">ifelse</span>(score<span class="fl">.3</span> <span class="sc">==</span> <span class="dv">60</span>, <span class="st">&quot;orange&quot;</span>,<span class="st">&quot;red&quot;</span>))),</span>
<span id="cb101-25"><a href="presentation.html#cb101-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">score.4 =</span> <span class="fu">cell_spec</span>(score<span class="fl">.4</span>, <span class="st">&quot;html&quot;</span>, <span class="at">color =</span> <span class="fu">ifelse</span>(score<span class="fl">.4</span> <span class="sc">==</span> <span class="dv">80</span>, <span class="st">&quot;white&quot;</span>,</span>
<span id="cb101-26"><a href="presentation.html#cb101-26" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">ifelse</span>(score<span class="fl">.4</span> <span class="sc">==</span> <span class="dv">70</span>, <span class="st">&quot;green&quot;</span>,</span>
<span id="cb101-27"><a href="presentation.html#cb101-27" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">ifelse</span>(score<span class="fl">.4</span> <span class="sc">==</span> <span class="dv">60</span>, <span class="st">&quot;orange&quot;</span>,<span class="st">&quot;red&quot;</span>))),</span>
<span id="cb101-28"><a href="presentation.html#cb101-28" aria-hidden="true" tabindex="-1"></a>                           <span class="at">background=</span><span class="fu">ifelse</span>(score<span class="fl">.4</span> <span class="sc">==</span> <span class="dv">80</span>, <span class="st">&quot;green&quot;</span>,<span class="st">&quot;white&quot;</span> )),</span>
<span id="cb101-29"><a href="presentation.html#cb101-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">score.5 =</span> <span class="fu">cell_spec</span>(score<span class="fl">.5</span>, <span class="st">&quot;html&quot;</span>, <span class="at">color =</span> <span class="fu">ifelse</span>(score<span class="fl">.5</span> <span class="sc">&gt;=</span> <span class="dv">80</span>, <span class="st">&quot;white&quot;</span>,</span>
<span id="cb101-30"><a href="presentation.html#cb101-30" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">ifelse</span>(score<span class="fl">.5</span> <span class="sc">==</span> <span class="dv">70</span>, <span class="st">&quot;green&quot;</span>,</span>
<span id="cb101-31"><a href="presentation.html#cb101-31" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">ifelse</span>(score<span class="fl">.5</span> <span class="sc">==</span> <span class="dv">60</span>, <span class="st">&quot;orange&quot;</span>,<span class="st">&quot;red&quot;</span>))),</span>
<span id="cb101-32"><a href="presentation.html#cb101-32" aria-hidden="true" tabindex="-1"></a>                           <span class="at">background=</span><span class="fu">ifelse</span>(score<span class="fl">.5</span> <span class="sc">==</span> <span class="dv">90</span>, <span class="st">&quot;darkgreen&quot;</span>,</span>
<span id="cb101-33"><a href="presentation.html#cb101-33" aria-hidden="true" tabindex="-1"></a>                                             <span class="fu">ifelse</span>(score<span class="fl">.5</span> <span class="sc">==</span> <span class="dv">80</span>, <span class="st">&quot;green&quot;</span>,<span class="st">&quot;white&quot;</span> )))</span>
<span id="cb101-34"><a href="presentation.html#cb101-34" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb101-35"><a href="presentation.html#cb101-35" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">&quot;html&quot;</span>, <span class="at">escape =</span> F, <span class="at">row.names =</span> T) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
score.0
</th>
<th style="text-align:left;">
score.1
</th>
<th style="text-align:left;">
score.2
</th>
<th style="text-align:left;">
score.3
</th>
<th style="text-align:left;">
score.4
</th>
<th style="text-align:left;">
score.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
size10
</td>
<td style="text-align:left;">
<span style="     color: red !important;">50</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;">50</span>
</td>
<td style="text-align:left;">
<span style="     color: orange !important;">60</span>
</td>
<td style="text-align:left;">
<span style="     color: green !important;">70</span>
</td>
<td style="text-align:left;">
<span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: green !important;">80</span>
</td>
<td style="text-align:left;">
<span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: darkgreen !important;">90</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
size20
</td>
<td style="text-align:left;">
<span style="     color: red !important;">50</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;">50</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;">50</span>
</td>
<td style="text-align:left;">
<span style="     color: orange !important;">60</span>
</td>
<td style="text-align:left;">
<span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: green !important;">80</span>
</td>
<td style="text-align:left;">
<span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: darkgreen !important;">90</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
size30
</td>
<td style="text-align:left;">
<span style="     color: red !important;">50</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;">50</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;">50</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;">50</span>
</td>
<td style="text-align:left;">
<span style="     color: green !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">70</span>
</td>
<td style="text-align:left;">
<span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: green !important;">80</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
size50
</td>
<td style="text-align:left;">
<span style="     color: red !important;">50</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;">50</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;">50</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;">50</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">50</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">50</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
size.gt.50
</td>
<td style="text-align:left;">
<span style="     color: red !important;">50</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;">50</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;">50</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;">50</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">50</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">50</span>
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="presentation.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(simple.tab, digits = 2) %&gt;% kable_styling(full_width=F, position = &quot;left&quot;) </span></span></code></pre></div>
<p>In this way we created a very simple table, with probability of necrosis according to post-chemotherapy mass size (rows) and a simple, categorized score of the other 5 predictors.</p>
</div>
</div>
<div id="fig-18.3" class="section level2 unnumbered hasAnchor">
<h2>Fig 18.3<a href="presentation.html#fig-18.3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="iso-probability-lines" class="section level3 hasAnchor" number="18.2.8">
<h3><span class="header-section-number">18.2.8</span> Iso-probability lines<a href="presentation.html#iso-probability-lines" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For radiologists, it is natural to consider the pre-chemotherapy mass size and post-chemotherapy mass size. According to our analysis, the key information is the pre-chemotherapy size and the reduction in size. These pieces of information need to be considered jointly with the 4 other predictors (Teratoma, 3 tumor markers). We attempted to convey this message in iso-probability lines (Fig 18.3) <a href="https://www.ncbi.nlm.nih.gov/pubmed/10796922">Radiology</a></p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="presentation.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Radiology paper: could graph pre - post with lines for score 1 - 4</span></span>
<span id="cb103-2"><a href="presentation.html#cb103-2" aria-hidden="true" tabindex="-1"></a>score4  <span class="ot">&lt;-</span> n544<span class="sc">$</span>Teratoma<span class="sc">+</span>n544<span class="sc">$</span>Pre.AFP<span class="sc">+</span>n544<span class="sc">$</span>Pre.HCG<span class="sc">+</span>n544<span class="sc">$</span>Pre.lnLDH</span>
<span id="cb103-3"><a href="presentation.html#cb103-3" aria-hidden="true" tabindex="-1"></a>full.simple3 <span class="ot">&lt;-</span> <span class="fu">lrm</span>(Necrosis <span class="sc">~</span> score4 <span class="sc">+</span> sqpost <span class="sc">+</span> reduc10, <span class="at">data=</span>n544, <span class="at">x=</span>T, <span class="at">y=</span>T)</span>
<span id="cb103-4"><a href="presentation.html#cb103-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-5"><a href="presentation.html#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(full.simple3<span class="sc">$</span>coef), <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>) </span></code></pre></div>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
full.simple3$coef
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
-1.20
</td>
</tr>
<tr>
<td style="text-align:left;">
score4
</td>
<td style="text-align:right;">
0.89
</td>
</tr>
<tr>
<td style="text-align:left;">
sqpost
</td>
<td style="text-align:right;">
-0.27
</td>
</tr>
<tr>
<td style="text-align:left;">
reduc10
</td>
<td style="text-align:right;">
0.17
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="presentation.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a presize variable, based on reduction and postsize</span></span>
<span id="cb104-2"><a href="presentation.html#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="co"># reduc = (pre-post) / pre; reduc = 1 - post/pre; reduc-1 = -post/pre; pre = -post/(reduc-1)</span></span>
<span id="cb104-3"><a href="presentation.html#cb104-3" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>presize <span class="ot">&lt;-</span> <span class="sc">-</span> n544<span class="sc">$</span>sqpost<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">ifelse</span>((n544<span class="sc">$</span>reduc10<span class="sc">/</span><span class="dv">10</span> <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">!=</span> <span class="dv">0</span>,(n544<span class="sc">$</span>reduc10<span class="sc">/</span><span class="dv">10</span> <span class="sc">-</span> <span class="dv">1</span>),<span class="sc">-</span>.<span class="dv">04</span>)  </span>
<span id="cb104-4"><a href="presentation.html#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Now calculate iso probability lines: e.g. prob -70%, </span></span>
<span id="cb104-5"><a href="presentation.html#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate PRESIZE from SQPOST, for given probabilities</span></span>
<span id="cb104-6"><a href="presentation.html#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="co"># presize = f(sqpost, plogis(full))</span></span>
<span id="cb104-7"><a href="presentation.html#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="co"># pre = -post/(reduc10-10) # for reduc10&lt;10</span></span>
<span id="cb104-8"><a href="presentation.html#cb104-8" aria-hidden="true" tabindex="-1"></a><span class="co"># range sqpost from 2 to 50; score 4 0 - 4</span></span>
<span id="cb104-9"><a href="presentation.html#cb104-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-10"><a href="presentation.html#cb104-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Fig 18.3 ##</span></span>
<span id="cb104-11"><a href="presentation.html#cb104-11" aria-hidden="true" tabindex="-1"></a><span class="co"># matrix with sqpost and scores</span></span>
<span id="cb104-12"><a href="presentation.html#cb104-12" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>),<span class="dv">5</span>),<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">50</span>),<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">50</span>),<span class="fu">rep</span>(<span class="dv">2</span>,<span class="dv">50</span>),<span class="fu">rep</span>(<span class="dv">3</span>,<span class="dv">50</span>),<span class="fu">rep</span>(<span class="dv">4</span>,<span class="dv">50</span>))))</span>
<span id="cb104-13"><a href="presentation.html#cb104-13" aria-hidden="true" tabindex="-1"></a><span class="co"># linear predictor from simple model &#39;full.simple3&#39;</span></span>
<span id="cb104-14"><a href="presentation.html#cb104-14" aria-hidden="true" tabindex="-1"></a>lp.simple3  <span class="ot">&lt;-</span> x <span class="sc">%*%</span> full.simple3<span class="sc">$</span>coef[<span class="dv">3</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">+</span> full.simple3<span class="sc">$</span>coef[<span class="dv">1</span>]</span>
<span id="cb104-15"><a href="presentation.html#cb104-15" aria-hidden="true" tabindex="-1"></a><span class="co"># now calculate reduc10 with condition p=70% etc</span></span>
<span id="cb104-16"><a href="presentation.html#cb104-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve equation qlogis(.7) = lp.simple3 + full.simple3$coef[4] * n544$REDUC10</span></span>
<span id="cb104-17"><a href="presentation.html#cb104-17" aria-hidden="true" tabindex="-1"></a>reduc10<span class="fl">.70</span> <span class="ot">&lt;-</span> (<span class="fu">qlogis</span>(.<span class="dv">7</span>) <span class="sc">-</span> lp.simple3) <span class="sc">/</span>full.simple3<span class="sc">$</span>coef[<span class="dv">4</span>]</span>
<span id="cb104-18"><a href="presentation.html#cb104-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate presizes: pre = -post/(reduc10/10-1)</span></span>
<span id="cb104-19"><a href="presentation.html#cb104-19" aria-hidden="true" tabindex="-1"></a>presize<span class="fl">.70</span>  <span class="ot">&lt;-</span> <span class="sc">-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>,<span class="dv">5</span>) <span class="sc">/</span> (reduc10<span class="fl">.70</span><span class="sc">/</span><span class="dv">10-1</span>)</span>
<span id="cb104-20"><a href="presentation.html#cb104-20" aria-hidden="true" tabindex="-1"></a><span class="co"># in 1 formula for efficiency</span></span>
<span id="cb104-21"><a href="presentation.html#cb104-21" aria-hidden="true" tabindex="-1"></a>presize<span class="fl">.90</span>  <span class="ot">&lt;-</span> <span class="sc">-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>,<span class="dv">5</span>) <span class="sc">/</span> (((<span class="fu">qlogis</span>(.<span class="dv">9</span>) <span class="sc">-</span> lp.simple3) <span class="sc">/</span>(full.simple3<span class="sc">$</span>coef[<span class="dv">4</span>])<span class="sc">/</span><span class="dv">10</span>) <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb104-22"><a href="presentation.html#cb104-22" aria-hidden="true" tabindex="-1"></a>presize<span class="fl">.80</span>  <span class="ot">&lt;-</span> <span class="sc">-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>,<span class="dv">5</span>) <span class="sc">/</span> (((<span class="fu">qlogis</span>(.<span class="dv">8</span>) <span class="sc">-</span> lp.simple3) <span class="sc">/</span>(full.simple3<span class="sc">$</span>coef[<span class="dv">4</span>])<span class="sc">/</span><span class="dv">10</span>) <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb104-23"><a href="presentation.html#cb104-23" aria-hidden="true" tabindex="-1"></a>presize<span class="fl">.60</span>  <span class="ot">&lt;-</span> <span class="sc">-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>,<span class="dv">5</span>) <span class="sc">/</span> (((<span class="fu">qlogis</span>(.<span class="dv">6</span>) <span class="sc">-</span> lp.simple3) <span class="sc">/</span>(full.simple3<span class="sc">$</span>coef[<span class="dv">4</span>])<span class="sc">/</span><span class="dv">10</span>) <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb104-24"><a href="presentation.html#cb104-24" aria-hidden="true" tabindex="-1"></a>presize<span class="fl">.50</span>  <span class="ot">&lt;-</span> <span class="sc">-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>,<span class="dv">5</span>) <span class="sc">/</span> (((<span class="fu">qlogis</span>(.<span class="dv">5</span>) <span class="sc">-</span> lp.simple3) <span class="sc">/</span>(full.simple3<span class="sc">$</span>coef[<span class="dv">4</span>])<span class="sc">/</span><span class="dv">10</span>) <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb104-25"><a href="presentation.html#cb104-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-26"><a href="presentation.html#cb104-26" aria-hidden="true" tabindex="-1"></a><span class="co"># make Postsize from sqpost</span></span>
<span id="cb104-27"><a href="presentation.html#cb104-27" aria-hidden="true" tabindex="-1"></a>x[,<span class="dv">1</span>] <span class="ot">&lt;-</span> x[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb104-28"><a href="presentation.html#cb104-28" aria-hidden="true" tabindex="-1"></a><span class="co"># combine results</span></span>
<span id="cb104-29"><a href="presentation.html#cb104-29" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">cbind</span>(x,lp.simple3,</span>
<span id="cb104-30"><a href="presentation.html#cb104-30" aria-hidden="true" tabindex="-1"></a>        reduc10<span class="fl">.70</span>, presize<span class="fl">.70</span>, presize<span class="fl">.90</span>,presize<span class="fl">.80</span>,presize<span class="fl">.60</span>,presize<span class="fl">.50</span> ))</span>
<span id="cb104-31"><a href="presentation.html#cb104-31" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(x) <span class="ot">&lt;-</span> <span class="fu">Cs</span>(postsize, score4,lp,reduc1070,</span>
<span id="cb104-32"><a href="presentation.html#cb104-32" aria-hidden="true" tabindex="-1"></a>          presize70,presize90,presize80,presize60,presize50)</span>
<span id="cb104-33"><a href="presentation.html#cb104-33" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(x)</span>
<span id="cb104-34"><a href="presentation.html#cb104-34" aria-hidden="true" tabindex="-1"></a>x[x<span class="sc">&lt;</span><span class="dv">0</span>]  <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb104-35"><a href="presentation.html#cb104-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-36"><a href="presentation.html#cb104-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Make some plots; isoprobability lines for different scores, x-axis=postsize</span></span>
<span id="cb104-37"><a href="presentation.html#cb104-37" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">3</span>,.<span class="dv">5</span>))</span>
<span id="cb104-38"><a href="presentation.html#cb104-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb104-39"><a href="presentation.html#cb104-39" aria-hidden="true" tabindex="-1"></a>  xp <span class="ot">=</span> x[x<span class="sc">$</span>score4<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(x<span class="sc">$</span>presize50) <span class="sc">&amp;</span> x<span class="sc">$</span>presize50<span class="sc">&lt;</span><span class="dv">100</span> <span class="sc">&amp;</span> x<span class="sc">$</span>postsize<span class="sc">&lt;</span><span class="dv">50</span>, ]</span>
<span id="cb104-40"><a href="presentation.html#cb104-40" aria-hidden="true" tabindex="-1"></a>  xp <span class="ot">=</span> xp[<span class="fu">sort</span>(xp<span class="sc">$</span>presize50),]</span>
<span id="cb104-41"><a href="presentation.html#cb104-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">y=</span>xp<span class="sc">$</span>postsize,<span class="at">x=</span>xp<span class="sc">$</span>presize50, <span class="at">main=</span><span class="fu">paste</span>(<span class="st">&quot;Score=&quot;</span>,i,<span class="at">sep=</span><span class="st">&quot;&quot;</span>),</span>
<span id="cb104-42"><a href="presentation.html#cb104-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab=</span><span class="st">&#39;Postchemo size (mm)&#39;</span>, <span class="at">xlab=</span><span class="st">&quot;Prechemo size (mm)&quot;</span>, </span>
<span id="cb104-43"><a href="presentation.html#cb104-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>),<span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">pch=</span><span class="st">&quot;5&quot;</span>, <span class="at">axes=</span>F,<span class="at">las=</span><span class="dv">1</span>, <span class="at">col=</span>mycolors[<span class="dv">5</span>], <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb104-44"><a href="presentation.html#cb104-44" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">2</span>,<span class="at">at=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">50</span>))</span>
<span id="cb104-45"><a href="presentation.html#cb104-45" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>,<span class="at">at=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">20</span>,<span class="dv">50</span>,<span class="dv">100</span>))</span>
<span id="cb104-46"><a href="presentation.html#cb104-46" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (i<span class="sc">==</span><span class="dv">1</span>) <span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">col=</span>mycolors[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>)], <span class="at">lwd=</span><span class="dv">2</span>,<span class="at">bty=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb104-47"><a href="presentation.html#cb104-47" aria-hidden="true" tabindex="-1"></a>                 <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;50%&quot;</span>, <span class="st">&quot;60&quot;</span>, <span class="st">&quot;70%&quot;</span>, <span class="st">&quot;80%&quot;</span>, <span class="st">&quot;90%&quot;</span>))</span>
<span id="cb104-48"><a href="presentation.html#cb104-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-49"><a href="presentation.html#cb104-49" aria-hidden="true" tabindex="-1"></a>xp <span class="ot">=</span> x[x<span class="sc">$</span>score4<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(x<span class="sc">$</span>presize60), ]</span>
<span id="cb104-50"><a href="presentation.html#cb104-50" aria-hidden="true" tabindex="-1"></a>xp <span class="ot">=</span> xp[<span class="fu">sort</span>(xp<span class="sc">$</span>presize60),]</span>
<span id="cb104-51"><a href="presentation.html#cb104-51" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">y=</span>xp<span class="sc">$</span>postsize,<span class="at">x=</span>xp<span class="sc">$</span>presize60, <span class="at">pch=</span><span class="st">&quot;6&quot;</span>,<span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span>mycolors[<span class="dv">4</span>], <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb104-52"><a href="presentation.html#cb104-52" aria-hidden="true" tabindex="-1"></a>xp <span class="ot">=</span> x[x<span class="sc">$</span>score4<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(x<span class="sc">$</span>presize70), ]</span>
<span id="cb104-53"><a href="presentation.html#cb104-53" aria-hidden="true" tabindex="-1"></a>xp <span class="ot">=</span> xp[<span class="fu">sort</span>(xp<span class="sc">$</span>presize70),]</span>
<span id="cb104-54"><a href="presentation.html#cb104-54" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">y=</span>xp<span class="sc">$</span>postsize,<span class="at">x=</span>xp<span class="sc">$</span>presize70, <span class="at">pch=</span><span class="st">&quot;7&quot;</span>,<span class="at">lty=</span><span class="dv">1</span>, <span class="at">col=</span>mycolors[<span class="dv">2</span>], <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb104-55"><a href="presentation.html#cb104-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-56"><a href="presentation.html#cb104-56" aria-hidden="true" tabindex="-1"></a>xp <span class="ot">=</span> x[x<span class="sc">$</span>score4<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(x<span class="sc">$</span>presize80), ]</span>
<span id="cb104-57"><a href="presentation.html#cb104-57" aria-hidden="true" tabindex="-1"></a>xp <span class="ot">=</span> xp[<span class="fu">sort</span>(xp<span class="sc">$</span>presize80),]</span>
<span id="cb104-58"><a href="presentation.html#cb104-58" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">y=</span>xp<span class="sc">$</span>postsize,<span class="at">x=</span>xp<span class="sc">$</span>presize80, <span class="at">pch=</span><span class="st">&quot;8&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span>mycolors[<span class="dv">3</span>], <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb104-59"><a href="presentation.html#cb104-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-60"><a href="presentation.html#cb104-60" aria-hidden="true" tabindex="-1"></a>xp <span class="ot">=</span> x[x<span class="sc">$</span>score4<span class="sc">==</span>i <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(x<span class="sc">$</span>presize90), ]</span>
<span id="cb104-61"><a href="presentation.html#cb104-61" aria-hidden="true" tabindex="-1"></a>xp <span class="ot">=</span> xp[<span class="fu">sort</span>(xp<span class="sc">$</span>presize90),]</span>
<span id="cb104-62"><a href="presentation.html#cb104-62" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">y=</span>xp<span class="sc">$</span>postsize,<span class="at">x=</span>xp<span class="sc">$</span>presize90, <span class="at">pch=</span><span class="st">&quot;9&quot;</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">col=</span>mycolors[<span class="dv">6</span>], <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb104-63"><a href="presentation.html#cb104-63" aria-hidden="true" tabindex="-1"></a>} <span class="co"># end loop over score 1 - 4</span></span></code></pre></div>
<p><img src="fig/Fig18.3-1.png" width="672" /></p>
<p>So, we obtain some nice graphics. With score 0, men are at high risk of tumor. With score 4, even a relatively large post-chemotherapy mass size leads to high probabilities of necrosis, especially if the pre-chemotherapy mass was large.</p>
</div>
</div>
<div id="fig-18.4" class="section level2 unnumbered hasAnchor">
<h2>Fig 18.4<a href="presentation.html#fig-18.4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="meta-model-with-tree-presentation" class="section level3 hasAnchor" number="18.2.9">
<h3><span class="header-section-number">18.2.9</span> Meta-model with tree presentation<a href="presentation.html#meta-model-with-tree-presentation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can present a decision rule for patients with testicular cancer, assuming a threshold of 70% for the probability of necrosis. If the probability is higher than 70%, this is a good prognosis group which could be spared surgery.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="presentation.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Start with dichotomizing predictions from full as &lt;70% vs &gt;=70%</span></span>
<span id="cb105-2"><a href="presentation.html#cb105-2" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>predhigh <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">plogis</span>(full<span class="sc">$</span>linear.predictor)<span class="sc">&lt;</span>.<span class="dv">7</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb105-3"><a href="presentation.html#cb105-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-4"><a href="presentation.html#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Try to make tree model for this outcome</span></span>
<span id="cb105-5"><a href="presentation.html#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb105-6"><a href="presentation.html#cb105-6" aria-hidden="true" tabindex="-1"></a>tree.orig <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Necrosis <span class="sc">~</span> Teratoma<span class="sc">+</span>Pre.AFP<span class="sc">+</span>Pre.HCG<span class="sc">+</span>LDHst<span class="sc">+</span>Post.size<span class="sc">+</span>Reduction,</span>
<span id="cb105-7"><a href="presentation.html#cb105-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>n544)</span>
<span id="cb105-8"><a href="presentation.html#cb105-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tree.orig)</span>
<span id="cb105-9"><a href="presentation.html#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(tree.orig, <span class="at">use.n=</span>F)</span>
<span id="cb105-10"><a href="presentation.html#cb105-10" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Meta-model for original predictions&quot;</span>)</span></code></pre></div>
<p><img src="fig/Fig18.4-1.png" width="672" /></p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="presentation.html#cb106-1" aria-hidden="true" tabindex="-1"></a>tree.meta <span class="ot">&lt;-</span> <span class="fu">rpart</span>(predhigh <span class="sc">~</span> Teratoma<span class="sc">+</span>Pre.AFP<span class="sc">+</span>Pre.HCG<span class="sc">+</span>LDHst<span class="sc">+</span>Post.size<span class="sc">+</span>Reduction,</span>
<span id="cb106-2"><a href="presentation.html#cb106-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>n544)</span>
<span id="cb106-3"><a href="presentation.html#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tree.meta)</span>
<span id="cb106-4"><a href="presentation.html#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(tree.meta, <span class="at">use.n=</span>F)</span>
<span id="cb106-5"><a href="presentation.html#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Meta-model for probability &gt; 70%&quot;</span>)</span></code></pre></div>
<p><img src="fig/Fig18.4-2.png" width="672" /></p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="presentation.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Make smooth tree presentation; classification with reduction, teratoma, AFP</span></span>
<span id="cb107-2"><a href="presentation.html#cb107-2" aria-hidden="true" tabindex="-1"></a>score3  <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(n544<span class="sc">$</span>Reduction<span class="sc">&gt;</span><span class="dv">70</span>)<span class="sc">+</span><span class="fu">as.numeric</span>(n544<span class="sc">$</span>Teratoma<span class="sc">==</span><span class="dv">1</span>)<span class="sc">+</span><span class="fu">as.numeric</span>(n544<span class="sc">$</span>Pre.AFP<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb107-3"><a href="presentation.html#cb107-3" aria-hidden="true" tabindex="-1"></a>n544<span class="sc">$</span>tree.cat  <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(n544<span class="sc">$</span>Reduction<span class="sc">&gt;</span><span class="dv">50</span> <span class="sc">&amp;</span> score3<span class="sc">&gt;=</span><span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb107-4"><a href="presentation.html#cb107-4" aria-hidden="true" tabindex="-1"></a>tree.results <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(n544<span class="sc">$</span>tree.cat, n544<span class="sc">$</span>Necrosis))</span>
<span id="cb107-5"><a href="presentation.html#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tree.results) <span class="ot">&lt;-</span> <span class="fu">Cs</span>(<span class="st">&quot;Risk group&quot;</span>, Necrosis, N)</span>
<span id="cb107-6"><a href="presentation.html#cb107-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tree.results, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>) </span></code></pre></div>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
Risk group
</th>
<th style="text-align:left;">
Necrosis
</th>
<th style="text-align:right;">
N
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
264
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
35
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
134
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
111
</td>
</tr>
</tbody>
</table>
<p>end tree analysis</p>
</div>
</div>
<div id="apparent-performance-of-penalized-vs-rescaled-vs-simplified-models" class="section level2 unnumbered hasAnchor">
<h2>Apparent performance of penalized vs rescaled vs simplified models<a href="presentation.html#apparent-performance-of-penalized-vs-rescaled-vs-simplified-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>What is the c statistic of various formats to predict necrosis at resection after chemotherapy?
a) nomogram (Fig 18.1): original or penalized coefficients, negligable difference expected
b) score chart (Table 18.2 and Fig 18.2): rounding, minor decline expected
c) simple table (Table 18.3): categorization and simplification, much loss expected
d) iso-probability lines (Fig 18.3): major predictors (size, reduction) kept continuous, some loss expected
e) tree on a meta-model (Fig 18.4): ultra simple, major loss in performance expected</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="presentation.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 variants of full model fit</span></span>
<span id="cb108-2"><a href="presentation.html#cb108-2" aria-hidden="true" tabindex="-1"></a>cstats <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb108-3"><a href="presentation.html#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rcorr.cens</span>(full<span class="sc">$</span>linear.predictor, n544<span class="sc">$</span>Necrosis)[<span class="dv">1</span>],</span>
<span id="cb108-4"><a href="presentation.html#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rcorr.cens</span>(full.shrunk<span class="sc">$</span>linear.predictor, n544<span class="sc">$</span>Necrosis)[<span class="dv">1</span>],</span>
<span id="cb108-5"><a href="presentation.html#cb108-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rcorr.cens</span>(full.pen<span class="sc">$</span>linear.predictor, n544<span class="sc">$</span>Necrosis)[<span class="dv">1</span>],</span>
<span id="cb108-6"><a href="presentation.html#cb108-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rounding for score chart</span></span>
<span id="cb108-7"><a href="presentation.html#cb108-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rcorr.cens</span>(score.fit<span class="sc">$</span>linear.predictor, n544<span class="sc">$</span>Necrosis)[<span class="dv">1</span>],</span>
<span id="cb108-8"><a href="presentation.html#cb108-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simple table</span></span>
<span id="cb108-9"><a href="presentation.html#cb108-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rcorr.cens</span>(n544<span class="sc">$</span>simple.cat, n544<span class="sc">$</span>Necrosis)[<span class="dv">1</span>],</span>
<span id="cb108-10"><a href="presentation.html#cb108-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Radiology paper</span></span>
<span id="cb108-11"><a href="presentation.html#cb108-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rcorr.cens</span>(full.simple3<span class="sc">$</span>linear.predictor, n544<span class="sc">$</span>Necrosis)[<span class="dv">1</span>],</span>
<span id="cb108-12"><a href="presentation.html#cb108-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tree</span></span>
<span id="cb108-13"><a href="presentation.html#cb108-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rcorr.cens</span>(n544<span class="sc">$</span>tree.cat, n544<span class="sc">$</span>Necrosis)[<span class="dv">1</span>])</span>
<span id="cb108-14"><a href="presentation.html#cb108-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cstats) <span class="ot">&lt;-</span> <span class="fu">Cs</span>(full, shrunk, penalized, scores, table, radiology, tree)</span>
<span id="cb108-15"><a href="presentation.html#cb108-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(cstats) <span class="ot">&lt;-</span> <span class="st">&quot;C&quot;</span></span>
<span id="cb108-16"><a href="presentation.html#cb108-16" aria-hidden="true" tabindex="-1"></a><span class="fu">dotchart</span>(cstats, <span class="at">xlab=</span><span class="st">&quot;C statistic&quot;</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="fl">0.6</span>,.<span class="dv">9</span>))</span></code></pre></div>
<p><img src="fig/performance-1.png" width="672" /></p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="presentation.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as.data.frame</span>(cstats), <span class="at">digits =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width=</span>F, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>) </span></code></pre></div>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
full
</th>
<th style="text-align:right;">
shrunk
</th>
<th style="text-align:right;">
penalized
</th>
<th style="text-align:right;">
scores
</th>
<th style="text-align:right;">
table
</th>
<th style="text-align:right;">
radiology
</th>
<th style="text-align:right;">
tree
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
0.839
</td>
<td style="text-align:right;">
0.839
</td>
<td style="text-align:right;">
0.839
</td>
<td style="text-align:right;">
0.838
</td>
<td style="text-align:right;">
0.725
</td>
<td style="text-align:right;">
0.838
</td>
<td style="text-align:right;">
0.668
</td>
</tr>
</tbody>
</table>
<div id="end-comparisons-of-c-statistics" class="section level3 hasAnchor" number="18.2.10">
<h3><span class="header-section-number">18.2.10</span> End comparisons of c statistics<a href="presentation.html#end-comparisons-of-c-statistics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As expected, the apparent performance of penalized vs rescaled models was very similar. Two formats led to a substantial loss in performance:</p>
<ul>
<li>simple table (Table 18.3): categorization and simplification, c=0.73 cp to c=0.84<br />
</li>
<li>tree on a meta-model (Fig 18.4): ultra simple, c=0.67, for a single threshold to classify men as low risk and spare them resection.</li>
</ul>
<p>Please use and improve the code above when desired. The major tools for presentation are:<br />
1. The <code>nomogram</code> function: allows for scores with categorical and continuous predictors, with transformations.<br />
2. The regression formula: can be implemented in wwww tools, including the <a href="https://www.evidencio.com/models">Evidencio</a> toolbox.</p>

</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="validation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="external-validity.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
