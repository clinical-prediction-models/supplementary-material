[["index.html", "Clinical prediction models Preface", " Clinical prediction models Ewout Steyerberg 2022-11-19 Preface Work in progress This bookdown-based website containing the supplementary materials from ‘Clinical Prediction Models: A Practical Approach to Development, Validation, and Updating’, by E. W. Steyerberg (2009). "],["introduction.html", "1 Introduction", " 1 Introduction Chapter 1 has no additional material. "],["applications.html", "2 Applications of Prediction Models", " 2 Applications of Prediction Models See here for additional material. "],["design.html", "3 Study Design for Prediction Modeling", " 3 Study Design for Prediction Modeling Chapter 3 has no additional material. "],["statmods.html", "4 Statistical Models for Prediction", " 4 Statistical Models for Prediction Chapter 4 has no additional material. "],["overfitting.html", "5 Overfitting and Optimism in Prediction Models 5.1 Figures 5.2 to 5.5", " 5 Overfitting and Optimism in Prediction Models 5.1 Figures 5.2 to 5.5 5.1.1 Fig 5.2: Noise in estimating 10% mortality per center # Surg mortality; 10% par(mfrow = c(1, 1), mar = c(5, 5, 1, 1)) for (mort in c(.1)) { ## ,0.05,0.02,.01)) { # 4 mortalities or only 1 plot( x = seq(from = -.025, to = .975, by = .05), dbinom(x = 0:20, 20, mort), axes = F, type = &quot;s&quot;, lwd = 2, xlim = c(-.05, .35), ylim = c(0, .33), col = mycolors[2], xlab = paste(&quot;Observed mortality, true mortality &quot;, round(100 * mort, 0), &quot;%&quot;, sep = &quot;&quot;), ylab = &quot;probability density&quot; ) axis(side = 1, at = c(0, .1, .2, .3), labels = c(&quot;0%&quot;, &quot;10%&quot;, &quot;20%&quot;, &quot;30%&quot;)) axis(side = 2, at = c(0, 0.1, .2, .3, .4, .5, .6, .7), labels = c(&quot;0%&quot;, &quot;10%&quot;, &quot;20%&quot;, &quot;30%&quot;, &quot;40%&quot;, &quot;50%&quot;, &quot;60%&quot;, &quot;70%&quot;)) text(x = mort, y = .02 + dbinom(x = max(round(mort * 20), 0), 20, mort), labels = paste(&quot;n=20&quot;), col = mycolors[2]) for (i in c(50, 200)) { # add more sample sizes lines( x = seq(from = 0 - (0.5 * 1 / i), to = 1 - (0.5 * 1 / i), by = 1 / i), dbinom(x = 0:i, i, mort), type = &quot;s&quot;, lty = ifelse(i == 50, 2, 4), lwd = 2, col = mycolors[ifelse(i == 50, 3, 4)] ) text(x = mort, y = .02 + dbinom(x = max(round(mort * i), 0), i, mort), labels = paste(&quot;n=&quot;, i, sep = &quot;&quot;), col = mycolors[ifelse(i == 50, 3, 4)]) } # end loop n=50,200 } # end loop mort ## End Fig 5.2 ## ## function for Fig 5.3 and Fig 5.4: Noise vs Heterogeneity illustrate_noise_heterogeneity &lt;- function(n = 20, mort = 0.1, tau = c(0, .01, .02, .03)) { par(mfrow = c(2, 2), pty = &quot;m&quot;, mar = c(2.5, 4, 1.5, 1)) # Make data set with 100 centers, each 20 patients, 10% mortality, variability sd 0 to 0.03 seedn &lt;- 102 set.seed(seedn) ncenter &lt;- 50 nsubjects &lt;- n # n can be changed # simple SD used on probability scale, can be improved upon for (sdtau in tau) { # set for tau can be changed truemort &lt;- rnorm(n = ncenter, mean = mort, sd = sdtau) # mort can be changed mortmat &lt;- as.matrix(cbind(1:ncenter, sapply(truemort, FUN = function(x) rbinom(n = 1, nsubjects, x)) / nsubjects, truemort)) # Start plotting plot(x = 0, y = 0, pch = &quot;&quot;, xlim = c(-.2, 1.2), ylim = c(-.03, .35), axes = F, xlab = &quot;&quot;, ylab = ifelse(sdtau == 0 | sdtau == .02, &quot;Mortality&quot;, &quot;&quot;)) axis(side = 2, at = c(0, .1, .2, .3), labels = c(&quot;0%&quot;, &quot;10%&quot;, &quot;20%&quot;, &quot;30%&quot;), las = 1) axis(side = 1, at = c(0, 1), labels = c(&quot;Observed&quot;, &quot;True mortality&quot;)) text(x = 1, y = .3, ifelse(sdtau == 0, &quot;No heterogeneity&quot;, ifelse(sdtau != 0, paste(&quot;+/-&quot;, sdtau)) ), cex = 1, adj = 1, font = 2) for (i in (1:ncenter)) { set.seed(i + seedn) lines( x = c(0 + runif(1, min = -.07, max = .07), 1), y = c(mortmat[i, 2] + runif(1, min = -.001, max = .01), mortmat[i, 3]), col = mycolors[rep(1:10, 10)[i]] ) set.seed(i + seedn) points( x = c(0 + runif(1, min = -.07, max = .07), 1), y = c(mortmat[i, 2] + runif(1, min = -.001, max = .01), mortmat[i, 3]), pch = c(&quot;o&quot;, &quot;+&quot;), col = mycolors[rep(1:10, 10)[i]] ) } } } # end function that illustrates the impact of noise (determined by n) vs heterogeneity (determined by sdtau) 5.1.2 Figs 5.3 and 5.4 These plots llustrate the impact of noise (determined by n, 20 or 200) vs heterogeneity (determined by sdtau (0 - 0.03)). With small n, such as n=20 per center, mortality such as 10% cannot be estimated reliably. Reliable estimation of a center’s performance requires a large n, such as n=200. 5.1.3 n=20 5.1.4 n=200 "],["altmods.html", "6 Choosing Between Alternative Models 6.1 Non-linearity illustrations", " 6 Choosing Between Alternative Models 6.1 Non-linearity illustrations 6.1.1 Prepare GUSTO data Some logistic regression fits with linear, square, rcs, linear spline terms # Import gusto; publicly available gusto &lt;- read.csv(&quot;data/gusto_age.csv&quot;)[-1] Fmort &lt;- as.data.frame(read.csv(&quot;data/Fmort.csv&quot;))[-1] Fmort$age10 &lt;- Fmort$age / 10 Fmort$age102 &lt;- Fmort$age10^2 6.1.2 anova results for the different fits We note minor differences between the continuous fits, and a clear loss of information for the dichtomization at age 65 years anova(agegusto.linear) ## &lt;table class=&#39;gmisc_table&#39; style=&#39;border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;&#39; &gt; ## &lt;thead&gt; ## &lt;tr&gt;&lt;td colspan=&#39;4&#39; style=&#39;text-align: left;&#39;&gt; ## Wald Statistics for &lt;code style=&quot;font-size:0.8em&quot;&gt;DAY30&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt; ## &lt;tr&gt;&lt;th style=&#39;border-bottom: 1px solid grey; font-weight: 900; border-top: 2px solid grey; text-align: center;&#39;&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;χ&lt;sup&gt;2&lt;/sup&gt;&lt;/i&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;d.f.&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;P&lt;/i&gt;&lt;/th&gt; ## &lt;/tr&gt; ## &lt;/thead&gt; ## &lt;tbody&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;AGE&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;1728.89&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;border-bottom: 2px solid grey; text-align: left;&#39;&gt;TOTAL&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;1728.89&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;/tbody&gt; ## &lt;/table&gt; anova(agegusto.square) ## &lt;table class=&#39;gmisc_table&#39; style=&#39;border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;&#39; &gt; ## &lt;thead&gt; ## &lt;tr&gt;&lt;td colspan=&#39;4&#39; style=&#39;text-align: left;&#39;&gt; ## Wald Statistics for &lt;code style=&quot;font-size:0.8em&quot;&gt;DAY30&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt; ## &lt;tr&gt;&lt;th style=&#39;border-bottom: 1px solid grey; font-weight: 900; border-top: 2px solid grey; text-align: center;&#39;&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;χ&lt;sup&gt;2&lt;/sup&gt;&lt;/i&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;d.f.&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;P&lt;/i&gt;&lt;/th&gt; ## &lt;/tr&gt; ## &lt;/thead&gt; ## &lt;tbody&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;AGE&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;1858.27&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;2&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt; &lt;i&gt;Nonlinear&lt;/i&gt;&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 13.21&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.0003&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;border-bottom: 2px solid grey; text-align: left;&#39;&gt;TOTAL&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;1858.27&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;2&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;/tbody&gt; ## &lt;/table&gt; anova(agegusto.rcs) ## &lt;table class=&#39;gmisc_table&#39; style=&#39;border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;&#39; &gt; ## &lt;thead&gt; ## &lt;tr&gt;&lt;td colspan=&#39;4&#39; style=&#39;text-align: left;&#39;&gt; ## Wald Statistics for &lt;code style=&quot;font-size:0.8em&quot;&gt;DAY30&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt; ## &lt;tr&gt;&lt;th style=&#39;border-bottom: 1px solid grey; font-weight: 900; border-top: 2px solid grey; text-align: center;&#39;&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;χ&lt;sup&gt;2&lt;/sup&gt;&lt;/i&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;d.f.&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;P&lt;/i&gt;&lt;/th&gt; ## &lt;/tr&gt; ## &lt;/thead&gt; ## &lt;tbody&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;AGE&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;1878.45&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;4&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt; &lt;i&gt;Nonlinear&lt;/i&gt;&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 24.71&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;3&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;border-bottom: 2px solid grey; text-align: left;&#39;&gt;TOTAL&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;1878.45&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;4&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;/tbody&gt; ## &lt;/table&gt; anova(agegusto.linearspline) ## &lt;table class=&#39;gmisc_table&#39; style=&#39;border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;&#39; &gt; ## &lt;thead&gt; ## &lt;tr&gt;&lt;td colspan=&#39;4&#39; style=&#39;text-align: left;&#39;&gt; ## Wald Statistics for &lt;code style=&quot;font-size:0.8em&quot;&gt;DAY30&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt; ## &lt;tr&gt;&lt;th style=&#39;border-bottom: 1px solid grey; font-weight: 900; border-top: 2px solid grey; text-align: center;&#39;&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;χ&lt;sup&gt;2&lt;/sup&gt;&lt;/i&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;d.f.&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;P&lt;/i&gt;&lt;/th&gt; ## &lt;/tr&gt; ## &lt;/thead&gt; ## &lt;tbody&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;AGE&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;1846.73&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;2&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;border-bottom: 2px solid grey; text-align: left;&#39;&gt;TOTAL&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;1846.73&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;2&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;/tbody&gt; ## &lt;/table&gt; anova(agegusto.cat65) ## &lt;table class=&#39;gmisc_table&#39; style=&#39;border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;&#39; &gt; ## &lt;thead&gt; ## &lt;tr&gt;&lt;td colspan=&#39;4&#39; style=&#39;text-align: left;&#39;&gt; ## Wald Statistics for &lt;code style=&quot;font-size:0.8em&quot;&gt;DAY30&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt; ## &lt;tr&gt;&lt;th style=&#39;border-bottom: 1px solid grey; font-weight: 900; border-top: 2px solid grey; text-align: center;&#39;&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;χ&lt;sup&gt;2&lt;/sup&gt;&lt;/i&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;d.f.&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;P&lt;/i&gt;&lt;/th&gt; ## &lt;/tr&gt; ## &lt;/thead&gt; ## &lt;tbody&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;AGE&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;1262.57&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;border-bottom: 2px solid grey; text-align: left;&#39;&gt;TOTAL&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;1262.57&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;/tbody&gt; ## &lt;/table&gt; 6.1.3 Plotting of age effects Plot age effect first at lp scale (logodds), then at probability scale Age effect at logodds scale; Age effect at probability scale Fig 6.1 6.1.4 Start surgical mortality by age in Medicare Age effect at logodds scale 6.1.5 anova results for the fit of age, with interaction by type of surgery Type of surgery is clearly most relevant (chi2 &gt;13500) in all fits. Age is als relevant (chi2&gt;3000), and a square term is not needed (chi2 = 2); the interaction adds a little bit (chi2 95). With these large numbers (1.1M patients), most effects have p&lt;.0001. We will evaluate the differences between fits with or without interaction term graphically further down # Look for model improvements anova(fitplot2) # linear age effect, no interaction with surgery ## &lt;table class=&#39;gmisc_table&#39; style=&#39;border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;&#39; &gt; ## &lt;thead&gt; ## &lt;tr&gt;&lt;td colspan=&#39;4&#39; style=&#39;text-align: left;&#39;&gt; ## Wald Statistics for &lt;code style=&quot;font-size:0.8em&quot;&gt;mort&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt; ## &lt;tr&gt;&lt;th style=&#39;border-bottom: 1px solid grey; font-weight: 900; border-top: 2px solid grey; text-align: center;&#39;&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;χ&lt;sup&gt;2&lt;/sup&gt;&lt;/i&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;d.f.&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;P&lt;/i&gt;&lt;/th&gt; ## &lt;/tr&gt; ## &lt;/thead&gt; ## &lt;tbody&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;surgery&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;13500.19&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;13&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;age&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 3167.14&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;border-bottom: 2px solid grey; text-align: left;&#39;&gt;TOTAL&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;16445.99&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;14&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;/tbody&gt; ## &lt;/table&gt; anova(fitage2) # age square added ## &lt;table class=&#39;gmisc_table&#39; style=&#39;border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;&#39; &gt; ## &lt;thead&gt; ## &lt;tr&gt;&lt;td colspan=&#39;4&#39; style=&#39;text-align: left;&#39;&gt; ## Wald Statistics for &lt;code style=&quot;font-size:0.8em&quot;&gt;mort&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt; ## &lt;tr&gt;&lt;th style=&#39;border-bottom: 1px solid grey; font-weight: 900; border-top: 2px solid grey; text-align: center;&#39;&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;χ&lt;sup&gt;2&lt;/sup&gt;&lt;/i&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;d.f.&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;P&lt;/i&gt;&lt;/th&gt; ## &lt;/tr&gt; ## &lt;/thead&gt; ## &lt;tbody&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;surgery&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;13499.66&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;13&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;age10&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 18.13&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;age102&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 2.33&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.1270&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;border-bottom: 2px solid grey; text-align: left;&#39;&gt;TOTAL&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;16424.97&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;15&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;/tbody&gt; ## &lt;/table&gt; anova(fitplot) # interaction added to linear age effect ## &lt;table class=&#39;gmisc_table&#39; style=&#39;border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;&#39; &gt; ## &lt;thead&gt; ## &lt;tr&gt;&lt;td colspan=&#39;4&#39; style=&#39;text-align: left;&#39;&gt; ## Wald Statistics for &lt;code style=&quot;font-size:0.8em&quot;&gt;mort&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt; ## &lt;tr&gt;&lt;th style=&#39;border-bottom: 1px solid grey; font-weight: 900; border-top: 2px solid grey; text-align: center;&#39;&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;χ&lt;sup&gt;2&lt;/sup&gt;&lt;/i&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;d.f.&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;P&lt;/i&gt;&lt;/th&gt; ## &lt;/tr&gt; ## &lt;/thead&gt; ## &lt;tbody&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;surgery (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;13566.02&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;26&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt; &lt;i&gt;All Interactions&lt;/i&gt;&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 94.55&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;13&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;age (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 3280.66&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;14&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt; &lt;i&gt;All Interactions&lt;/i&gt;&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 94.55&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;13&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;surgery × age (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 94.55&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;13&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;border-bottom: 2px solid grey; text-align: left;&#39;&gt;TOTAL&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;16620.27&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;27&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;/tbody&gt; ## &lt;/table&gt; 6.1.6 Plotting of predicted age effects, with interaction by type of surgery; add 95% CI Plot age effects at logodds scale with 95% CI 6.1.7 Plotting of age effects with original data points Fit with interaction (solid lines) and no interaction (dashed lines) "],["missing.html", "7 Missing values", " 7 Missing values Chapter 7 additional material upcoming. "],["missing-case.html", "8 Case Study on Dealing with Missing Values", " 8 Case Study on Dealing with Missing Values Chapter 8 additional material upcoming. "],["coding.html", "9 Coding of Categorical and Continuous Predictors 9.1 Figues 9.1 to 9.6", " 9 Coding of Categorical and Continuous Predictors 9.1 Figues 9.1 to 9.6 GUSTO-I is a data set with patients suffering from an acute myocardial infarction, where we want to predict 30-day mortality. TBI is a data set with patients suffering from a moderate or severe traumatic brain injury. # Import gusto gusto &lt;- read.csv(&quot;data/gusto_age_STE.csv&quot;)[, -1] # Import sample4; n=785 gustos &lt;- read.csv(&quot;data/Gustos4Age.csv&quot;) # Import TBI data; n=2159 TBI &lt;- read.csv(&quot;data/TBI2vars.csv&quot;) 9.1.1 Fig 9.1: Age linear; add square; rcs in GUSTO-I agegusto.linear &lt;- lrm(DAY30 ~ AGE, data = gusto, x = T, y = T) agegusto.square &lt;- lrm(DAY30 ~ pol(AGE, 2), data = gusto, x = T, y = T) agegusto.rcs &lt;- lrm(DAY30 ~ rcs(AGE, 5), data = gusto, x = T, y = T) ## dichotomize agegusto.cat65 &lt;- lrm(DAY30 ~ ifelse(AGE &lt; 65, 0, 1), data = gusto, x = T, y = T) ## 3 categories agegusto.3cat &lt;- lrm(DAY30 ~ ifelse(AGE &lt; 60, 0, ifelse(AGE &lt; 70, 1, 2)), data = gusto, x = T, y = T) # Predict for age 20:95 newdata.age &lt;- data.frame(&quot;AGE&quot; = seq(20, 95, by = 0.1)) pred.agegusto.linear &lt;- predict(agegusto.linear, newdata.age) pred.agegusto.square &lt;- predict(agegusto.square, newdata.age) pred.agegusto.rcs &lt;- predict(agegusto.rcs, newdata.age) pred.agegusto.cat65 &lt;- predict(agegusto.cat65, newdata.age) pred.agegusto.3cat &lt;- predict(agegusto.3cat, newdata.age) # Make plot dd &lt;- datadist(gusto) options(datadist = &quot;dd&quot;) # for rms par(mfrow = c(1, 1)) plot( x = newdata.age[, 1], y = pred.agegusto.linear, xlim = c(20, 92), ylim = c(-7, 0), las = 1, xaxt = &quot;n&quot;, xlab = &quot;Age in years&quot;, ylab = &quot;logit of 30-day mortality&quot;, cex.lab = 1.2, type = &quot;l&quot;, lwd = 2, col = mycolors[2] ) axis(1, at = c(40, 50, 60, 65, 70, 80, 90)) lines(x = newdata.age[, 1], y = pred.agegusto.cat65, lty = 2, lwd = 2, col = mycolors[3]) lines(x = newdata.age[, 1], y = pred.agegusto.3cat, lty = 3, lwd = 2, col = mycolors[4]) scat1d(x = gusto$AGE, side = 1, frac = .05, col = &quot;darkblue&quot;) legend(&quot;topleft&quot;, legend = c(&quot;linear&quot;, &quot;&lt;65 vs &gt;=65&quot;, &quot;&lt;60, 60-69, 70+&quot;), lty = c(1, 2, 3), lwd = 2, cex = 1, bty = &quot;n&quot;, col = mycolors[2:4] ) 9.1.2 Fig 9.2: Impact of number of ST elevations (STE) # winsorize at STE 10 gusto$STE &lt;- ifelse(gusto$STE &gt; 10, 10, gusto$STE) gusto$STE.f &lt;- as.factor(gusto$STE) STE.linear &lt;- lrm(DAY30 ~ STE, data = gusto, x = T, y = T) STE.square &lt;- lrm(DAY30 ~ pol(STE, 2), data = gusto, x = T, y = T) STE.rcs &lt;- lrm(DAY30 ~ rcs(STE, 5), data = gusto, x = T, y = T) STE.factor &lt;- lrm(DAY30 ~ STE.f, data = gusto, x = T, y = T) # dichotomize STE.cat4 &lt;- lrm(DAY30 ~ ifelse(STE &lt; 5, 0, 1), data = gusto, x = T, y = T) # predict for STE 0:10 newdata.STE &lt;- data.frame(&quot;STE&quot; = seq(0, 10, by = 1)) pred.STE.linear &lt;- predict(STE.linear, newdata.STE) pred.STE.square &lt;- predict(STE.square, newdata.STE) pred.STE.rcs &lt;- predict(STE.rcs, newdata.STE) pred.STE.cat4 &lt;- predict(STE.cat4, newdata.STE) par(mfrow = c(1, 1)) plot( x = newdata.STE[, 1], y = pred.STE.linear, las = 1, xlab = &quot;Number of leads with ST elevation&quot;, ylab = &quot;logit of 30-day mortality&quot;, cex.lab = 1.2, type = &quot;l&quot;, lwd = 2, col = mycolors[2] ) lines(x = newdata.STE[, 1], y = pred.STE.square, lty = 2, lwd = 2, col = mycolors[3]) lines(x = newdata.STE[, 1], y = pred.STE.rcs, lty = 3, lwd = 3, col = mycolors[4]) lines(x = newdata.STE[1:5, 1], y = pred.STE.cat4[1:5], lty = 4, lwd = 2, col = mycolors[5]) lines(x = newdata.STE[6:11, 1], y = pred.STE.cat4[6:11], lty = 4, lwd = 2, col = mycolors[5]) # Original data points, with size proportional to sqrt(events) STEmort &lt;- log(by(gusto$DAY, gusto$STE, mean) / (1 - by(gusto$DAY, gusto$STE, mean)))[1:11] STEw &lt;- sqrt(by(gusto$DAY, gusto$STE, sum)[1:11]) / 10 points(x = newdata.STE[, 1], y = STEmort, pch = 1, lwd = 2, cex = STEw, col = &quot;black&quot;) scat1d(x = gusto$STE, side = 1, frac = .05, col = &quot;darkblue&quot;) legend(&quot;topleft&quot;, legend = c(&quot;data&quot;, &quot;linear&quot;, &quot;.. +square&quot;, &quot;rcs&quot;, &quot;&lt;=4, vs &gt;4&quot;), lty = c(NA, 1, 2, 3, 4), pch = c(1, NA, NA, NA, NA), lwd = 2, cex = 1, bty = &quot;n&quot;, col = mycolors[1:5] ) 9.1.3 Fig 9.3: Non-linearities in small sample (n=751); and full GUSTO-I (n=40,830) # Examine non-linearities in gustos sample # Age age.linear &lt;- lrm(DAY30 ~ AGE, data = gustos, x = T, y = T, linear.predictors = F) age.rcs1 &lt;- lrm(DAY30 ~ rcs(AGE, 5), data = gustos, x = T, y = T, linear.predictors = F) age.fp1 &lt;- mfp(DAY30 ~ fp(AGE, df = 4), alpha = 1, data = gustos, family = binomial) # selected: -2 and 3 age.gam1 &lt;- gam(DAY30 ~ s(AGE), data = gustos, family = binomial) # examine predictions for age 20:95 age.mat &lt;- matrix(nrow = 751, ncol = 5) names(age.mat) &lt;- list(NULL, Cs(AGE, linear, fp, rcs, gam)) AGE &lt;- seq(20, 95, by = 0.1) age.mat[, 1] &lt;- AGE age.mat[, 2] &lt;- predict(age.linear, newdata = as.data.frame(x = AGE), type = &quot;lp&quot;) age.mat[, 3] &lt;- predict(age.fp1, newdata = as.data.frame(x = AGE)) age.mat[, 4] &lt;- predict(age.rcs1, newdata = as.data.frame(x = AGE), type = &quot;lp&quot;) age.mat[, 5] &lt;- predict(age.gam1, newdata = as.data.frame(x = AGE)) # Plot for n=785, Fig 9.3, part A # par(mfrow = c(1, 2)) plot( x = age.mat[, 1], y = age.mat[, 2], xlim = c(20, 92), ylim = c(-8, 0.2), las = 1, xaxt = &quot;n&quot;, xlab = &quot;Age in years&quot;, ylab = &quot;logit of 30-day mortality&quot;, cex.lab = 1.2, type = &quot;l&quot;, lwd = 2, col = mycolors[2] ) axis(1, at = c(30, 40, 50, 60, 70, 80, 90)) lines(x = age.mat[, 1], y = age.mat[, 3], lty = 2, lwd = 2, col = mycolors[3]) lines(x = age.mat[, 1], y = age.mat[, 4], lty = 3, lwd = 3, col = mycolors[4]) lines(x = age.mat[, 1], y = age.mat[, 5], lty = 4, lwd = 3, col = mycolors[5]) histSpike(x = gustos$AGE, side = 1, frac = .1, col = &quot;darkblue&quot;, add = T) legend(&quot;topleft&quot;, legend = c(&quot;linear&quot;, &quot;fp&quot;, &quot;rcs&quot;, &quot;gam&quot;), lty = 1:4, lwd = 2, cex = 1.2, bty = &quot;n&quot;, col = mycolors[2:5] ) title(&quot;GUSTO-I, n=785&quot;) # End plot n=785 #################### ## Now: N=40,830 ## age.linear.2 &lt;- lrm(DAY30 ~ AGE, data = gusto, x = T, y = T, linear.predictors = F) age.rcs1.2 &lt;- lrm(DAY30 ~ rcs(AGE, 5), data = gusto, x = T, y = T, linear.predictors = F) age.fp1.2 &lt;- mfp(DAY30 ~ fp(AGE, df = 4), alpha = 1, data = gusto, family = binomial) # selected: -2 and 3 age.gam1.2 &lt;- gam(DAY30 ~ s(AGE), data = gusto, family = binomial) # examine predictions for age 20:95 age.mat.2 &lt;- matrix(nrow = 751, ncol = 5) names(age.mat.2) &lt;- list(NULL, Cs(AGE, linear, fp, rcs, gam)) age.mat.2[, 1] &lt;- AGE age.mat.2[, 2] &lt;- predict(age.linear.2, newdata = as.data.frame(x = AGE), type = &quot;lp&quot;) age.mat.2[, 3] &lt;- predict(age.fp1.2, newdata = as.data.frame(x = AGE)) age.mat.2[, 4] &lt;- predict(age.rcs1.2, newdata = as.data.frame(x = AGE), type = &quot;lp&quot;) age.mat.2[, 5] &lt;- predict(age.gam1.2, newdata = as.data.frame(x = AGE)) # Plot for n=40830 plot( x = age.mat.2[, 1], y = age.mat.2[, 2], xlim = c(20, 92), ylim = c(-8, 0.2), las = 1, xaxt = &quot;n&quot;, xlab = &quot;Age in years&quot;, ylab = &quot;&quot;, cex.lab = 1.2, type = &quot;l&quot;, lwd = 2, col = mycolors[2] ) axis(1, at = c(30, 40, 50, 60, 70, 80, 90)) lines(x = age.mat.2[, 1], y = age.mat.2[, 3], lty = 2, lwd = 2, col = mycolors[3]) lines(x = age.mat.2[, 1], y = age.mat.2[, 4], lty = 3, lwd = 3, col = mycolors[4]) lines(x = age.mat.2[, 1], y = age.mat.2[, 5], lty = 4, lwd = 3, col = mycolors[5]) histSpike(x = gusto$AGE, side = 1, frac = .2, col = &quot;darkblue&quot;, add = T) title(&quot;GUSTO-I, n=40,830&quot;) 9.1.4 Fig 9.4: Glucose and hb in TBI We evaluate the predictors ‘glucose’ and ‘hemoglobin’ in TBI. Both are first truncated, after inspecting boxplots (Fig 9.4), and then analyzed for their prognostic value, with plots for illustration of the estimated relations (Fig 9.5). # glucose quantile(TBI$glucose, probs = c(.005, .01, .02, .98, .99, .995), na.rm = T) ## 0.5% 1% 2% 98% 99% 99.5% ## 1.57 2.26 4.28 18.34 20.92 23.39 # 0.5% 1% 2% 98% 99% 99.5% # 1.57 2.26 4.28 18.34 20.92 23.39 # So, winsorize / truncate at 3 and 20 # use simple function to do the winsorizing: # {ifelse(x&lt;lower,upper, ifelse(x&gt;upper,upper, x))} winsorize &lt;- function(x, lower = quantile(x, probs = 0.01), upper = quantile(x, probs = 0.99)) { ifelse(x &lt; lower, lower, ifelse(x &gt; upper, upper, x) ) } TBI$glucoset &lt;- winsorize(TBI$glucose, 3, 20) # systolic bp quantile(TBI$hb, probs = c(.005, .01, .02, .98, .99, .995), na.rm = T) ## 0.5% 1% 2% 98% 99% 99.5% ## 4.87 5.40 6.30 16.50 16.80 17.00 # 0.5% 1% 2% 98% 99% 99.5% # 4.87 5.40 6.30 16.50 16.80 17.00 # So, winsorize / truncate at 6 and 17 TBI$hbt &lt;- winsorize(TBI$hb, 6, 17) # boxplots for illustration par(mfrow = c(1, 2)) boxplot(x = cbind(TBI$glucose, TBI$glucoset), outcol = c(&quot;red&quot;, mycolors[4]), border = mycolors[c(10, 4)], xaxt = &quot;n&quot;, ylab = &quot;glucose (mmol/L)&quot;) axis(1, at = c(1, 2), labels = c(&quot;before &quot;, &quot;after winsorizing&quot;)) title(&quot;Glucose&quot;) boxplot(x = cbind(TBI$hb, TBI$hbt), outcol = c(&quot;red&quot;, mycolors[4]), border = mycolors[c(10, 4)], xaxt = &quot;n&quot;, ylab = &quot;hb (mmol/L)&quot;) axis(1, at = c(1, 2), labels = c(&quot;before &quot;, &quot;after winsorizing&quot;)) title(&quot;Hemoglobin&quot;) 9.1.5 Fig 9.5: Non-linear association of glucose 9.1.6 Fig 9.6: Systolic blood pressure in TBI We now examine the prognostic value of systolic blood pressure (BP) in TBI patients. We expect low BP (hypotension) to be especially risky. quantile(TBI$d.sysbpt, probs = c(.01, .25, .75, .99), na.rm = T) ## 1% 25% 75% 99% ## 92.9 121.1 142.1 171.8 TBIs &lt;- TBI[!is.na(TBI$d.sysbpt), ] # 1% 25% 75% 99% # 92.9 121.1 142.1 171.8 g1 &lt;- lrm(d.gos &lt; 2 ~ rcs(d.sysbpt, 3), data = TBIs) g2 &lt;- lrm(d.gos &lt; 3 ~ rcs(d.sysbpt, 3), data = TBIs) g3 &lt;- lrm(d.gos &lt; 4 ~ rcs(d.sysbpt, 3), data = TBIs) g4 &lt;- lrm(d.gos &lt; 5 ~ rcs(d.sysbpt, 3), data = TBIs) # Define categorical variants of systolic BP TBIs$d.sysbpt.c &lt;- as.factor(ifelse(TBIs$d.sysbpt &lt; 120, 1, ifelse(TBIs$d.sysbpt &gt; 150, 2, 0))) g1t &lt;- lrm(d.gos &lt; 2 ~ d.sysbpt.c, data = TBIs) g2t &lt;- lrm(d.gos &lt; 3 ~ d.sysbpt.c, data = TBIs) g3t &lt;- lrm(d.gos &lt; 4 ~ d.sysbpt.c, data = TBIs) g4t &lt;- lrm(d.gos &lt; 5 ~ d.sysbpt.c, data = TBIs) dd &lt;- datadist(TBIs) options(datadist = &quot;dd&quot;) # Odds ratios exp(coef(g1t)) # OR 2.78 for low BP and 1.25 for high BP ## Intercept d.sysbpt.c=1 d.sysbpt.c=2 ## 0.226 2.777 1.245 describe(TBI$d.sysbpt) ## TBI$d.sysbpt ## n missing distinct Info Mean Gmd .05 .10 .25 .50 .75 ## 2159 0 1566 1 131.4 17.61 107.0 112.2 121.1 131.3 142.1 ## .90 .95 ## 151.1 156.2 ## ## lowest : 60.0 64.2 65.6 71.3 73.7, highest: 182.9 184.2 184.7 188.3 207.4 describe(TBIs$d.sysbpt.c) ## TBIs$d.sysbpt.c ## n missing distinct ## 2159 0 3 ## ## Value 0 1 2 ## Frequency 1435 474 250 ## Proportion 0.665 0.220 0.116 # data in matrix for plot d.sysbpt &lt;- seq(60, 210, by = 1) # 151 elements g.mat &lt;- matrix(nrow = 151, ncol = 5) names(g.mat) &lt;- list(NULL, Cs(d.sysbpt, g1, g2, g3, g4)) g.mat[, 1] &lt;- d.sysbpt g.mat[, 2] &lt;- predict(g1, newdata = as.data.frame(x = d.sysbpt)) g.mat[, 3] &lt;- predict(g2, newdata = as.data.frame(x = d.sysbpt)) g.mat[, 4] &lt;- predict(g3, newdata = as.data.frame(x = d.sysbpt)) g.mat[, 5] &lt;- predict(g4, newdata = as.data.frame(x = d.sysbpt)) # Plot: Fig 9.6, part I par(mfrow = c(1, 2)) plot( x = g.mat[, 1], y = g.mat[, 2], xlim = c(50, 210), ylim = c(-2.7, 2.7), las = 1, xaxt = &quot;n&quot;, xlab = &quot;Systolic blood pressure (mmHg)&quot;, ylab = &quot;logit GOS at 6 months&quot;, cex.lab = 1.2, type = &quot;l&quot;, lwd = 2, col = mycolors[1] ) axis(1, at = c(100, 150, 200)) lines(x = g.mat[, 1], y = g.mat[, 3], lty = 2, lwd = 2, col = mycolors[2]) lines(x = g.mat[, 1], y = g.mat[, 4], lty = 3, lwd = 3, col = mycolors[3]) lines(x = g.mat[, 1], y = g.mat[, 5], lty = 4, lwd = 3, col = mycolors[4]) histSpike(x = TBI$d.sysbpt, side = 3, frac = .2, col = &quot;darkblue&quot;, add = T) legend(&quot;bottomleft&quot;, legend = c(&quot;&lt;good recovery&quot;, &quot;unfavorable&quot;, &quot;mort+veg&quot;, &quot;mortality&quot;), lty = 4:1, lwd = 2, cex = 0.8, bty = &quot;n&quot;, col = mycolors[4:1]) title(&quot;continuous, rcs 3 knots&quot;) ## Plot 9.6, part II d.sysbpt.c &lt;- c(0, 1, 2) d.sysbpt &lt;- seq(60, 210, by = .1) # 1501 elements g.mat2 &lt;- matrix(nrow = 1501, ncol = 5) g1t.c &lt;- predict(g1t, newdata = as.data.frame(x = d.sysbpt.c)) g2t.c &lt;- predict(g2t, newdata = as.data.frame(x = d.sysbpt.c)) g3t.c &lt;- predict(g3t, newdata = as.data.frame(x = d.sysbpt.c)) g4t.c &lt;- predict(g4t, newdata = as.data.frame(x = d.sysbpt.c)) names(g.mat2) &lt;- list(NULL, Cs(d.sysbpt, g1, g2, g3, g4)) g.mat2[, 1] &lt;- d.sysbpt g.mat2[, 2] &lt;- ifelse(d.sysbpt &lt; 120, g1t.c[2], ifelse(d.sysbpt &gt; 150, g1t.c[3], g1t.c[1])) g.mat2[, 3] &lt;- ifelse(d.sysbpt &lt; 120, g2t.c[2], ifelse(d.sysbpt &gt; 150, g2t.c[3], g2t.c[1])) g.mat2[, 4] &lt;- ifelse(d.sysbpt &lt; 120, g3t.c[2], ifelse(d.sysbpt &gt; 150, g3t.c[3], g3t.c[1])) g.mat2[, 5] &lt;- ifelse(d.sysbpt &lt; 120, g4t.c[2], ifelse(d.sysbpt &gt; 150, g4t.c[3], g4t.c[1])) # Plot plot( x = g.mat2[, 1], y = g.mat2[, 2], xlim = c(50, 210), ylim = c(-2.7, 2.7), las = 1, xaxt = &quot;n&quot;, xlab = &quot;Systolic blood pressure (mmHg)&quot;, ylab = &quot;&quot;, cex.lab = 1.2, type = &quot;l&quot;, lwd = 2, col = mycolors[1] ) axis(1, at = c(100, 150, 200)) lines(x = g.mat2[, 1], y = g.mat2[, 3], lty = 2, lwd = 2, col = mycolors[2]) lines(x = g.mat2[, 1], y = g.mat2[, 4], lty = 3, lwd = 3, col = mycolors[3]) lines(x = g.mat2[, 1], y = g.mat2[, 5], lty = 4, lwd = 3, col = mycolors[4]) histSpike(x = TBI$d.sysbpt, side = 3, frac = .2, col = &quot;darkblue&quot;, add = T) title(&quot;3 categories&quot;) "],["restrictions.html", "10 Restrictions on Candidate Predictors", " 10 Restrictions on Candidate Predictors Chapter 10 additional material upcoming. "],["selection.html", "11 Selection of Main Effects", " 11 Selection of Main Effects Chapter 11 additional material upcoming. "],["additivity-linearity.html", "12 Assumptions in Regression Models - Additivity and Linearity 12.1 GUSTO-I interaction analysis 12.2 MFP and other non-linear analyses in n544 data", " 12 Assumptions in Regression Models - Additivity and Linearity 12.1 GUSTO-I interaction analysis 12.1.1 Examine interactions # Import gusto, gustoB, and sample4 data sets gusto &lt;- read.csv(&quot;data/gusto1.csv&quot;) # GUSTO sample with 40830 patients gustoB &lt;- read.csv(&quot;data/gustoB.csv&quot;) # GUSTO part B sample with 20318 patients gustos &lt;- read.csv(&quot;data/sample4.csv&quot;) # GUSTO sample4 with 785 patients source(&quot;R/auc.nonpara.mw.R&quot;) source(&quot;R/ci.auc.R&quot;) source(&quot;R/val.prob.ci.2.R&quot;) # levels(gustos$HRT) &lt;- c(&quot;No tachycardia&quot;, &quot;Tachycardia&quot;) dd &lt;- datadist(gustos) ## Warning in datadist(gustos): ESAMP is constant ## Warning in datadist(gustos): GRPL is constant ## Warning in datadist(gustos): REGL is constant options(datadist = &quot;dd&quot;) Evaluate interactions with age in a full model, which includes 8 predictors in total. The data set is small (sample4, n=785, 52 events) ### Full model and age interactions full &lt;- lrm(DAY30 ~ AGE + KILLIP + HIG + DIA + HYP + HRT + TTR + SEX, data = gustos, x = T, y = T, linear.predictors = F) fullint &lt;- lrm(DAY30 ~ AGE * (KILLIP + HIG + DIA + HYP + HRT + TTR + SEX), data = gustos, x = T, y = T, linear.predictors = F) anova(fullint) ## &lt;table class=&#39;gmisc_table&#39; style=&#39;border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;&#39; &gt; ## &lt;thead&gt; ## &lt;tr&gt;&lt;td colspan=&#39;4&#39; style=&#39;text-align: left;&#39;&gt; ## Wald Statistics for &lt;code style=&quot;font-size:0.8em&quot;&gt;DAY30&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt; ## &lt;tr&gt;&lt;th style=&#39;border-bottom: 1px solid grey; font-weight: 900; border-top: 2px solid grey; text-align: center;&#39;&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;χ&lt;sup&gt;2&lt;/sup&gt;&lt;/i&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;d.f.&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;P&lt;/i&gt;&lt;/th&gt; ## &lt;/tr&gt; ## &lt;/thead&gt; ## &lt;tbody&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;AGE (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;29.93&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 8&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.0002&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt; &lt;i&gt;All Interactions&lt;/i&gt;&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;11.01&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 7&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.1380&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;KILLIP (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 4.96&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 2&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.0839&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt; &lt;i&gt;All Interactions&lt;/i&gt;&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1.01&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.3160&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;HIG (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 6.32&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 2&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.0424&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt; &lt;i&gt;All Interactions&lt;/i&gt;&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 2.20&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.1380&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;DIA (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 3.70&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 2&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.1571&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt; &lt;i&gt;All Interactions&lt;/i&gt;&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 0.64&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.4220&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;HYP (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 5.62&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 2&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.0603&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt; &lt;i&gt;All Interactions&lt;/i&gt;&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1.46&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.2267&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;HRT (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;13.50&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 2&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.0012&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt; &lt;i&gt;All Interactions&lt;/i&gt;&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 4.49&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.0341&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;TTR (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 8.31&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 2&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.0157&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt; &lt;i&gt;All Interactions&lt;/i&gt;&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 2.80&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.0942&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;SEX (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 0.79&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 2&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.6736&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt; &lt;i&gt;All Interactions&lt;/i&gt;&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 0.42&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.5151&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;AGE × KILLIP (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1.01&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.3160&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;AGE × HIG (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 2.20&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.1380&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;AGE × DIA (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 0.64&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.4220&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;AGE × HYP (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1.46&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.2267&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;AGE × HRT (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 4.49&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.0341&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;AGE × TTR (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 2.80&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.0942&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;AGE × SEX (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 0.42&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.5151&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;TOTAL INTERACTION&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;11.01&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 7&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.1380&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;border-bottom: 2px solid grey; text-align: left;&#39;&gt;TOTAL&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;64.59&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;15&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;/tbody&gt; ## &lt;/table&gt; ### Select only interaction AGE * HRT fullints &lt;- lrm(DAY30 ~ AGE + KILLIP + HIG + DIA + HYP + HRT + TTR + SEX + AGE * HRT, data = gustos, x = T, y = T, linear.predictors = T) anova(fullints) ## &lt;table class=&#39;gmisc_table&#39; style=&#39;border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;&#39; &gt; ## &lt;thead&gt; ## &lt;tr&gt;&lt;td colspan=&#39;4&#39; style=&#39;text-align: left;&#39;&gt; ## Wald Statistics for &lt;code style=&quot;font-size:0.8em&quot;&gt;DAY30&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt; ## &lt;tr&gt;&lt;th style=&#39;border-bottom: 1px solid grey; font-weight: 900; border-top: 2px solid grey; text-align: center;&#39;&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;χ&lt;sup&gt;2&lt;/sup&gt;&lt;/i&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;d.f.&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;&lt;i&gt;P&lt;/i&gt;&lt;/th&gt; ## &lt;/tr&gt; ## &lt;/thead&gt; ## &lt;tbody&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;AGE (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;26.67&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;2&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt; &lt;i&gt;All Interactions&lt;/i&gt;&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 2.70&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.1004&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;KILLIP&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 3.52&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.0605&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;HIG&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 5.38&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.0204&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;DIA&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 3.14&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.0763&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;HYP&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 3.49&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.0618&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;HRT (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;11.67&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;2&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.0029&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt; &lt;i&gt;All Interactions&lt;/i&gt;&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 2.70&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.1004&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;TTR&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 5.66&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.0174&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;SEX&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 0.19&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.6602&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;text-align: left;&#39;&gt;AGE × HRT (Factor+Higher Order Factors)&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt; 2.70&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;1&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; text-align: right;&#39;&gt;0.1004&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;border-bottom: 2px solid grey; text-align: left;&#39;&gt;TOTAL&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;65.30&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;9&lt;/td&gt; ## &lt;td style=&#39;padding-left:3ex; border-bottom: 2px solid grey; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;/tbody&gt; ## &lt;/table&gt; 12.1.2 Fig 12.1 Make 2 plots with linear interaction, in the small n=785 sample, and in the full n=40830 sample 12.1.3 Fig 12.2 Make 4 plots with main effects, linear interaction, and 2 variants of interaction only above age 55. The variable is (Age-55)[+]. In the last graph, the green dotted line follows the angle from below age 55 years (only 1 Age effect is estimated for the HRT==0 and HRT==1 and age&lt;55 patients). In the pre-final graph, there are 2 separate angles from age 55 for HRT==0 and HRT==1 (barely noticable for the green dotted line). 12.1.4 Smart coding illustration Smart coding of age effect: separate for no HRT (HRT==0) and for HRT (HRT==1) # Smart coding of age effect: separate for no HRT (HRT==0) and for HRT (HRT==1) gustos$AGE0 &lt;- gustos$AGE * (1 - gustos$HRT) gustos$AGE1 &lt;- gustos$AGE * gustos$HRT # Standard lrm(DAY30 ~ AGE + KILLIP + HIG + DIA + HYP + HRT + TTR + SEX + AGE * HRT, data = gustos, x = T, y = T, linear.predictors = F) ## ## &lt;strong&gt;Logistic Regression Model&lt;/strong&gt; ## ## &lt;pre&gt; ## lrm(formula = DAY30 ~ AGE + KILLIP + HIG + DIA + HYP + HRT + ## TTR + SEX + AGE * HRT, data = gustos, x = T, y = T, linear.predictors = F) ## &lt;/pre&gt; ## ## &lt;table class=&#39;gmisc_table&#39; style=&#39;border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;&#39; &gt; ## &lt;thead&gt; ## &lt;tr&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-left: 1px solid black; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black; text-align: center;&#39;&gt;Model Likelihood&lt;br&gt;Ratio Test&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black; text-align: center;&#39;&gt;Discrimination&lt;br&gt;Indexes&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black; text-align: center;&#39;&gt;Rank Discrim.&lt;br&gt;Indexes&lt;/th&gt; ## &lt;/tr&gt; ## &lt;/thead&gt; ## &lt;tbody&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;&#39;&gt;Obs 785&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;LR χ&lt;sup&gt;2&lt;/sup&gt; 86.28&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;i&gt;R&lt;/i&gt;&lt;sup&gt;2&lt;/sup&gt; 0.270&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;i&gt;C&lt;/i&gt; 0.831&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;&#39;&gt; 0 733&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;d.f. 9&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;i&gt;R&lt;/i&gt;&lt;sup&gt;&lt;span style=&#39;font-size: 70%;&#39;&gt;2&lt;/span&gt;&lt;/sup&gt;&lt;sub style=&#39;position: relative; left: -.47em; bottom: -.4em;&#39;&gt;&lt;span style=&#39;font-size: 70%;&#39;&gt;9,785&lt;/span&gt;&lt;/sub&gt; 0.094&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;i&gt;D&lt;/i&gt;&lt;sub&gt;xy&lt;/sub&gt; 0.662&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;&#39;&gt; 1 52&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;Pr(&gt;χ&lt;sup&gt;2&lt;/sup&gt;) &lt;0.0001&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;i&gt;R&lt;/i&gt;&lt;sup&gt;&lt;span style=&#39;font-size: 70%;&#39;&gt;2&lt;/span&gt;&lt;/sup&gt;&lt;sub style=&#39;position: relative; left: -.47em; bottom: -.4em;&#39;&gt;&lt;span style=&#39;font-size: 70%;&#39;&gt;9,145.7&lt;/span&gt;&lt;/sub&gt; 0.412&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;γ 0.662&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 9em; border-bottom: 2px solid grey; border-left: 1px solid black; border-right: 1px solid black; text-align: center;&#39;&gt;max |∂log &lt;i&gt;L&lt;/i&gt;/∂β| 1×10&lt;sup&gt;-9&lt;/sup&gt;&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black; text-align: center;&#39;&gt;Brier 0.051&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black; text-align: center;&#39;&gt;τ&lt;sub&gt;a&lt;/sub&gt; 0.082&lt;/td&gt; ## &lt;/tr&gt; ## &lt;/tbody&gt; ## &lt;/table&gt; ## ## ## &lt;table class=&#39;gmisc_table&#39; style=&#39;border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;&#39; &gt; ## &lt;thead&gt; ## &lt;tr&gt;&lt;th style=&#39;border-bottom: 1px solid grey; font-weight: 900; border-top: 2px solid grey; min-width: 7em; text-align: center;&#39;&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;β&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;S.E.&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;Wald &lt;i&gt;Z&lt;/i&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;Pr(&gt;|&lt;i&gt;Z&lt;/i&gt;|)&lt;/th&gt; ## &lt;/tr&gt; ## &lt;/thead&gt; ## &lt;tbody&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;Intercept&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; -9.7431&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 1.6574&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;-5.88&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;AGE&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  0.0759&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.0240&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 3.16&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.0016&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;KILLIP&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  0.4595&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.2448&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 1.88&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.0605&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;HIG&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  0.7900&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.3407&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 2.32&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.0204&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;DIA&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  0.7804&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.4403&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 1.77&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.0763&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;HYP&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  1.0403&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.5570&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 1.87&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.0618&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;HRT&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; -3.6376&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 2.8352&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;-1.28&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.1995&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;TTR&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  0.8201&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.3447&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 2.38&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.0174&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;SEX&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; -0.1534&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.3490&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;-0.44&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.6602&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; border-bottom: 2px solid grey; text-align: left;&#39;&gt;AGE × HRT&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; border-bottom: 2px solid grey; text-align: right;&#39;&gt;  0.0655&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; border-bottom: 2px solid grey; text-align: right;&#39;&gt; 0.0399&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; border-bottom: 2px solid grey; text-align: right;&#39;&gt; 1.64&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; border-bottom: 2px solid grey; text-align: right;&#39;&gt;0.1004&lt;/td&gt; ## &lt;/tr&gt; ## &lt;/tbody&gt; ## &lt;/table&gt; # Smart coding lrm(DAY30 ~ AGE0 + AGE1 + HRT + KILLIP + HIG + DIA + HYP + TTR + SEX, data = gustos, x = T, y = T, linear.predictors = F) ## ## &lt;strong&gt;Logistic Regression Model&lt;/strong&gt; ## ## &lt;pre&gt; ## lrm(formula = DAY30 ~ AGE0 + AGE1 + HRT + KILLIP + HIG + DIA + ## HYP + TTR + SEX, data = gustos, x = T, y = T, linear.predictors = F) ## &lt;/pre&gt; ## ## &lt;table class=&#39;gmisc_table&#39; style=&#39;border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;&#39; &gt; ## &lt;thead&gt; ## &lt;tr&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-left: 1px solid black; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black; text-align: center;&#39;&gt;Model Likelihood&lt;br&gt;Ratio Test&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black; text-align: center;&#39;&gt;Discrimination&lt;br&gt;Indexes&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black; text-align: center;&#39;&gt;Rank Discrim.&lt;br&gt;Indexes&lt;/th&gt; ## &lt;/tr&gt; ## &lt;/thead&gt; ## &lt;tbody&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;&#39;&gt;Obs 785&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;LR χ&lt;sup&gt;2&lt;/sup&gt; 86.28&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;i&gt;R&lt;/i&gt;&lt;sup&gt;2&lt;/sup&gt; 0.270&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;i&gt;C&lt;/i&gt; 0.831&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;&#39;&gt; 0 733&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;d.f. 9&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;i&gt;R&lt;/i&gt;&lt;sup&gt;&lt;span style=&#39;font-size: 70%;&#39;&gt;2&lt;/span&gt;&lt;/sup&gt;&lt;sub style=&#39;position: relative; left: -.47em; bottom: -.4em;&#39;&gt;&lt;span style=&#39;font-size: 70%;&#39;&gt;9,785&lt;/span&gt;&lt;/sub&gt; 0.094&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;i&gt;D&lt;/i&gt;&lt;sub&gt;xy&lt;/sub&gt; 0.662&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;&#39;&gt; 1 52&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;Pr(&gt;χ&lt;sup&gt;2&lt;/sup&gt;) &lt;0.0001&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;i&gt;R&lt;/i&gt;&lt;sup&gt;&lt;span style=&#39;font-size: 70%;&#39;&gt;2&lt;/span&gt;&lt;/sup&gt;&lt;sub style=&#39;position: relative; left: -.47em; bottom: -.4em;&#39;&gt;&lt;span style=&#39;font-size: 70%;&#39;&gt;9,145.7&lt;/span&gt;&lt;/sub&gt; 0.412&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;γ 0.662&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 9em; border-bottom: 2px solid grey; border-left: 1px solid black; border-right: 1px solid black; text-align: center;&#39;&gt;max |∂log &lt;i&gt;L&lt;/i&gt;/∂β| 1×10&lt;sup&gt;-9&lt;/sup&gt;&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black; text-align: center;&#39;&gt;Brier 0.051&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black; text-align: center;&#39;&gt;τ&lt;sub&gt;a&lt;/sub&gt; 0.082&lt;/td&gt; ## &lt;/tr&gt; ## &lt;/tbody&gt; ## &lt;/table&gt; ## ## ## &lt;table class=&#39;gmisc_table&#39; style=&#39;border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;&#39; &gt; ## &lt;thead&gt; ## &lt;tr&gt;&lt;th style=&#39;border-bottom: 1px solid grey; font-weight: 900; border-top: 2px solid grey; min-width: 7em; text-align: center;&#39;&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;β&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;S.E.&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;Wald &lt;i&gt;Z&lt;/i&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;Pr(&gt;|&lt;i&gt;Z&lt;/i&gt;|)&lt;/th&gt; ## &lt;/tr&gt; ## &lt;/thead&gt; ## &lt;tbody&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;Intercept&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; -9.7431&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 1.6574&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;-5.88&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;AGE0&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  0.0759&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.0240&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 3.16&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.0016&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;AGE1&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  0.1414&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.0332&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 4.26&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;HRT&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; -3.6376&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 2.8352&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;-1.28&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.1995&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;KILLIP&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  0.4595&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.2448&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 1.88&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.0605&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;HIG&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  0.7900&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.3407&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 2.32&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.0204&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;DIA&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  0.7804&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.4403&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 1.77&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.0763&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;HYP&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  1.0403&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.5570&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 1.87&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.0618&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;TTR&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  0.8201&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.3447&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 2.38&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.0174&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; border-bottom: 2px solid grey; text-align: left;&#39;&gt;SEX&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; border-bottom: 2px solid grey; text-align: right;&#39;&gt; -0.1534&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; border-bottom: 2px solid grey; text-align: right;&#39;&gt; 0.3490&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; border-bottom: 2px solid grey; text-align: right;&#39;&gt;-0.44&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; border-bottom: 2px solid grey; text-align: right;&#39;&gt;0.6602&lt;/td&gt; ## &lt;/tr&gt; ## &lt;/tbody&gt; ## &lt;/table&gt; # Identical fit, easier interpretation # Age 55 as reference for HRT effect gustos$AGE0 &lt;- (gustos$AGE - 55) * (1 - gustos$HRT) gustos$AGE1 &lt;- (gustos$AGE - 55) * gustos$HRT lrm(DAY30 ~ AGE0 + AGE1 + HRT + KILLIP + HIG + DIA + HYP + TTR + SEX, data = gustos, x = T, y = T, linear.predictors = F) ## ## &lt;strong&gt;Logistic Regression Model&lt;/strong&gt; ## ## &lt;pre&gt; ## lrm(formula = DAY30 ~ AGE0 + AGE1 + HRT + KILLIP + HIG + DIA + ## HYP + TTR + SEX, data = gustos, x = T, y = T, linear.predictors = F) ## &lt;/pre&gt; ## ## &lt;table class=&#39;gmisc_table&#39; style=&#39;border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;&#39; &gt; ## &lt;thead&gt; ## &lt;tr&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-left: 1px solid black; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black; text-align: center;&#39;&gt;Model Likelihood&lt;br&gt;Ratio Test&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black; text-align: center;&#39;&gt;Discrimination&lt;br&gt;Indexes&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black; text-align: center;&#39;&gt;Rank Discrim.&lt;br&gt;Indexes&lt;/th&gt; ## &lt;/tr&gt; ## &lt;/thead&gt; ## &lt;tbody&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;&#39;&gt;Obs 785&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;LR χ&lt;sup&gt;2&lt;/sup&gt; 86.28&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;i&gt;R&lt;/i&gt;&lt;sup&gt;2&lt;/sup&gt; 0.270&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;i&gt;C&lt;/i&gt; 0.831&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;&#39;&gt; 0 733&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;d.f. 9&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;i&gt;R&lt;/i&gt;&lt;sup&gt;&lt;span style=&#39;font-size: 70%;&#39;&gt;2&lt;/span&gt;&lt;/sup&gt;&lt;sub style=&#39;position: relative; left: -.47em; bottom: -.4em;&#39;&gt;&lt;span style=&#39;font-size: 70%;&#39;&gt;9,785&lt;/span&gt;&lt;/sub&gt; 0.094&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;i&gt;D&lt;/i&gt;&lt;sub&gt;xy&lt;/sub&gt; 0.662&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;&#39;&gt; 1 52&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;Pr(&gt;χ&lt;sup&gt;2&lt;/sup&gt;) &lt;0.0001&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;i&gt;R&lt;/i&gt;&lt;sup&gt;&lt;span style=&#39;font-size: 70%;&#39;&gt;2&lt;/span&gt;&lt;/sup&gt;&lt;sub style=&#39;position: relative; left: -.47em; bottom: -.4em;&#39;&gt;&lt;span style=&#39;font-size: 70%;&#39;&gt;9,145.7&lt;/span&gt;&lt;/sub&gt; 0.412&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-right: 1px solid black; text-align: center;&#39;&gt;γ 0.662&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 9em; border-bottom: 2px solid grey; border-left: 1px solid black; border-right: 1px solid black; text-align: center;&#39;&gt;max |∂log &lt;i&gt;L&lt;/i&gt;/∂β| 4×10&lt;sup&gt;-11&lt;/sup&gt;&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black; text-align: center;&#39;&gt;&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black; text-align: center;&#39;&gt;Brier 0.051&lt;/td&gt; ## &lt;td style=&#39;min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black; text-align: center;&#39;&gt;τ&lt;sub&gt;a&lt;/sub&gt; 0.082&lt;/td&gt; ## &lt;/tr&gt; ## &lt;/tbody&gt; ## &lt;/table&gt; ## ## ## &lt;table class=&#39;gmisc_table&#39; style=&#39;border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;&#39; &gt; ## &lt;thead&gt; ## &lt;tr&gt;&lt;th style=&#39;border-bottom: 1px solid grey; font-weight: 900; border-top: 2px solid grey; min-width: 7em; text-align: center;&#39;&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;β&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;S.E.&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;Wald &lt;i&gt;Z&lt;/i&gt;&lt;/th&gt; ## &lt;th style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;&#39;&gt;Pr(&gt;|&lt;i&gt;Z&lt;/i&gt;|)&lt;/th&gt; ## &lt;/tr&gt; ## &lt;/thead&gt; ## &lt;tbody&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;Intercept&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; -5.5703&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.5746&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;-9.69&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;AGE0&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  0.0759&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.0240&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 3.16&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.0016&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;AGE1&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  0.1414&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.0332&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 4.26&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;&lt;0.0001&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;HRT&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; -0.0333&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.7043&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;-0.05&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.9623&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;KILLIP&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  0.4595&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.2448&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 1.88&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.0605&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;HIG&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  0.7900&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.3407&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 2.32&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.0204&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;DIA&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  0.7804&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.4403&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 1.77&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.0763&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;HYP&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  1.0403&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.5570&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 1.87&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.0618&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; text-align: left;&#39;&gt;TTR&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;  0.8201&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 0.3447&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt; 2.38&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; text-align: right;&#39;&gt;0.0174&lt;/td&gt; ## &lt;/tr&gt; ## &lt;tr&gt; ## &lt;td style=&#39;min-width: 7em; border-bottom: 2px solid grey; text-align: left;&#39;&gt;SEX&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; border-bottom: 2px solid grey; text-align: right;&#39;&gt; -0.1534&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; border-bottom: 2px solid grey; text-align: right;&#39;&gt; 0.3490&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; border-bottom: 2px solid grey; text-align: right;&#39;&gt;-0.44&lt;/td&gt; ## &lt;td style=&#39;min-width: 7em; border-bottom: 2px solid grey; text-align: right;&#39;&gt;0.6602&lt;/td&gt; ## &lt;/tr&gt; ## &lt;/tbody&gt; ## &lt;/table&gt; # Even nicer interpretation, HRT effect for age=55 The fit of each of the models is identical (always LR chi2=86.28); each model allows for linear interaction between AGE and HRT. The interpretation of the model is easier if the age effects are estimated for HRT==1 and for HRT==0. Scaling is easier by subtracting 55 from AGE (AGE-55); this implies the HRT effect relates to age 55. 12.1.5 Table 12.2 Better predictions? Assess the performance if the models created in n=785 in an independent validation part, GustoB, n=20318. Plots created with a modification of Frank Harrell’s val.prob() function: # Validate in independent part, named gustoB # main effects lrm.val.full &lt;- predict(full, newdata = gustoB, type = &quot;lp&quot;) # simple interaction lrm.val.int1 &lt;- predict(fullints, newdata = gustoB, type = &quot;lp&quot;) # Plot val.prob.ci.2( y = gustoB[, &quot;DAY30&quot;], logit = lrm.val.full, riskdist = &quot;predicted&quot;, logistic.cal = F, smooth = &quot;rcs&quot;, nr.knots = 3, g = 8, xlim = c(0, .5), ylim = c(0, .5), legendloc = c(0.18, 0.15), statloc = c(0, .4), roundstats = 3, xlab = &quot;Predicted probability from n=785&quot;, ylab = &quot;Observed proportion in n=20318&quot; ) Conclusions Discrimination: worse with interactions than without. Calibration: We note some overfitting, as expected by a fit in a small sample. 12.2 MFP and other non-linear analyses in n544 data Upcoming. "],["estimation.html", "13 Modern Estimation Methods", " 13 Modern Estimation Methods Chapter 13 additional material upcoming. "],["estimation-external.html", "14 Estimation with External Information", " 14 Estimation with External Information Chapter 14 additional material upcoming. "],["evaluation.html", "15 Evaluation of Performance", " 15 Evaluation of Performance Chapter 15 additional material upcoming. "],["usefulness.html", "16 Evaluation of Clinical Usefulness", " 16 Evaluation of Clinical Usefulness Chapter 16 additional material upcoming. "],["validation.html", "17 Validation of Prediction Models", " 17 Validation of Prediction Models Chapter 17 additional material upcoming. "],["presentation.html", "18 Presentation Formats 18.1 Fit logistic models in n544 data set; 6 predictors Fig 18.1 18.2 Scores for continuous predictors Table 18.2 Fig 18.2 End Table 18.2 (score chart) and Fig 18.2 (graphic translation from score to probability) Table 18.3 Fig 18.3 Fig 18.4 Apparent performance of penalized vs rescaled vs simplified models", " 18 Presentation Formats 18.1 Fit logistic models in n544 data set; 6 predictors We develop a prediction model with 6 predictors for presence of residual tumor in 544 men treated for metastatic nonseminomatous testicular cancer. Predictors were pre-specified based on review of the medical literature. We first consider and full model and 2 shrinkage variants: uniform shrinkage and a penalized model. We then study various formats for presentation of the prediction model for application in medical practice. The formats differ in user-friendliness and accuracy: for some simplifications we sacrifice nearly nothing and for other a lot in terms of c statistic. The formats are: nomogram (Fig 18.1) score chart (Table 18.2 and Fig 18.2) simple table (Table 18.3) iso-probability lines (Fig 18.3) tree on a meta-model (Fig 18.4) # Fit a full 6 predictor model in n544 options(prType=&#39;html&#39;) html(describe(n544), scroll=TRUE) .earrows {color:silver;font-size:11px;} fcap { font-family: Verdana; font-size: 12px; color: MidnightBlue } smg { font-family: Verdana; font-size: 10px; color: &#808080; } hr.thinhr { margin-top: 0.15em; margin-bottom: 0.15em; } span.xscript { position: relative; } span.xscript sub { position: absolute; left: 0.1em; bottom: -1ex; } n544 Descriptives n544 11 Variables 544 Observations Teratoma .hmisctable329073 { border: none; font-size: 85%; } .hmisctable329073 td { text-align: center; padding: 0 1ex 0 1ex; } .hmisctable329073 th { color: MidnightBlue; text-align: center; padding: 0 1ex 0 1ex; font-weight: normal; } nmissingdistinctInfoSumMeanGmd 544020.7462520.46320.4982 Pre.AFP .hmisctable790984 { border: none; font-size: 85%; } .hmisctable790984 td { text-align: center; padding: 0 1ex 0 1ex; } .hmisctable790984 th { color: MidnightBlue; text-align: center; padding: 0 1ex 0 1ex; font-weight: normal; } nmissingdistinctInfoSumMeanGmd 544020.6751860.34190.4508 Pre.HCG .hmisctable657861 { border: none; font-size: 85%; } .hmisctable657861 td { text-align: center; padding: 0 1ex 0 1ex; } .hmisctable657861 th { color: MidnightBlue; text-align: center; padding: 0 1ex 0 1ex; font-weight: normal; } nmissingdistinctInfoSumMeanGmd 544020.7042050.37680.4705 Pre.lnLDH n missing distinct Info Mean Gmd .05 .10 .25 544 0 472 1 0.4582 0.7327 -0.38735 -0.26645 -0.03266 .50 .75 .90 .95 0.31299 0.92886 1.33528 1.65328 lowest : -1.066 -0.948 -0.767 -0.731 -0.565 , highest: 2.428 2.449 2.487 2.624 2.766 sqpost .hmisctable328706 { border: none; font-size: 74%; } .hmisctable328706 td { text-align: center; padding: 0 1ex 0 1ex; } .hmisctable328706 th { color: MidnightBlue; text-align: center; padding: 0 1ex 0 1ex; font-weight: normal; } nmissingdistinctInfoMeanGmd.05.10.25.50.75.90.95 5440930.9965.1332.922 1.414 2.236 3.162 4.472 6.652 9.66910.000 lowest : 1.41 1.73 2.00 2.05 2.24 , highest: 10.95 12.25 13.04 13.78 17.32 reduc10 .hmisctable209497 { border: none; font-size: 74%; } .hmisctable209497 td { text-align: center; padding: 0 1ex 0 1ex; } .hmisctable209497 th { color: MidnightBlue; text-align: center; padding: 0 1ex 0 1ex; font-weight: normal; } nmissingdistinctInfoMeanGmd.05.10.25.50.75.90.95 54402000.9984.4824.307-2.500 0.000 2.000 5.167 7.337 8.78510.000 lowest : -13.81 -10.00 -8.33 -8.11 -6.00 , highest: 9.12 9.17 9.29 9.33 10.00 Necrosis .hmisctable621346 { border: none; font-size: 85%; } .hmisctable621346 td { text-align: center; padding: 0 1ex 0 1ex; } .hmisctable621346 th { color: MidnightBlue; text-align: center; padding: 0 1ex 0 1ex; font-weight: normal; } nmissingdistinctInfoSumMeanGmd 544020.7432450.45040.496 Tumor .hmisctable190644 { border: none; font-size: 85%; } .hmisctable190644 td { text-align: center; padding: 0 1ex 0 1ex; } .hmisctable190644 th { color: MidnightBlue; text-align: center; padding: 0 1ex 0 1ex; font-weight: normal; } nmissingdistinctInfoSumMeanGmd 544020.7432990.54960.496 Reduction .hmisctable662852 { border: none; font-size: 74%; } .hmisctable662852 td { text-align: center; padding: 0 1ex 0 1ex; } .hmisctable662852 th { color: MidnightBlue; text-align: center; padding: 0 1ex 0 1ex; font-weight: normal; } nmissingdistinctInfoMeanGmd.05.10.25.50.75.90.95 54402000.99844.8243.07-25.00 0.00 20.00 51.67 73.37 87.85100.00 lowest : -138.1 -100.0 -83.3 -81.1 -60.0 , highest: 91.2 91.7 92.9 93.3 100.0 LDHst .hmisctable309158 { border: none; font-size: 74%; } .hmisctable309158 td { text-align: center; padding: 0 1ex 0 1ex; } .hmisctable309158 th { color: MidnightBlue; text-align: center; padding: 0 1ex 0 1ex; font-weight: normal; } nmissingdistinctInfoMeanGmd.05.10.25.50.75.90.95 544047212.031.6050.67890.76610.96791.36752.53173.80145.2242 lowest : 0.344 0.388 0.464 0.481 0.568 , highest: 11.338 11.581 12.026 13.787 15.891 Post.size .hmisctable325310 { border: none; font-size: 74%; } .hmisctable325310 td { text-align: center; padding: 0 1ex 0 1ex; } .hmisctable325310 th { color: MidnightBlue; text-align: center; padding: 0 1ex 0 1ex; font-weight: normal; } nmissingdistinctInfoMeanGmd.05.10.25.50.75.90.95 5440930.99633.2633.37 2.00 5.00 10.00 20.00 44.25 93.50100.00 lowest : 2.00 3.00 4.00 4.22 5.00 , highest: 120.00 150.00 170.00 190.00 300.00 # Start the fitting of 3 models set.seed(1) full &lt;- lrm(Necrosis ~ Teratoma+Pre.AFP+Pre.HCG+log(LDHst)+sqrt(Post.size)+Reduction, data=n544,x=T,y=T,linear.predictors=T) print(full) Logistic Regression Model lrm(formula = Necrosis ~ Teratoma + Pre.AFP + Pre.HCG + log(LDHst) + sqrt(Post.size) + Reduction, data = n544, x = T, y = T, linear.predictors = T) Model LikelihoodRatio Test DiscriminationIndexes Rank Discrim.Indexes Obs 544 LR χ2 211.56 R2 0.431 C 0.839 0 299 d.f. 6 R26,544 0.315 Dxy 0.677 1 245 Pr(>χ2) R26,404 0.399 γ 0.678 max |∂log L/∂β| 1×10-7 Brier 0.163 τa 0.336 β S.E. Wald Z Pr(>|Z|) Intercept  -1.0425  0.6086 -1.71 0.0867 Teratoma   0.9094  0.2140 4.25 Pre.AFP   0.9025  0.2333 3.87 0.0001 Pre.HCG   0.7827  0.2305 3.40 0.0007 LDHst   0.9854  0.2089 4.72 Post.size  -0.2915  0.0815 -3.58 0.0003 Reduction   0.0158  0.0052 3.04 0.0024 18.1.1 Internal validation by bootstrapping ## Validate model with bootstrapping set.seed(1) val.full &lt;- validate(full, B=100) val.full[1,c(1:3,5) ] &lt;- val.full[1,c(1:3,5) ]/2 + 0.5 # transform Dxy to C val.full[1,4 ] &lt;- val.full[1,4]/2 # optimism in c rownames(val.full)[1] &lt;- &quot;C&quot; kable(as.data.frame(val.full[1:4,]), digits=3) %&gt;% kable_styling(full_width=F, position = &quot;left&quot;) index.orig training test optimism index.corrected n C 0.839 0.839 0.835 0.004 0.835 100 R2 0.431 0.434 0.423 0.011 0.420 100 Intercept 0.000 0.000 0.000 0.000 0.000 100 Slope 1.000 1.000 0.978 0.022 0.978 100 So, limited optimism in c index (Dxy/2+0.5): 0.004. And limited need for shrinkage, since the calibration slope is close to 1: 0.98. For illustration, we consider 2 shrinkage approaches: 1. shrink coefficients with a uniform factor (from bootstrap validation (or by a heuristic formula as described by Copas 1983 and Van Houwelingen 1990 ). 2. penalize coefficients with a penalty factor as estimated by the optimal AIC in the pentrace function. Empirical comparisons between shrinkage apporaches are here: Steyerberg 2000. A recent study compared the stability of shrinkage estimators: Van Calster 2020. 18.1.2 Shrunk model and penalization # Apply linear shrinkage full.shrunk &lt;- full full.shrunk$coef &lt;- val.full[4,5] * full.shrunk$coef # use result from bootstrapping # val.full[4,5] is shrinkage factor; heuristic estimate (LR - df) / LR = (211-6)/211=0.97 # Estimate new intercept, with shrunk lp as offset variable, i.e. coef fixed at unity full.shrunk$coef[1] &lt;- lrm.fit(y=full$y, offset= full$x %*% full.shrunk$coef[2:7])$coef[1] # Make a penalized model with pentrace function p &lt;- pentrace(full, c(0,1,2,3,4,5,6,7,8,10,12,14,20)) plot(p, which=&#39;aic.c&#39;, xlim=c(0,15), ylim=c(196,201)) lines(x=c(4,4), y=c(196, 1000)) The optimal penalty factor is 4. Let’s update the full model fit with this penalty term. 18.1.3 Fit penalized model and compare fits full.pen &lt;- update(full, penalty=p$penalty) ## compare coefs of 3 model variants fit.coefs &lt;- cbind(full=full$coefficients, shrunk=full.shrunk$coef, penalized=full.pen$coefficients) kable(as.data.frame(fit.coefs, digits=3)) %&gt;% kable_styling(full_width=F, position = &quot;left&quot;) full shrunk penalized Intercept -1.042 -1.021 -1.090 Teratoma 0.909 0.890 0.873 Pre.AFP 0.903 0.883 0.860 Pre.HCG 0.783 0.766 0.729 LDHst 0.985 0.964 0.884 Post.size -0.292 -0.285 -0.261 Reduction 0.016 0.015 0.016 Fig 18.1 18.1.4 Make nomogram from penalized model par(mfrow=c(1,1), mar=c(1,1,4,.5)) # Need some stats for the data to plot nomogram dd &lt;- datadist(n544) options(datadist=&quot;dd&quot;) nom &lt;- nomogram(full.pen, fun=c(function(x)(1-plogis(x)), plogis), lp=T,lp.at=c(-2,-1,0,1,2,3), LDHst=c(.5,1,1.5,2,3), Post.size=c(50,20,10,5,2), Reduction=c(0,35,70,100), fun.at=c(seq(.1,.9,by=.1),0.95), funlabel=c(&quot;p(residual tumor)&quot;, &quot;p(necrosis)&quot;), vnames=&quot;lab&quot;, maxscale=10) plot(nom) title(&quot;Testicular cancer prediction model: risk of residual tumor&quot;) So, we have a nice presentation that allows for assessing the relative importance of predictors (by length of the lines), and allows for precise estimates of risks of residual tumor (and its complement, necrosis, benign tissue). Instruction to physicians using the model in their care: Determine the patient’s value for each predictor, and draw a straight line upward to the points axis to determine how many points toward benign histology the patient receives. Sum the points received for each predictor and locate this sum on the total points axis. Draw a straight line down to find the patient’s predicted probability of residual tumor or necrosis (benign histology). Instruction to patient: “Mr. X, if we had 100 men exactly like you, we would expect that the chemotherapy was fully successful in approximately &lt;predicted probability from nomogram * 100&gt;, as reflected in fully benign disease at surgical resection of your abdominal lymph nodes.” see Kattan et al. Note that the number 100 may be debated, since the effective sample size for some covariate patterns may be far less. 18.1.5 Score chart creation with categorized and continuous predictors We first search for some nice rounding of logistic regression coefficients. A classic approach is multiplying by 10. We find that multiplying by 10/8, or 1.25 works well. We then continue with searching for a similarly nice scoring for continuous predictors. This is a trial and error process, supported by graphical illustrations. 18.1.6 Consider making rounded scores from penalized coefs scores &lt;- matrix(nrow=10, ncol=length(full.pen$coefficients), dimnames = list(NULL, c(&quot;Multiplier&quot;, names(full.pen$coefficients[-1])))) for (i in 1:10) { scores[i,] &lt;- c(10/i, round(full.pen$coefficients[-1] * 10 / i)) } # consider a range of multipliers kable(as.data.frame(scores, digits=3)) %&gt;% kable_styling(full_width=F, position = &quot;left&quot;) Multiplier Teratoma Pre.AFP Pre.HCG LDHst Post.size Reduction 10.00 9 9 7 9 -3 0 5.00 4 4 4 4 -1 0 3.33 3 3 2 3 -1 0 2.50 2 2 2 2 -1 0 2.00 2 2 1 2 -1 0 1.67 1 1 1 1 0 0 1.43 1 1 1 1 0 0 1.25 1 1 1 1 0 0 1.11 1 1 1 1 0 0 1.00 1 1 1 1 0 0 # rounded scores kable(as.data.frame(rbind(mult10=round(10*full.pen$coef[-1]), mult1.25 =round(10/8*full.pen$coef[-1]))), digits=3) %&gt;% kable_styling(full_width=F, position = &quot;left&quot;) Teratoma Pre.AFP Pre.HCG LDHst Post.size Reduction mult10 9 9 7 9 -3 0 mult1.25 1 1 1 1 0 0 So, we like the multiplier of 10/8, or 1.25. Let’s search for the mapping of coefficients of continuous predictors on nice scores as well. 18.2 Scores for continuous predictors 18.2.1 LDH Start with LDH, where we use the log scale for standardized LDH values. We could e.g. find: 1 point per ln, so 1 point per 2.7 times normal. We use a score of 10/8 for LDH in a plot. We add reference lines for point allocation. par(mfrow=c(1,1), mar=c(4,4,2,2)) # Use score of 10/8 for LDH, plot score by LDHst LDHplot &lt;- as.data.frame(cbind(n544$LDHst, round(10/8*full.pen$coef[5]*n544$Pre.lnLDH,1))) plot(x=LDHplot[,1], y=LDHplot[,2], xlab=&quot;LDHst (LDH / upper limit of normal LDH)&quot;, ylab=&quot;Rounded score&quot;, axes=F, xlim=c(.5,6.9), ylim=c(-.6,2.2), cex.lab=1.2, main = &quot;LDH&quot;) scat1d(x=n544$LDHst, side=1, col=&quot;red&quot;, lwd=2) axis(side=1, at=c(.5,1,1.5,2,2.5,3,4,5,6,7)) axis(side=2, at=c(-.5, 0,.5,1,1.5,2)) # horizontal reference lines abline(a=0, b=0, lwd=2) abline(a=1, b=0) abline(a=2, b=0) # vertical reference lines lines(x=c(1,1), y=c(-.5, .5), lwd=2) lines(x=c(2.5,2.5), y=c(-.5, 1.5)) lines(x=c(2.5^2,2.5^2), y=c(-.5, 2.5)) We find that a score of 1 corresponds to 2.5 times larger LDH values. Continue with post.size. 18.2.2 Study scores for postchemotherapy size # calculate score by sequence 2 to 100mm; # 2 is minimum for analysis; set 10 to zero in sequence (sqrt(seq(2,50,by=1))-sqrt(10)) # We use 10mm as a reference, set to zero Sizeplot &lt;- as.data.frame(cbind(n544$Post.size, round(10/8*full.pen$coef[6]*(sqrt(n544$Post.size) - sqrt(10)),1)), main = &quot;Postchemotherapy size&quot;) plot(x=Sizeplot[,1], y=Sizeplot[,2], xlab=&quot;Postchemo size (mm)&quot;, ylab=&quot;Rounded score&quot;, axes=F, xlim=c(0,100), ylim=c(-2.1,1), cex.lab=1.2, main = &quot;Postsize&quot;) scat1d(x=n544$Post.size, side=1, col=&quot;red&quot;, lwd=2) axis(side=1, at=c(2,5,10,20,30,40,50,70, 100)) axis(side=2, at=c(-2,-1,-.5,0,0.5)) # horizontal reference lines abline(a=0, b=0, lwd=2) abline(a=.5, b=0) abline(a=-.5, b=0) abline(a=-1, b=0) abline(a=-2, b=0) # vertical reference lines lines(x=c(2,2), y=c(-2.1, .75)) lines(x=c(10,10), y=c(-2.1, 0.25), lwd=2) lines(x=c(20,20), y=c(-2.1, -.1)) lines(x=c(40,40), y=c(-2.1, -0.6)) lines(x=c(100,100), y=c(-2.1, -1.5)) So, approximate scores for clinically meaningful sizes: 2 mm score +.5; 10mm, 0; 20mm, -.5; 40mm -1; 100 -2 Continue with Reduction. This should be simple, since Reduction was modelled as a linear variable, without transformations. 18.2.3 Study scores for reduction in size Redplot &lt;- as.data.frame(cbind(n544$Reduction, round(10/8*full.pen$coef[7]*n544$Reduction,1))) plot(x=Redplot[,1], y=Redplot[,2], xlab=&quot;Reduction in size (%)&quot;, ylab=&quot;Rounded score&quot;, axes=F, xlim=c(0,100), ylim=c(-.1,2.1), cex.lab=1.2, col=&quot;red&quot;, main = &quot;Reduction in size&quot;) scat1d(x=n544$Reduction, side=1,col=&quot;red&quot;, lwd=2) axis(side=1, at=c(0,25,50,75,100)) axis(side=2, at=c(0,1,2)) # horizontal reference lines abline(a=0, b=0, lwd=2) abline(a=1, b=0) abline(a=2, b=0) # vertical reference lines lines(x=c(0,0), y=c(-.1, 0.1), lwd=2) lines(x=c(50,50), y=c(-.1, 1.25)) lines(x=c(100,100), y=c(-.1, 2.5)) So, scores for reduction in size: 50%, score 1; 100%, score 2 We store the scores in new variables for later use in a logistic regression model, to check the impact of rounding on model performance. # A score of 1 corresponds to 2.5 times larger LDH # rescale such that exp(l) does get more than 1 point; 1 point at 2.5 times normal LDH n544$LDHr &lt;- round(n544$Pre.lnLDH*exp(1)/2.5,1) # postsize: coef -.3 per sqrt(mm). Hence -1 with 3.3*sqrt(mm) # So, approximate scores for clinically meaningful sizes: # 2 mm score +.5; 10mm, 0; 20mm, -.5; 40mm -1; 100 -2 # change the intercept by defining score = 0 for 10 mm, which is clinically of most interest n544$SQPOSTr &lt;- round((n544$sqpost - sqrt(10)) / (sqrt(10) - sqrt(40)),1) # Rescale reduction such that effect 1 point # 50% reduction 1 point; i.e. 0% = 0; 50%=1; 100%=2 n544$REDUC5 &lt;- round(n544$reduc10 / 5,1) Table 18.2 18.2.4 Make a score chart Score chart to be made by hand, using the points as derived above. Could also have kept life simpler by multiplying coefs by 10 and rounding. score.fit &lt;- lrm(Necrosis ~ Teratoma+Pre.AFP+Pre.HCG+LDHr+SQPOSTr+REDUC5,data=n544, x=T,y=T) # scores &lt;- as.data.frame(round(10/8*full.pen$coef[-1])) kable(as.data.frame(10/8*score.fit$coef[-1]), digits=3) %&gt;% kable_styling(full_width=F, position = &quot;left&quot;) 10/8 * score.fit$coef[-1] Teratoma 1.134 Pre.AFP 1.137 Pre.HCG 0.964 LDHr 1.110 SQPOSTr 1.114 REDUC5 1.008 # # Continuous scores LDHvalues &lt;- c(0.6, 1, 1.6, 2.5, 4, 6) kable(as.data.frame(rbind(LDH=LDHvalues, LDHscores=log(LDHvalues)*exp(1)/2.5)), digits = 2, col.names =NULL) %&gt;% kable_styling(full_width=F, position = &quot;left&quot;) LDH 0.60 1 1.60 2.5 4.00 6.00 LDHscores -0.56 0 0.51 1.0 1.51 1.95 Postvalues &lt;- c(2,10,20,40,70) kable(as.data.frame(rbind(Postsize=Postvalues, Postscores=(sqrt(Postvalues) - sqrt(10)) / (sqrt(10) - sqrt(40)))), digits = 2, col.names =NULL) %&gt;% kable_styling(full_width=F, position = &quot;left&quot;) Postsize 2.00 10 20.00 40 70.00 Postscores 0.55 0 -0.41 -1 -1.65 Redvalues &lt;- c(0,5,10) kable(as.data.frame(rbind(Reduction=Redvalues, Redscores=Redvalues / 5)), digits = 2, col.names =NULL) %&gt;% kable_styling(full_width=F, position = &quot;left&quot;) Reduction 0 5 10 Redscores 0 1 2 So, we see that the continuous values of some predictors map to scores of approximately 0.5 or 1. Intermediate scores can be obtained by interpolation. Fig 18.2 18.2.5 Translate score in probability estimates with 95% CI ##&#39;# Function to relate scores to predictions in graph ### make.score.matrix &lt;-function(fit, scores, shrinkage=1, limits.scores=NULL) { # lpscore for score chart + graph fit &lt;- update(fit, x=T,y=T, se.fit=T) # SE of predictions from original model rounded.lp &lt;- fit$x %*% scores # Linear predictor multiplier &lt;- lrm.fit(y=fit$y, x=rounded.lp)$coef[2] ## For score formula shrunk.beta &lt;- shrinkage * multiplier # Shrinkage built in ## Estimate intercept for scores, using the scores as offset with shrinkage fit.lp &lt;- lrm.fit(y=score.fit$y, offset=shrunk.beta*rounded.lp) ## lp formula; this version is not fully rounded yet lp2 &lt;- fit.lp$coef[1] + shrunk.beta*rounded.lp cat(&quot;\\nlinear predictor:&quot;, fit.lp$coef[1], &quot;+&quot;, shrunk.beta, &quot;* rounded.lp\\n&quot;, &quot; original range of scores&quot;, min(rounded.lp), max(rounded.lp), &quot;\\n&quot;) if (!is.null(limits.scores)) { rounded.lp[rounded.lp &lt; min(limits.scores)] &lt;- min(limits.scores) rounded.lp[rounded.lp &gt; max(limits.scores)] &lt;- max(limits.scores) } cat(&quot;restricted range of scores&quot;, min(rounded.lp), max(rounded.lp), &quot;\\n&quot;) ## Data for graph graph.lp &lt;- cbind(rounded.lp, fit$se.fit) # lp and se.fit in matrix lp.events &lt;- tapply(fit$y,list(round(graph.lp[,1],0)),sum) # events per lp score lp.nonevents &lt;- tapply(1-fit$y,list(round(graph.lp[,1],0)),sum) # non-events per lp score se.lp &lt;- tapply(graph.lp[,2],list(round(graph.lp[,1],0)),mean) # mean se per lp score lp.lp &lt;- tapply(graph.lp[,1],list(round(graph.lp[,1],0)),mean) # mean lp per lp score score &lt;- lp.lp # range of score, rounded to 0 decimals lp3 &lt;- fit.lp$coef[1] + shrunk.beta*round(score,0) # lp on logistic scale, rounded ## data frame with predicted prob + 95% CI p.lp &lt;- as.data.frame(cbind(score=round(score,0), p=plogis(lp3),plow=plogis(lp3-1.96*se.lp),phigh=plogis(lp3+1.96*se.lp), lp.events,lp.nonevents)) p.lp$total &lt;- p.lp$lp.events + p.lp$lp.nonevents p.lp } ## Make Fig 18.2 ## ## Continuous predictors in score score.fit &lt;- lrm(Necrosis ~ Teratoma+Pre.AFP+Pre.HCG+LDHr+SQPOSTr+REDUC5,data=n544, x=T,y=T) scores &lt;- rep(1,6) # All scores a weight of 1 lp.n544 &lt;- make.score.matrix(fit=score.fit, scores=scores, shrinkage=0.95, limits.scores=c(-2,5)) ## ## linear predictor: -1.94 + 0.815 * rounded.lp ## original range of scores -4.3 6.7 ## restricted range of scores -2 5 kable(as.data.frame(lp.n544), digits = 2) %&gt;% kable_styling(full_width=F, position = &quot;left&quot;) score p plow phigh lp.events lp.nonevents total -2 -2 0.03 0.01 0.07 0 22 22 -1 -1 0.06 0.03 0.11 2 46 48 0 0 0.13 0.07 0.21 6 53 59 1 1 0.24 0.16 0.36 19 58 77 2 2 0.42 0.31 0.54 48 59 107 3 3 0.62 0.49 0.74 62 37 99 4 4 0.79 0.68 0.87 66 19 85 5 5 0.89 0.82 0.94 42 5 47 par(mfrow=c(1,1),mar=c(4.5,4.5,3,1)) plot(x=lp.n544[,1], y=100*lp.n544[,2], lty = 1, las=1, type = &quot;b&quot;, cex.lab=1.2, ylab = &quot;Predicted probability of necrosis (%)&quot;, ylim=c(-10,100), xlab=&quot;Sum score&quot;, cex=sqrt(lp.n544$total)/5, xaxt=&quot;n&quot;, pch=16, col=&quot;red&quot;) axis(side=1,at=lp.n544[,1], cex=1) # add 95% CI for (i in 1:nrow(lp.n544)) lines(x=c(lp.n544[i,1], lp.n544[i,1]), y=c(100*lp.n544[i,3], 100*lp.n544[i,4]), type=&quot;l&quot;, col=&quot;red&quot;) # add N= ... mtext(&quot;N=&quot;, side = 2, outer = FALSE, line=1.5, at = -10, adj = 0, las=1, cex=1, col=&quot;red&quot;) text(x=lp.n544[,1],y=-10,labels=lp.n544$total, cex=1, col=&quot;red&quot;) End Table 18.2 (score chart) and Fig 18.2 (graphic translation from score to probability) 18.2.6 Categorized coding We can categorize the continuous predictors; a bad idea generally speaking # LDH n544$PRELDH &lt;- ifelse(n544$Pre.lnLDH&lt;log(1),0,1) # PostSize simple coding: 0,1,2 n544$POST2 &lt;- ifelse(n544$sqpost&lt;sqrt(20),2, ifelse(n544$sqpost&lt;sqrt(50),1,0)) # Reduction in categories: increase=-1, 0-49%=0, &gt;=50%=1 n544$REDUCr &lt;- ifelse(n544$Reduction&lt;0,-1, ifelse(n544$Reduction&gt;=50,1,0)) ## Everything coded in categories score.fit2 &lt;- lrm(Necrosis ~ Teratoma+Pre.AFP+Pre.HCG+PRELDH+POST2+REDUCr,data=n544, x=T,y=T) kable(as.data.frame(x=10/8*score.fit2$coef[-1]), digits=2) %&gt;% kable_styling(full_width=F, position = &quot;left&quot;) 10/8 * score.fit2$coef[-1] Teratoma 1.15 Pre.AFP 1.08 Pre.HCG 0.83 PRELDH 1.13 POST2 1.08 REDUCr 0.98 So, each category approx 1 point. Table 18.3 18.2.7 Alternative: make a score from 0 - 5 Ultra simple scores “.. categories of the predictors were simplified for practical application. We conclude that a simple statistical model, based on a limited number of patient characteristics, provides better guidelines for patient selection than those currently used in clinical practice. Br J Cancer 1996” score5 &lt;- n544$Teratoma+n544$Pre.AFP+n544$Pre.HCG+n544$PRELDH+n544$REDUCr score5 &lt;- ifelse(n544$REDUCr&lt;0,0,score5) n544$score5 &lt;- score5 # Simple coding: 5 categories for postsize (no difference 20-30 and 30-50 mm) POST5 &lt;- ifelse(n544$sqpost&lt;=sqrt(10),0, ifelse(n544$sqpost&lt;=sqrt(20),1, ifelse(n544$sqpost&lt;=sqrt(30),2, ifelse(n544$sqpost&lt;=sqrt(50),3,4)))) n544$POST5 &lt;- as.factor(POST5) # add the post size categories as a factor full.simple2 &lt;- lrm(Necrosis~POST5+score5, data=n544, x=T,y=T,se.fit=T) pred.simple2 &lt;- aggregate(plogis(predict(full.simple2)), by=list(POST5, score5), FUN=mean) pred.simple2 &lt;- as.data.frame(with(pred.simple2,tapply(x,list(Group.1,Group.2),mean))) kable(as.data.frame(pred.simple2), digits = 2) %&gt;% kable_styling(full_width=F, position = &quot;left&quot;) 0 1 2 3 4 5 0 NA 0.32 0.52 0.71 0.85 0.93 1 0.14 0.27 0.45 0.66 0.81 0.91 2 0.06 0.12 0.24 0.42 0.63 0.79 3 0.08 0.16 0.30 0.50 0.69 NA 4 0.04 0.09 0.19 0.35 0.55 NA n544$POST5 &lt;- as.numeric(n544$POST5) # Make simple risk scores per category n544$simple.cat &lt;- ifelse(n544$POST5==3 &amp; score5==4,70, ifelse(n544$POST5==3 &amp; score5==5,80, ifelse(n544$POST5==2 &amp; score5==3,60, ifelse(n544$POST5==2 &amp; score5==4,80, ifelse(n544$POST5==2 &amp; score5==5,90, ifelse(n544$POST5&lt;2 &amp; score5==2,60, ifelse(n544$POST5&lt;2 &amp; score5==3,70, ifelse(n544$POST5&lt;2 &amp; score5==4,80, ifelse(n544$POST5&lt;2 &amp; score5==5,90, 50))))))))) simple.tab &lt;- as.data.frame(with(n544,tapply(simple.cat,list(POST5=POST5,score=score5),mean))) simple.tab[is.na(simple.tab)] &lt;- 50 colnames(simple.tab) &lt;- Cs(score.0, score.1, score.2, score.3, score.4, score.5) rownames(simple.tab) &lt;- Cs(size10, size20, size30, size50, size.gt.50) simple.tab %&gt;% mutate(score.0 = cell_spec(score.0, &quot;html&quot;, color = ifelse(score.0 &gt; 50, &quot;orange&quot;, &quot;red&quot;)), score.1 = cell_spec(score.1, &quot;html&quot;, color = ifelse(score.1 &gt; 50, &quot;orange&quot;, &quot;red&quot;)), score.2 = cell_spec(score.2, &quot;html&quot;, color = ifelse(score.2 &gt; 50, &quot;orange&quot;, &quot;red&quot;)), score.3 = cell_spec(score.3, &quot;html&quot;, color = ifelse(score.3 == 70, &quot;green&quot;, ifelse(score.3 == 60, &quot;orange&quot;,&quot;red&quot;))), score.4 = cell_spec(score.4, &quot;html&quot;, color = ifelse(score.4 == 80, &quot;white&quot;, ifelse(score.4 == 70, &quot;green&quot;, ifelse(score.4 == 60, &quot;orange&quot;,&quot;red&quot;))), background=ifelse(score.4 == 80, &quot;green&quot;,&quot;white&quot; )), score.5 = cell_spec(score.5, &quot;html&quot;, color = ifelse(score.5 &gt;= 80, &quot;white&quot;, ifelse(score.5 == 70, &quot;green&quot;, ifelse(score.5 == 60, &quot;orange&quot;,&quot;red&quot;))), background=ifelse(score.5 == 90, &quot;darkgreen&quot;, ifelse(score.5 == 80, &quot;green&quot;,&quot;white&quot; ))) ) %&gt;% kable(format = &quot;html&quot;, escape = F, row.names = T) %&gt;% kable_styling(full_width=F, position = &quot;left&quot;) score.0 score.1 score.2 score.3 score.4 score.5 size10 50 50 60 70 80 90 size20 50 50 50 60 80 90 size30 50 50 50 50 70 80 size50 50 50 50 50 50 50 size.gt.50 50 50 50 50 50 50 # kable(simple.tab, digits = 2) %&gt;% kable_styling(full_width=F, position = &quot;left&quot;) In this way we created a very simple table, with probability of necrosis according to post-chemotherapy mass size (rows) and a simple, categorized score of the other 5 predictors. Fig 18.3 18.2.8 Iso-probability lines For radiologists, it is natural to consider the pre-chemotherapy mass size and post-chemotherapy mass size. According to our analysis, the key information is the pre-chemotherapy size and the reduction in size. These pieces of information need to be considered jointly with the 4 other predictors (Teratoma, 3 tumor markers). We attempted to convey this message in iso-probability lines (Fig 18.3) Radiology ## Radiology paper: could graph pre - post with lines for score 1 - 4 score4 &lt;- n544$Teratoma+n544$Pre.AFP+n544$Pre.HCG+n544$Pre.lnLDH full.simple3 &lt;- lrm(Necrosis ~ score4 + sqpost + reduc10, data=n544, x=T, y=T) kable(as.data.frame(full.simple3$coef), digits = 2) %&gt;% kable_styling(full_width=F, position = &quot;left&quot;) full.simple3$coef Intercept -1.20 score4 0.89 sqpost -0.27 reduc10 0.17 # Make a presize variable, based on reduction and postsize # reduc = (pre-post) / pre; reduc = 1 - post/pre; reduc-1 = -post/pre; pre = -post/(reduc-1) n544$presize &lt;- - n544$sqpost^2 / ifelse((n544$reduc10/10 - 1) != 0,(n544$reduc10/10 - 1),-.04) # Now calculate iso probability lines: e.g. prob -70%, # Calculate PRESIZE from SQPOST, for given probabilities # presize = f(sqpost, plogis(full)) # pre = -post/(reduc10-10) # for reduc10&lt;10 # range sqpost from 2 to 50; score 4 0 - 4 ## Fig 18.3 ## # matrix with sqpost and scores x &lt;- as.matrix(cbind(rep(sqrt(1:50),5),c(rep(0,50),rep(1,50),rep(2,50),rep(3,50),rep(4,50)))) # linear predictor from simple model &#39;full.simple3&#39; lp.simple3 &lt;- x %*% full.simple3$coef[3:2] + full.simple3$coef[1] # now calculate reduc10 with condition p=70% etc # Solve equation qlogis(.7) = lp.simple3 + full.simple3$coef[4] * n544$REDUC10 reduc10.70 &lt;- (qlogis(.7) - lp.simple3) /full.simple3$coef[4] # Calculate presizes: pre = -post/(reduc10/10-1) presize.70 &lt;- - rep(1:50,5) / (reduc10.70/10-1) # in 1 formula for efficiency presize.90 &lt;- - rep(1:50,5) / (((qlogis(.9) - lp.simple3) /(full.simple3$coef[4])/10) -1) presize.80 &lt;- - rep(1:50,5) / (((qlogis(.8) - lp.simple3) /(full.simple3$coef[4])/10) -1) presize.60 &lt;- - rep(1:50,5) / (((qlogis(.6) - lp.simple3) /(full.simple3$coef[4])/10) -1) presize.50 &lt;- - rep(1:50,5) / (((qlogis(.5) - lp.simple3) /(full.simple3$coef[4])/10) -1) # make Postsize from sqpost x[,1] &lt;- x[,1]^2 # combine results x &lt;- as.matrix(cbind(x,lp.simple3, reduc10.70, presize.70, presize.90,presize.80,presize.60,presize.50 )) colnames(x) &lt;- Cs(postsize, score4,lp,reduc1070, presize70,presize90,presize80,presize60,presize50) x &lt;- as.data.frame(x) x[x&lt;0] &lt;- NA # Make some plots; isoprobability lines for different scores, x-axis=postsize par(mfrow=c(2,2), mar=c(4,4,3,.5)) for (i in 1:4) { xp = x[x$score4==i &amp; !is.na(x$presize50) &amp; x$presize50&lt;100 &amp; x$postsize&lt;50, ] xp = xp[sort(xp$presize50),] plot(y=xp$postsize,x=xp$presize50, main=paste(&quot;Score=&quot;,i,sep=&quot;&quot;), ylab=&#39;Postchemo size (mm)&#39;, xlab=&quot;Prechemo size (mm)&quot;, xlim=c(0,100), ylim=c(0,50),type=&quot;l&quot;, pch=&quot;5&quot;, axes=F,las=1, col=mycolors[5], lwd=2) axis(side=2,at=c(0,10,20,30,50)) axis(side=1,at=c(0,20,50,100)) if (i==1) legend(&quot;topleft&quot;, lty=c(1,2,1,2,1), col=mycolors[c(5,4,2,3,6)], lwd=2,bty=&quot;n&quot;, legend=c(&quot;50%&quot;, &quot;60&quot;, &quot;70%&quot;, &quot;80%&quot;, &quot;90%&quot;)) xp = x[x$score4==i &amp; !is.na(x$presize60), ] xp = xp[sort(xp$presize60),] lines(y=xp$postsize,x=xp$presize60, pch=&quot;6&quot;,lty=2, col=mycolors[4], lwd=2) xp = x[x$score4==i &amp; !is.na(x$presize70), ] xp = xp[sort(xp$presize70),] lines(y=xp$postsize,x=xp$presize70, pch=&quot;7&quot;,lty=1, col=mycolors[2], lwd=2) xp = x[x$score4==i &amp; !is.na(x$presize80), ] xp = xp[sort(xp$presize80),] lines(y=xp$postsize,x=xp$presize80, pch=&quot;8&quot;, lty=2, col=mycolors[3], lwd=2) xp = x[x$score4==i &amp; !is.na(x$presize90), ] xp = xp[sort(xp$presize90),] lines(y=xp$postsize,x=xp$presize90, pch=&quot;9&quot;, lty=1, col=mycolors[6], lwd=2) } # end loop over score 1 - 4 So, we obtain some nice graphics. With score 0, men are at high risk of tumor. With score 4, even a relatively large post-chemotherapy mass size leads to high probabilities of necrosis, especially if the pre-chemotherapy mass was large. Fig 18.4 18.2.9 Meta-model with tree presentation We can present a decision rule for patients with testicular cancer, assuming a threshold of 70% for the probability of necrosis. If the probability is higher than 70%, this is a good prognosis group which could be spared surgery. ## Start with dichotomizing predictions from full as &lt;70% vs &gt;=70% n544$predhigh &lt;- ifelse(plogis(full$linear.predictor)&lt;.7,0,1) # Try to make tree model for this outcome par(mfrow=c(1,1), mar=c(2,2,2,1)) tree.orig &lt;- rpart(Necrosis ~ Teratoma+Pre.AFP+Pre.HCG+LDHst+Post.size+Reduction, data=n544) plot(tree.orig) text(tree.orig, use.n=F) title(&quot;Meta-model for original predictions&quot;) tree.meta &lt;- rpart(predhigh ~ Teratoma+Pre.AFP+Pre.HCG+LDHst+Post.size+Reduction, data=n544) plot(tree.meta) text(tree.meta, use.n=F) title(&quot;Meta-model for probability &gt; 70%&quot;) ## Make smooth tree presentation; classification with reduction, teratoma, AFP score3 &lt;- as.numeric(n544$Reduction&gt;70)+as.numeric(n544$Teratoma==1)+as.numeric(n544$Pre.AFP==1) n544$tree.cat &lt;- ifelse(n544$Reduction&gt;50 &amp; score3&gt;=2,1,0) tree.results &lt;- as.data.frame(table(n544$tree.cat, n544$Necrosis)) colnames(tree.results) &lt;- Cs(&quot;Risk group&quot;, Necrosis, N) kable(tree.results, digits = 2) %&gt;% kable_styling(full_width=F, position = &quot;left&quot;) Risk group Necrosis N 0 0 264 1 0 35 0 1 134 1 1 111 end tree analysis Apparent performance of penalized vs rescaled vs simplified models What is the c statistic of various formats to predict necrosis at resection after chemotherapy? a) nomogram (Fig 18.1): original or penalized coefficients, negligable difference expected b) score chart (Table 18.2 and Fig 18.2): rounding, minor decline expected c) simple table (Table 18.3): categorization and simplification, much loss expected d) iso-probability lines (Fig 18.3): major predictors (size, reduction) kept continuous, some loss expected e) tree on a meta-model (Fig 18.4): ultra simple, major loss in performance expected # 3 variants of full model fit cstats &lt;- cbind( rcorr.cens(full$linear.predictor, n544$Necrosis)[1], rcorr.cens(full.shrunk$linear.predictor, n544$Necrosis)[1], rcorr.cens(full.pen$linear.predictor, n544$Necrosis)[1], # rounding for score chart rcorr.cens(score.fit$linear.predictor, n544$Necrosis)[1], # simple table rcorr.cens(n544$simple.cat, n544$Necrosis)[1], # Radiology paper rcorr.cens(full.simple3$linear.predictor, n544$Necrosis)[1], # Tree rcorr.cens(n544$tree.cat, n544$Necrosis)[1]) colnames(cstats) &lt;- Cs(full, shrunk, penalized, scores, table, radiology, tree) rownames(cstats) &lt;- &quot;C&quot; dotchart(cstats, xlab=&quot;C statistic&quot;, xlim=c(0.6,.9)) kable(as.data.frame(cstats), digits = 4) %&gt;% kable_styling(full_width=F, position = &quot;left&quot;) full shrunk penalized scores table radiology tree C 0.839 0.839 0.839 0.838 0.725 0.838 0.668 18.2.10 End comparisons of c statistics As expected, the apparent performance of penalized vs rescaled models was very similar. Two formats led to a substantial loss in performance: simple table (Table 18.3): categorization and simplification, c=0.73 cp to c=0.84 tree on a meta-model (Fig 18.4): ultra simple, c=0.67, for a single threshold to classify men as low risk and spare them resection. Please use and improve the code above when desired. The major tools for presentation are: 1. The nomogram function: allows for scores with categorical and continuous predictors, with transformations. 2. The regression formula: can be implemented in wwww tools, including the Evidencio toolbox. "],["external-validity.html", "19 Patterns of External Validity 19.1 Fig 19.7: Case-control design disturbs calibration", " 19 Patterns of External Validity 19.0.1 Fig 19.1: a missed predictor Z ## Actual correlations in n=1000 ## r=0: -0.0114 r=.33: 0.312 r=.5: 0.475 19.0.2 Fig 19.2: a missed predictor Z with identical distribution –&gt; no impact 19.0.3 Fig 19.3: more or less severe cases selected 19.0.4 Fig 19.4: more or less heterogeneous cases selected 19.0.5 Fig 19.5: more or less severe cases selected by Z –&gt; Selection by missed predictor leads to miscalibration 19.0.6 Fig 19.6: more or less heterogeneous cases selected by Z –&gt; Selection by missed predictor has minor impact 19.1 Fig 19.7: Case-control design disturbs calibration Disturbance is exactly as expected by ratio of selecting cases:controls (log(2)) Select all cases, and half of the controls –&gt; same as shift in intercept 19.1.1 Fig 19.8: Overfitting disturbs discrimination and calibration 19.1.2 Fig 19.9: Different coeficients (model misspecification) disturbs discrimination and calibration 19.1.3 Scenarios: Table 19.4 Change of setting may especially impact calibration RCT vs survey may impact discrimination (more homogeneity) and calibration 19.1.4 Uncertainty in validation simulations "],["updating.html", "20 Updating for a New Setting", " 20 Updating for a New Setting Chapter 20 additional material upcoming. "],["updating-multiple.html", "21 Updating for Multiple Settings", " 21 Updating for Multiple Settings Chapter 21 additional material upcoming. "],["case-study-gusto.html", "22 Case Study on a Prediction of 30-Day Mortality", " 22 Case Study on a Prediction of 30-Day Mortality Chapter 22 additional material upcoming. "],["case-study-cardiovascular.html", "23 Case Study on Survival Analysis: Prediction of Cardiovascular Event", " 23 Case Study on Survival Analysis: Prediction of Cardiovascular Event Chapter 23 additional material upcoming. "],["lessons-datasets.html", "24 Overall Lessons and Data Sets", " 24 Overall Lessons and Data Sets Chapter 24 additional material upcoming. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
